<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-observability/distributed-tracing-with-tempo" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Distributed tracing with Tempo | SKIP</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://skip.kartverket.no/docs/observability/distributed-tracing-with-tempo"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Distributed tracing with Tempo | SKIP"><meta data-rh="true" name="description" content="What is distributed tracing?"><meta data-rh="true" property="og:description" content="What is distributed tracing?"><link data-rh="true" rel="icon" href="/img/favicon/favicon.ico"><link data-rh="true" rel="canonical" href="https://skip.kartverket.no/docs/observability/distributed-tracing-with-tempo"><link data-rh="true" rel="alternate" href="https://skip.kartverket.no/docs/observability/distributed-tracing-with-tempo" hreflang="en"><link data-rh="true" rel="alternate" href="https://skip.kartverket.no/docs/observability/distributed-tracing-with-tempo" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"🔭 Observabilitet","item":"https://skip.kartverket.no/docs/observability/"},{"@type":"ListItem","position":2,"name":"Distributed tracing with Tempo","item":"https://skip.kartverket.no/docs/observability/distributed-tracing-with-tempo"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="SKIP RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="SKIP Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="SKIP JSON Feed">







<script src="https://platform.twitter.com/widgets.js"></script><link rel="stylesheet" href="/assets/css/styles.a0214603.css">
<script src="/assets/js/runtime~main.6b47af6f.js" defer="defer"></script>
<script src="/assets/js/main.a26d0fc9.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/skip.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/skip.png" alt="SKIP" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/skip.png" alt="SKIP" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">SKIP</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Docs</a><a class="navbar__item navbar__link" href="/blog">Tech Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://kartverket.atlassian.net/wiki/spaces/SIK/overview" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Sikkerhetshåndboka<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://github.com/kartverket" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs"><span title="Velkommen til SKIP! 🎉" class="linkLabel_WmDU">Velkommen til SKIP! 🎉</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/kom-i-gang"><span title="💡 Kom i gang" class="categoryLinkLabel_W154">💡 Kom i gang</span></a><button aria-label="Expand sidebar category &#x27;💡 Kom i gang&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/applikasjon-utrulling"><span title="🚀 Applikasjon &amp; utrulling" class="categoryLinkLabel_W154">🚀 Applikasjon &amp; utrulling</span></a><button aria-label="Expand sidebar category &#x27;🚀 Applikasjon &amp; utrulling&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/jobber-skip"><span title="📅 Jobber på SKIP" class="linkLabel_WmDU">📅 Jobber på SKIP</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/trafikkstyring"><span title="🚦 Trafikkstyring" class="linkLabel_WmDU">🚦 Trafikkstyring</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/lagring"><span title="💾 Lagring" class="categoryLinkLabel_W154">💾 Lagring</span></a><button aria-label="Expand sidebar category &#x27;💾 Lagring&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/docs/observability"><span title="🔭 Observabilitet" class="categoryLinkLabel_W154">🔭 Observabilitet</span></a><button aria-label="Collapse sidebar category &#x27;🔭 Observabilitet&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/observability/grafana"><span title="Grafana" class="linkLabel_WmDU">Grafana</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/observability/metrikker"><span title="Metrikker" class="linkLabel_WmDU">Metrikker</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/observability/distributed-tracing-with-tempo"><span title="Distributed tracing with Tempo" class="linkLabel_WmDU">Distributed tracing with Tempo</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/observability/dashboard"><span title="Dashboards" class="linkLabel_WmDU">Dashboards</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/observability/grafana-and-GCP"><span title="Grafana and GCP" class="linkLabel_WmDU">Grafana and GCP</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/observability/alerting-with-grafana"><span title="Alerting with Grafana" class="linkLabel_WmDU">Alerting with Grafana</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/observability/logs-with-Loki"><span title="Logs with Loki" class="linkLabel_WmDU">Logs with Loki</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/observability/recording-and-alerting-rules"><span title="Recording and alerting rules" class="linkLabel_WmDU">Recording and alerting rules</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/observability/grafana-cheat-sheet"><span title="Grafana cheat sheet" class="linkLabel_WmDU">Grafana cheat sheet</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/observability/real-user-monitoring-with-Faro"><span title="Real User Monitoring with Faro" class="linkLabel_WmDU">Real User Monitoring with Faro</span></a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/observability"><span>🔭 Observabilitet</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Distributed tracing with Tempo</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Distributed tracing with Tempo</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-distributed-tracing">What is distributed tracing?<a href="#what-is-distributed-tracing" class="hash-link" aria-label="Direct link to What is distributed tracing?" title="Direct link to What is distributed tracing?" translate="no">​</a></h2>
<p>In complex (and distributed) systems there are at any time many ongoing parallel processes. Some of these are interlinked or trigger each other. In order to find out which operations that originate from the same request, it is common in many systems to have a so-called Trace ID. With modern distributed tracing this is standardized, and in addition sub-operations (spans) per Trace ID are also supported. When you use a standardized setup to trace applications you also gain access to a large and exciting toolbox.</p>
<p>Further reading:</p>
<ul>
<li><a href="https://opentelemetry.io/" target="_blank" rel="noopener noreferrer">OpenTelemetry</a></li>
<li><a href="https://zipkin.io/" target="_blank" rel="noopener noreferrer">Zipkin</a> (interesting from a historical perspective)</li>
<li><a href="https://www.honeycomb.io/getting-started/getting-started-distributed-tracing" target="_blank" rel="noopener noreferrer">A general guide to getting started with distributed tracing</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-does-skip-offer">What does SKIP offer?<a href="#what-does-skip-offer" class="hash-link" aria-label="Direct link to What does SKIP offer?" title="Direct link to What does SKIP offer?" translate="no">​</a></h2>
<p>As part of our implementation of the LGTM stack, SKIP has chosen to offer <a href="https://grafana.com/oss/tempo/" target="_blank" rel="noopener noreferrer">Grafana Tempo</a> as as service. This is a component that is fully integrated with the rest of this modern observability stack, and shares the same user interface and authentication as Grafana, Mimir and Loki.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-do-i-get-started">How do I get started?<a href="#how-do-i-get-started" class="hash-link" aria-label="Direct link to How do I get started?" title="Direct link to How do I get started?" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="instrumentation">Instrumentation<a href="#instrumentation" class="hash-link" aria-label="Direct link to Instrumentation" title="Direct link to Instrumentation" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>A known limitation in the way we have collected trace data is that we up until recently have had no way of excluding certain traces automatically. This means that all Prometheus scrapes (metrics collection) and automatic health checks will also be collected.</p><p>Now that issue <a href="https://github.com/grafana/agent/issues/4628" target="_blank" rel="noopener noreferrer">#4628</a>
has been implemented, this can finally be rectified. Follow <a href="https://kartverket.atlassian.net/browse/SKIP-1250" target="_blank" rel="noopener noreferrer">SKIP-1250</a> for updates to when this is implemented in our setup.</p></div></div>
<p>In order to generate, propagate and send traces the application must be instrumented.</p>
<p>Instrumentation can be achieved in several ways, of which 2 are relevant to us: manual and automatic instrumentation.</p>
<p>Manual instrumentation requires the use of a <a href="https://opentelemetry.io/docs/instrumentation/java/manual/" target="_blank" rel="noopener noreferrer">library</a> which knows how a given integration behaves, and which enables it to connect to hooks in that integrations in order to generate new traces and/or spans if those do not already exist.</p>
<p>The other (and recommended) method is to use an automated approach. In the case of Java applications (the only type that has been tested as of now), you will need to bundle a java agent in your Docker image, as well as set up some extra configuration when the application is run (for example through Skiperator).</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>It’s worth mentioning that the Spring ecosystem offers a form of automatic instrumentation via Micrometer Tracing and OpenTelemetry OTLP exporters. Per october 2023 this is still under development and not considered a mature enough solution to utilize in our systems.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-dockerfile">Example Dockerfile<a href="#example-dockerfile" class="hash-link" aria-label="Direct link to Example Dockerfile" title="Direct link to Example Dockerfile" translate="no">​</a></h3>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token instruction keyword" style="color:#00009f">FROM</span><span class="token instruction"> alpine:3.18.3@sha256:c5c5fda71656f28e49ac9c5416b3643eaa6a108a8093151d6d1afc9463be8e33 </span><span class="token instruction keyword" style="color:#00009f">AS</span><span class="token instruction"> builder</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">ARG</span><span class="token instruction"> OTEL_AGENT_VERSION=1.29.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 1. Last ned påkrevd java-agent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">RUN</span><span class="token instruction"> apk add --no-cache curl </span><span class="token instruction operator" style="color:#393A34">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:#393A34"><span class="token instruction">    &amp;&amp; mkdir /agents </span><span class="token instruction operator" style="color:#393A34">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:#393A34"><span class="token instruction">    &amp;&amp; curl -L https://github.com/open-telemetry/opentelemetry-java-instrumentation/releases/download/v</span><span class="token instruction variable" style="color:#36acaa">${OTEL_AGENT_VERSION}</span><span class="token instruction">/opentelemetry-javaagent.jar &gt; /agents/opentelemetry.jar</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">ADD</span><span class="token instruction"> build/distributions/gbok-run*.tar /gbok</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">FROM</span><span class="token instruction"> eclipse-temurin:11-jdk-alpine</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">COPY</span><span class="token instruction"> cert/kartverket_root_ca.crt /usr/local/share/ca-certificates/kartverket_root_ca.crt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">ENV</span><span class="token instruction"> USER_ID=150</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">ENV</span><span class="token instruction"> USER_NAME=apprunner</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">RUN</span><span class="token instruction"> apk add --no-cache tzdata </span><span class="token instruction operator" style="color:#393A34">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:#393A34"><span class="token instruction">    &amp;&amp; addgroup -g </span><span class="token instruction variable" style="color:#36acaa">${USER_ID}</span><span class="token instruction"> </span><span class="token instruction variable" style="color:#36acaa">${USER_NAME}</span><span class="token instruction"> </span><span class="token instruction operator" style="color:#393A34">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:#393A34"><span class="token instruction">    &amp;&amp; adduser -u </span><span class="token instruction variable" style="color:#36acaa">${USER_ID}</span><span class="token instruction"> -G </span><span class="token instruction variable" style="color:#36acaa">${USER_NAME}</span><span class="token instruction"> -D </span><span class="token instruction variable" style="color:#36acaa">${USER_NAME}</span><span class="token instruction"> </span><span class="token instruction operator" style="color:#393A34">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:#393A34"><span class="token instruction">    &amp;&amp; keytool -import -v -noprompt -trustcacerts -alias kartverketrootca -file /usr/local/share/ca-certificates/kartverket_root_ca.crt -keystore </span><span class="token instruction variable" style="color:#36acaa">$JAVA_HOME</span><span class="token instruction">/lib/security/cacerts -storepass changeit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">ENV</span><span class="token instruction"> TZ=Europe/Oslo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">COPY</span><span class="token instruction"> </span><span class="token instruction options property" style="color:#36acaa">--from</span><span class="token instruction options punctuation" style="color:#393A34">=</span><span class="token instruction options string" style="color:#e3116c">builder</span><span class="token instruction options"> </span><span class="token instruction options property" style="color:#36acaa">--chown</span><span class="token instruction options punctuation" style="color:#393A34">=</span><span class="token instruction options string" style="color:#e3116c">${USER_ID}:${USER_ID}</span><span class="token instruction"> /gbok /gbok</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2. Kopier inn nedlastet agent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">COPY</span><span class="token instruction"> </span><span class="token instruction options property" style="color:#36acaa">--from</span><span class="token instruction options punctuation" style="color:#393A34">=</span><span class="token instruction options string" style="color:#e3116c">builder</span><span class="token instruction options"> </span><span class="token instruction options property" style="color:#36acaa">--chown</span><span class="token instruction options punctuation" style="color:#393A34">=</span><span class="token instruction options string" style="color:#e3116c">${USER_ID}:${USER_ID}</span><span class="token instruction"> /agents /agents</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">USER</span><span class="token instruction"> </span><span class="token instruction variable" style="color:#36acaa">${USER_NAME}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">EXPOSE</span><span class="token instruction"> 8081</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token instruction keyword" style="color:#00009f">ENTRYPOINT</span><span class="token instruction"> [</span><span class="token instruction string" style="color:#e3116c">&quot;sh&quot;</span><span class="token instruction">, </span><span class="token instruction string" style="color:#e3116c">&quot;-c&quot;</span><span class="token instruction">, </span><span class="token instruction string" style="color:#e3116c">&quot;/gbok/gbok-run*/bin/gbok-run&quot;</span><span class="token instruction">]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="runtime-configuration">Runtime configuration<a href="#runtime-configuration" class="hash-link" aria-label="Direct link to Runtime configuration" title="Direct link to Runtime configuration" translate="no">​</a></h3>
<p>In order to use the Java agent, it needs to be configured and loaded. Through testing with Grunnboken, we have arrived at <a href="https://github.com/kartverket/digibok-apps/blob/879d3d34b4c1f6f28d961c59193cb965a922f71f/applications/gbok2.libsonnet#L6-L14" target="_blank" rel="noopener noreferrer">the first version of configuration which can be seen here</a> .</p>
<p>When this configuration is done, it is then passed to <code>JAVA_TOOL_OPTIONS</code> <a href="https://github.com/kartverket/digibok-apps/blob/879d3d34b4c1f6f28d961c59193cb965a922f71f/applications/gbok2.libsonnet#L38" target="_blank" rel="noopener noreferrer">like this</a> .</p>
<p>There is currently no inbuilt mechanism in <a href="https://github.com/kartverket/argokit" target="_blank" rel="noopener noreferrer">ArgoKit</a> to achieve this. We are open for PRs on this topic if anyone would like to contribute.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="view-traces">View traces<a href="#view-traces" class="hash-link" aria-label="Direct link to View traces" title="Direct link to View traces" translate="no">​</a></h3>
<p>Traces can be viewed through our Grafana instance at <a href="https://monitoring.kartverket.cloud/" target="_blank" rel="noopener noreferrer">monitoring.kartverket.cloud</a> . From here, choose <strong>Explore</strong> in the menu and then the correct <strong>Tempo</strong> data source corresponding to the environment you wish to view traces for.</p>
<p>After that, you have the choice of using the <strong>Search</strong> (graphical build tool for queries) or <strong>TraceQL</strong> (manual query specification) tools.</p>
<p><img decoding="async" loading="lazy" alt="The “Search” tab is active, and fields have been filled through the use of dropdowns." src="/assets/images/temposearchtab-dbf1b835d8dfefc8d42c7980d8b7121e.png" width="824" height="375" class="img_ev3q">
Above: The “Search” tab is active, and fields have been filled through the use of dropdowns.</p>
<p><img decoding="async" loading="lazy" alt="The “TraceQL” tab lets you specify a user-defined query. Here is shown a query for “gbok2-server” traces, filtering out health checks" src="/assets/images/tempotraceqltab-b1de5edc5aba241cdcf0c15fa2d05df6.png" width="827" height="263" class="img_ev3q">
Above: The “TraceQL” tab lets you specify a user-defined query. Here is shown a query for “gbok2-server” traces, filtering out health checks</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/kartverket/skip-docs/edit/main/docs/07-observability/02-distributed-tracing-with-tempo.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/observability/metrikker"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Metrikker</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/observability/dashboard"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Dashboards</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-distributed-tracing" class="table-of-contents__link toc-highlight">What is distributed tracing?</a></li><li><a href="#what-does-skip-offer" class="table-of-contents__link toc-highlight">What does SKIP offer?</a></li><li><a href="#how-do-i-get-started" class="table-of-contents__link toc-highlight">How do I get started?</a><ul><li><a href="#instrumentation" class="table-of-contents__link toc-highlight">Instrumentation</a></li><li><a href="#example-dockerfile" class="table-of-contents__link toc-highlight">Example Dockerfile</a></li><li><a href="#runtime-configuration" class="table-of-contents__link toc-highlight">Runtime configuration</a></li><li><a href="#view-traces" class="table-of-contents__link toc-highlight">View traces</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Lenker</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://uustatus.no/nb/erklaringer/publisert/7148395f-f0cf-4019-9c45-3b83d79fd544" target="_blank" rel="noopener noreferrer" class="footer__link-item">Tilgjengelighetserklæring<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Statens Kartverk</div></div></div></footer></div>
</body>
</html>