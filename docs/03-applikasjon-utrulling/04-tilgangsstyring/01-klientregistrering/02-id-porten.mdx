# ID-Porten

For √• registrere en klient i ID-porten, kan du enten gj√∏re det i Digdir sin [selvbetjeninsl√∏sning](https://sjolvbetjening.samarbeid.digdir.no/login) eller
gjennom Kubernetes-operatoren [Digdirator](https://github.com/nais/digdirator). Digdirator er en Kubernetes-operator utviklet av NAV sitt plattformteam (NAIS) som skal gj√∏re det enkelt √• deklarativt sette opp og vedlikeholde
integrasjoner mot [Digdir](https://docs.digdir.no) sine systemer. Dette inkluderer **ID-Porten**-integrasjoner og **Maskinporten**-integrasjoner, men per n√• **ikke** **Annsattporten**-integrasjoner.

:::caution
Digdirator st√∏tter kun klientregistreringer mot ID-porten og Maskinporten. For Ansattporten m√• klientregistreringer gj√∏res manuelt i Digdir sin [selvbetjeningsl√∏sning](https://sjolvbetjening.samarbeid.digdir.no/login).
:::

## üß™ Testmilj√∏ for ID-Porten

Digdir tilbyr ID-Porten i et testmilj√∏, der du kan teste applikasjonen din med syntetiske brukere fra Test-Folkeregisteret. 
For √• registrere en klient mot ID-Porten sitt testmilj√∏ s√• kan du enten gj√∏re det i Digdir sin [selvbetjeningsl√∏sning i test](https://sjolvbetjening.test.samarbeid.digdir.no/login) 
eller opprette en `IDPortenClient`-ressurs i dev-clustrene til SKIP, i.e. `atgcp1-dev` eller `atkv3-dev`.

## ü™™ `IDPortenClient`

En `IDPortenClient` er en CRD som lar brukere deklarativt opprette og vedlikeholde ID-Porten-klientregistreringer.

:::caution
Ztoperator st√∏tter per n√• kun klientregistreringer som identifiserer seg mot ID-porten med `client_secret_post`. 
Ettersom Digdirator kun oppretter klientregistreringer med `private_key_jwt`, s√• vil disse ikke fungere med Ztoperator. 
Vi jobber med √• f√• p√• plass st√∏tte for `private_key_jwt` i Ztoperator.
:::

<details>
    <summary><strong>spec</strong> _(object, required)_ ‚Äì Spesifikasjon til `IDPortenClient`</summary>

    <p><strong>secretName</strong> _(string, required)_ ‚Äì Navnet p√• den resulterende `Secret`-ressursen som vil bli opprettet.</p>

    <p><strong>integrationType</strong> _(string, optional)_ ‚Äì Definerer integrasjonstypen for klienten. Bestemmer hvilke scopes som kan registreres. Kan ikke endres etter opprettelse. Tillatte verdier: `krr`, `idporten`, `api_klient`.</p>

    <p><strong>scopes</strong> _([]string, optional)_ ‚Äì Definerer OAuth2-scopes for klienten. Begrenset basert p√• `integrationType`.</p>

    <p><strong>frontchannelLogoutURI</strong> _(string, optional)_ ‚Äì URL som ID-porten omdirigere til n√•r en utlogging utl√∏ses av en annen applikasjon.</p>

    <p><strong>postLogoutRedirectURIs</strong> _([]string, optional)_ ‚Äì Liste over gyldige URI-er hvor ID-porten kan omdirigere etter utlogging.</p>

    <p><strong>redirectURIs</strong> _([]string], optional)_ ‚Äì Liste over redirect URI-er som skal registreres hos DigDir.</p>

    <p><strong>accessTokenLifetime</strong> _(integer, optional)_ ‚Äì Maksimal levetid i sekunder for `access_token` som returneres fra ID-porten. Min: 1, maks: 3600.</p>

    <p><strong>clientURI</strong> _(string, optional)_ ‚Äì URL til klienten brukt av DigDir n√•r en 'tilbake'-knapp vises eller ved feil.</p>

    <p><strong>clientName</strong> _(string, optional)_ ‚Äì Navnet p√• klienten registrert hos DigDir. Vises under innlogging for brukerorienterte flyter.</p>

    <p><strong>sessionLifetime</strong> _(integer, optional)_ ‚Äì Maksimal √∏ktlevetid i sekunder for en innlogget sluttbruker for denne klienten. Min: 3600, maks: 28800.</p>

    <p><strong>ssoDisabled</strong> _(bool, optional)_ ‚Äì Kontrollerer Single Sign-On-oppsettet for klienten. Hvis satt til `true`, er SSO deaktivert.</p>

</details>

F√∏lgende eksempel registrerer en klientintegrasjon mot ID-porten av typen `idporten`.
N√•r registrering er fullf√∏rt vil Digdirator opprette Kubernetes-hemmeligheten `idporten-secret` i namespacet `tilgangsstyring-main`.

```yaml title="Klientregistrering mot ID-Porten med Digdirator"
apiVersion: nais.io/v1
kind: IDPortenClient
metadata:
  name: test-client
  namespace: tilgansstyring-main
spec:
  clientName: Test Application
  clientURI: https://test-app.atgcp1-sandbox.kartverket-intern.cloud
  frontchannelLogoutURI: https://test-app.atgcp1-sandbox.kartverket-intern.cloud/oauth2/logout
  integrationType: idporten
  redirectURIs:
    - https://test-app.atgcp1-sandbox.kartverket-intern.cloud/oauth2/callback
  scopes:
    - openid
    - profile
  secretName: idporten-secret
```

```yaml title="Hemmelighet opprettet av Digdirator etter fullf√∏rt klientregistrering"
apiVersion: v1
kind: Secret
metadata:
  name: idporten-secret
  namespace: tilgangsstyring-main
data:
  IDPORTEN_CLIENT_ID: ++++++++
  IDPORTEN_CLIENT_JWK: ++++++++
  IDPORTEN_ISSUER: ++++++++
  IDPORTEN_JWKS_URI: ++++++++
  IDPORTEN_REDIRECT_URI: ++++++++
  IDPORTEN_TOKEN_ENDPOINT: ++++++++
  IDPORTEN_WELL_KNOWN_URL: ++++++++
type: Opaque
```