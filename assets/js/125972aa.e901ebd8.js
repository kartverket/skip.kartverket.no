"use strict";(globalThis.webpackChunkskip_docs=globalThis.webpackChunkskip_docs||[]).push([[6897],{60574(e,r,n){n.r(r),n.d(r,{assets:()=>a,contentTitle:()=>o,default:()=>p,frontMatter:()=>l,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"applikasjon-utrulling/tilgangsstyring/klientregistrering/entra-id","title":"Microsoft Entra ID","description":"Microsoft Entra ID er identitetstilbyderen Kartverket bruker internt for sine ansatte. Velger du Microsoft Entra ID som identitetstilbyder for din applikasjon,","source":"@site/docs/03-applikasjon-utrulling/04-tilgangsstyring/01-klientregistrering/01-entra-id.mdx","sourceDirName":"03-applikasjon-utrulling/04-tilgangsstyring/01-klientregistrering","slug":"/applikasjon-utrulling/tilgangsstyring/klientregistrering/entra-id","permalink":"/docs/applikasjon-utrulling/tilgangsstyring/klientregistrering/entra-id","draft":false,"unlisted":false,"editUrl":"https://github.com/kartverket/skip-docs/edit/main/docs/03-applikasjon-utrulling/04-tilgangsstyring/01-klientregistrering/01-entra-id.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Klientregistrering","permalink":"/docs/applikasjon-utrulling/tilgangsstyring/klientregistrering/"},"next":{"title":"ID-Porten","permalink":"/docs/applikasjon-utrulling/tilgangsstyring/klientregistrering/id-porten"}}');var i=n(74848),s=n(28453);const l={},o="Microsoft Entra ID",a={},d=[{value:"\ud83d\udd39 <code>AzureAdApplication</code>",id:"-azureadapplication",level:2}];function c(e){const r={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components},{Details:n}=r;return n||function(e,r){throw new Error("Expected "+(r?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"microsoft-entra-id",children:"Microsoft Entra ID"})}),"\n",(0,i.jsxs)(r.p,{children:["Microsoft Entra ID er identitetstilbyderen Kartverket bruker internt for sine ansatte. Velger du Microsoft Entra ID som identitetstilbyder for din applikasjon,\ns\xe5 er det fordi du \xf8nsker \xe5 tilby tjenesten din for internt ansatte i Kartverket.\nEn klientregistrering i Microsoft Entra ID kalles for en ",(0,i.jsx)(r.em,{children:"app-registration"}),". For \xe5 opprette en app-registration i Microsoft Entra ID, kan du bruke Kubernetes-operatoren ",(0,i.jsx)(r.a,{href:"https://github.com/nais/azurerator",children:"Azurerator"}),".\nDen er utviklet av ",(0,i.jsx)(r.a,{href:"https://nais.io",children:"NAV sitt plattformteam (NAIS)"}),", og har som m\xe5l \xe5 gj\xf8re det enkelt \xe5 deklarativt sette opp og vedlikeholde\napp-registrations i ",(0,i.jsx)(r.a,{href:"https://portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/Overview",children:"Microsoft Entra ID"}),"."]}),"\n",(0,i.jsxs)(r.h2,{id:"-azureadapplication",children:["\ud83d\udd39 ",(0,i.jsx)(r.code,{children:"AzureAdApplication"})]}),"\n",(0,i.jsxs)(r.p,{children:["Azurerator introduserer CRD-en ",(0,i.jsx)(r.code,{children:"AzureAdApplication"}),", som h\xe5ndterer opprettelse og vedlikehold av app-registrations i Microsoft Entra ID.\nApp-registrations opprettet med Azurerator vil f\xe5 navn basert p\xe5 hvor de er plassert i et Kubernetes-cluster, i.e. ",(0,i.jsx)(r.code,{children:"cluster:namespace:name"}),".\nEtter \xe5 ha fullf\xf8rt opprettelsen, vil Azurerator opprette en Kubernetes-hemmelighet (",(0,i.jsx)(r.code,{children:"Secret"}),") i samme namespace med hemmeligheter som kan brukes av applikasjoner til tilgangsstyring, som for eksempel ",(0,i.jsx)(r.code,{children:"client_id"}),", ",(0,i.jsx)(r.code,{children:"client_secret"}),", ",(0,i.jsx)(r.code,{children:"private_key_jwt"}),", diverse URL-er og lignende."]}),"\n",(0,i.jsx)(r.admonition,{type:"tip",children:(0,i.jsxs)(r.p,{children:["Azurerator h\xe5ndterer rullering av hemmeligheter for deg!\nHemmeligheten som Azurerator oppretter vil ha to sett med ",(0,i.jsx)(r.code,{children:"client_id"})," og ",(0,i.jsx)(r.code,{children:"private_key_jwt"}),": ett aktivt og ett neste.\nN\xe5r det aktive settet n\xe6rmer seg utl\xf8p, vil Azurerator automatisk generere et nytt sett og oppdatere app-registreringen i Entra ID."]})}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsxs)("summary",{children:[(0,i.jsx)("strong",{children:"spec"})," ",(0,i.jsx)(r.em,{children:"(object, required)"})," \u2013 Spesifikasjon til ",(0,i.jsx)(r.code,{children:"AzureAdApplication"})]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"allowAllUsers"})," ",(0,i.jsx)(r.em,{children:"(bool, required)"})," \u2013 Bestemmer om alle brukere i tenanten som Azurerator er konfigurert mot skal f\xe5 tilgang."]}),(0,i.jsxs)(n,{children:[(0,i.jsxs)("summary",{children:[(0,i.jsx)("strong",{children:"claims"})," ",(0,i.jsx)(r.em,{children:"(object, optional)"})," \u2013 Definerer konfigurasjon av claims som inkluderes i tokenene som returneres til Entra ID applikasjonen."]}),(0,i.jsxs)(n,{children:[(0,i.jsxs)("summary",{children:[(0,i.jsx)("strong",{children:"groups"})," ",(0,i.jsx)(r.em,{children:"([]object, optional)"})," \u2013 En liste over Entra ID gruppe ID-er som skal inkluderes i ",(0,i.jsx)(r.code,{children:"groups"}),"-claimet i tokenene utstedt av Entra ID. Dette tildeler ogs\xe5 grupper til app-registreringen brukt for tilgangskontroll. Kun direkte medlemmer av gruppene f\xe5r tilgang."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"id"})," ",(0,i.jsx)(r.em,{children:"(string, required)"})," \u2013 Objekt-ID-en (OID) til en Entra ID-gruppe."]})]})]}),(0,i.jsxs)(n,{children:[(0,i.jsxs)("summary",{children:[(0,i.jsx)("strong",{children:"replyUrls"})," ",(0,i.jsx)(r.em,{children:"([]object, required)"})," \u2013 URL-er som applikasjonen godtar som svaradresser etter autentisering."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"url"})," ",(0,i.jsx)(r.em,{children:"(string, required)"})," \u2013 En godkjent svaradresse (reply URL) for applikasjonen."]})]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"logoutUrl"})," ",(0,i.jsx)(r.em,{children:"(string, optional)"})," \u2013 URL-en brukere blir omdirigert til n\xe5r de logger ut av applikasjonen.."]}),(0,i.jsxs)(n,{children:[(0,i.jsxs)("summary",{children:[(0,i.jsx)("strong",{children:"preAuthorizedApplications"})," ",(0,i.jsx)(r.em,{children:"([]object, optional)"})," \u2013 Definerer andre app-registreringer som er forh\xe5ndsautorisert til \xe5 f\xe5 tilgang til denne applikasjonen. Her refereres det til tilsvarende ",(0,i.jsx)(r.code,{children:"AzureAdApplication"}),"."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"application"})," ",(0,i.jsx)(r.em,{children:"(string, required)"})," \u2013 Navnet p\xe5 den forh\xe5ndsgodkjente applikasjonen."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"namespace"})," ",(0,i.jsx)(r.em,{children:"(string, required)"})," \u2013 Namespacet hvor den forh\xe5ndsgodkjente applikasjonen befinner seg."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"cluster"})," ",(0,i.jsx)(r.em,{children:"(string, required)"})," \u2013 Clusteret hvor den forh\xe5ndsgodkjente applikasjonen befinner seg."]}),(0,i.jsxs)(n,{children:[(0,i.jsxs)("summary",{children:[(0,i.jsx)("strong",{children:"permissions"})," ",(0,i.jsx)(r.em,{children:"(object, optional)"})," \u2013 Spesifiserer hvilke claims den forh\xe5ndsautoriserte applikasjonen har."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"scopes"})," ",(0,i.jsx)(r.em,{children:"([]string, optional)"})," \u2013 Liste med egendefinerte tilgangs-scopes tildelt til den forh\xe5ndsautoriserte appliaksjonen."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"roles"})," ",(0,i.jsx)(r.em,{children:"([]string, optional)"})," \u2013 Liste med egendefinerte tilgangs-roller tildelt til den forh\xe5ndsautoriserte appliaksjonen."]})]})]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"secretName"})," ",(0,i.jsx)(r.em,{children:"(string, required)"})," \u2013 Navnet p\xe5 den resulterende ",(0,i.jsx)(r.code,{children:"Secret"}),"-ressursen som vil bli opprettet."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"secretKeyPrefix"})," ",(0,i.jsx)(r.em,{children:"(string, optional)"})," \u2013 Et valgfritt brukerdefinert prefiks som brukes p\xe5 n\xf8klene i den genererte hemmeligheten, og erstatter standardprefikset (AZURE)."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"secretProtected"})," ",(0,i.jsx)(r.em,{children:"(bool, optional)"})," \u2013 Angir om hemmeligheten skal tilbaketrekkes selv n\xe5r den ikke er i bruk."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"singlePageApplication"})," ",(0,i.jsx)(r.em,{children:"(bool, optional)"})," \u2013 Angir om denne Entra ID-applikasjonen skal registreres som en single-page-application for bruk i klient-side-applikasjoner uten tilgang til hemmeligheter."]})]}),"\n",(0,i.jsxs)(r.p,{children:["F\xf8lgende eksempel oppretter app-registreringen ",(0,i.jsx)(r.code,{children:"atgcp1-sandbox:tilgangsstyring-main:test-app"}),".\nDen gir kun tilgang til direkte medlemmer av gruppene med objekt-ID ",(0,i.jsx)(r.a,{href:"https://portal.azure.com/#view/Microsoft_AAD_IAM/GroupDetailsMenuBlade/~/Overview/groupId/4bdc77ce-2a99-406c-a07e-88a1eba82dd9/menuId/",children:"4bdc77ce-2a99-406c-a07e-88a1eba82dd9"})," eller ",(0,i.jsx)(r.a,{href:"https://portal.azure.com/#view/Microsoft_AAD_IAM/GroupDetailsMenuBlade/~/Overview/groupId/1262b1c5-d2db-44ad-96e3-ed8637e6b996/menuId/",children:"1262b1c5-d2db-44ad-96e3-ed8637e6b996"}),".\nDen forh\xe5ndsautoriserer ogs\xe5 app-registration med navn ",(0,i.jsx)(r.code,{children:"atgcp1-dev:other-namespace:other-app"}),".\nN\xe5r registrering er fullf\xf8rt vil Azurerator opprette Kubernetes-hemmeligheten ",(0,i.jsx)(r.code,{children:"entraid-secret"})," i namespacet ",(0,i.jsx)(r.code,{children:"tilgangsstyring-main"}),"."]}),"\n",(0,i.jsx)(r.p,{children:"Hvis denne klientregistreringen skal brukes sammen med Ztoperator for \xe5 beskytte din applikasjon og eventuelt logge inn brukere,\ns\xe5 er det et par felt som m\xe5 konfigureres riktig."}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"spec.replyUrls"})," m\xe5 samsvare med ",(0,i.jsx)(r.code,{children:"spec.ingresses"})," i din Skiperator-",(0,i.jsx)(r.code,{children:"Application"})," og ",(0,i.jsx)(r.code,{children:"spec.autoLogin.redirectPath"})," i din Ztoperator-",(0,i.jsx)(r.code,{children:"AuthPolicy"}),"."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"spec.logoutUrl"})," m\xe5 matche ",(0,i.jsx)(r.code,{children:"spec.ingresses"})," i din Skiperator-",(0,i.jsx)(r.code,{children:"Application"}),"."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"spec.secretName"})," m\xe5 matche ",(0,i.jsx)(r.code,{children:"spec.oAuthCredentials"})," i Ztoperator-",(0,i.jsx)(r.code,{children:"AuthPolicy"}),"."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"spec.singlePageApplication"})," m\xe5 v\xe6re satt til ",(0,i.jsx)(r.code,{children:"false"})," ettersom Ztoperator ikke gjennomf\xf8rer innloggingsflyten i en offentlig klient."]}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'title="Klientregistrering mot Microsoft Entra ID med Azurerator"',children:"apiVersion: nais.io/v1\nkind: AzureAdApplication\nmetadata:\n  name: test-app\n  namespace: tilgangsstyring-main\nspec:\n  allowAllUsers: false\n  claims:\n    groups:\n      - id: 4bdc77ce-2a99-406c-a07e-88a1eba82dd9\n      - id: 1262b1c5-d2db-44ad-96e3-ed8637e6b996\n  replyUrls:\n    - url: https://test-app.atgcp1-sandbox.kartverket-intern.cloud/oauth2/callback\n  logoutUrl: https://test-app.atgcp1-sandbox.kartverket-intern.cloud/\n  preAuthorizedApplications:\n    - application: other-app\n      namespace: other-namespace\n      cluster: atgcp1-dev\n  secretName: entraid-secret\n  secretKeyPrefix: CUSTOM_PREFIX\n  secretProtected: true\n  singlePageApplication: false\n"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'title="Hemmelighet opprettet av Azurerator etter fullf\xf8rt klientregistrering"',children:"apiVersion: v1\nkind: Secret\nmetadata:\n  name: entraid-secret\n  namespace: tilgangsstyring-main\ndata:\n  AZURE_APP_CERTIFICATE_KEY_ID: ++++++++\n  AZURE_APP_CLIENT_ID: ++++++++\n  AZURE_APP_CLIENT_SECRET: ++++++++\n  AZURE_APP_JWK: ++++++++\n  AZURE_APP_JWKS: ++++++++\n  AZURE_APP_NEXT_CERTIFICATE_KEY_ID: ++++++++\n  AZURE_APP_NEXT_CLIENT_SECRET: ++++++++\n  AZURE_APP_NEXT_JWK: ++++++++\n  AZURE_APP_NEXT_PASSWORD_KEY_ID: ++++++++\n  AZURE_APP_PASSWORD_KEY_ID: ++++++++\n  AZURE_APP_PRE_AUTHORIZED_APPS: ++++++++\n  AZURE_APP_TENANT_ID: ++++++++\n  AZURE_APP_WELL_KNOWN_URL: ++++++++\n  AZURE_OPENID_CONFIG_ISSUER: ++++++++\n  AZURE_OPENID_CONFIG_JWKS_URI: ++++++++\n  AZURE_OPENID_CONFIG_TOKEN_ENDPOINT: ++++++++\ntype: Opaque\n"})})]})}function p(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},28453(e,r,n){n.d(r,{R:()=>l,x:()=>o});var t=n(96540);const i={},s=t.createContext(i);function l(e){const r=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),t.createElement(s.Provider,{value:r},e.children)}}}]);