"use strict";(globalThis.webpackChunkskip_docs=globalThis.webpackChunkskip_docs||[]).push([[9568],{26781(e,n,r){r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>p,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"applikasjon-utrulling/tilgangsstyring/SPIFFE/index","title":"SPIFFE","description":"Hva er SPIFFE","source":"@site/docs/03-applikasjon-utrulling/04-tilgangsstyring/03-SPIFFE/index.mdx","sourceDirName":"03-applikasjon-utrulling/04-tilgangsstyring/03-SPIFFE","slug":"/applikasjon-utrulling/tilgangsstyring/SPIFFE/","permalink":"/docs/applikasjon-utrulling/tilgangsstyring/SPIFFE/","draft":false,"unlisted":false,"editUrl":"https://github.com/kartverket/skip-docs/edit/main/docs/03-applikasjon-utrulling/04-tilgangsstyring/03-SPIFFE/index.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Test din Ztoperator-AuthPolicy","permalink":"/docs/applikasjon-utrulling/tilgangsstyring/ztoperator/test-authpolicy"},"next":{"title":"\ud83c\udfae skipctl","permalink":"/docs/applikasjon-utrulling/skipctl/"}}');var i=r(74848),t=r(28453);const l={},o="SPIFFE",a={},d=[{value:"Hva er SPIFFE",id:"hva-er-spiffe",level:2},{value:"Hvorfor SPIFFE",id:"hvorfor-spiffe",level:2},{value:"Hvordan SPIFFE",id:"hvordan-spiffe",level:2},{value:"Eksempel p\xe5 <code>DENY</code>-policy med <code>notPrincipals</code>",id:"eksempel-p\xe5-deny-policy-med-notprincipals",level:3},{value:"Eksempel p\xe5 <code>ALLOW</code>-policy med <code>principals</code>",id:"eksempel-p\xe5-allow-policy-med-principals",level:3}];function c(e){const n={admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"spiffe",children:"SPIFFE"})}),"\n",(0,i.jsx)(n.h2,{id:"hva-er-spiffe",children:"Hva er SPIFFE"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"SPIFFE"})," (",(0,i.jsx)(n.em,{children:"Secure Production Identity Framework For Everyone"}),") er en standard som kort forklart definerer:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["en identifikator, kalt ",(0,i.jsx)(n.code,{children:"SPIFFE ID"}),". Ved bruk av SPIFFE vil hver workload ha en unik SPIFFE ID"]}),"\n",(0,i.jsxs)(n.li,{children:["et verifikasjonsdokument, kalt ",(0,i.jsx)(n.code,{children:"SVID"})," (",(0,i.jsx)(n.em,{children:"SPIFFE Verifiable Identity Document"}),"). Workloads bruker SVID-en for \xe5\npresentere sin identitet for andre workloads"]}),"\n",(0,i.jsxs)(n.li,{children:["en mekanisme for \xe5 utstede SVID-er, kalt ",(0,i.jsx)(n.code,{children:"SPIFFE Workload API"}),". Workload-APIet utsteder SVID-er til workloads med en\ntilh\xf8rende kortlevd privat n\xf8kkel, samt en ",(0,i.jsx)(n.em,{children:"trust bundle"})," som inneholder de n\xf8dvendige sertifikatene for \xe5 verifisere\nSVID-er utstedt til andre workloads"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"SPIRE"})," (",(0,i.jsx)(n.em,{children:"SPIFFE Runtime Environment"}),") er en implementasjon av SPIFFE, som SKIP har innebygd st\xf8tte for via Istio."]}),"\n",(0,i.jsx)(n.h2,{id:"hvorfor-spiffe",children:"Hvorfor SPIFFE"}),"\n",(0,i.jsx)(n.p,{children:"For at applikasjoner p\xe5 SKIP skal kunne kommunisere sikkert med b\xe5de eksterne og interne tjenester er det flere\nsikkerhetsmekanismer i spill:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Applikasjoner er i utgangspunktet helt l\xe5st ned, og inng\xe5ende og utg\xe5ende nettverksregler m\xe5 defineres eksplisitt\nfor \xe5 kunne kommunisere med andre tjenester"}),"\n",(0,i.jsx)(n.li,{children:"Istio, som er v\xe5rt Service Mesh og kj\xf8rer som sidecar for alle pods, h\xe5ndterer mutual TLS p\xe5 vegne av\napplikasjonen. Dette sikrer kryptert trafikk mellom tjenester"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Network Policies p\xe5 Kubernetes tilbyr en del funksjonalitet p\xe5 niv\xe5 3 og 4 (ref. OSI-modellen), blant annet:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Label-basert tilgangskontroll, basert p\xe5 ",(0,i.jsx)(n.code,{children:"podSelector"})," og ",(0,i.jsx)(n.code,{children:"namespaceSelector"})]}),"\n",(0,i.jsx)(n.li,{children:"IP-/CIDR-basert tilgangskontroll"}),"\n",(0,i.jsx)(n.li,{children:"Begrensninger p\xe5 hvilke porter og protokoller som kan brukes"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["SPIFFE tilbyr derimot en del funksjonalitet som Network Policies ",(0,i.jsx)(n.em,{children:"ikke"})," tilbyr, ogs\xe5 p\xe5 niv\xe5 7, blant annet:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Begrense trafikk basert p\xe5 SPIFFE-identiteter"}),"\n",(0,i.jsx)(n.li,{children:"Begrense trafikk basert p\xe5 HTTP-verb og paths"}),"\n",(0,i.jsx)(n.li,{children:"Deny-regler, i motsetning til Network Policies som baserer seg p\xe5 kun Allow-regler"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"hvordan-spiffe",children:"Hvordan SPIFFE"}),"\n",(0,i.jsx)(n.admonition,{title:"Vi \xf8nsker \xe5 forenkle oppsett av SPIFFE p\xe5 SKIP",type:"tip",children:(0,i.jsxs)(n.p,{children:["P\xe5 sikt \xf8nsker vi \xe5 tilby et abstrasksjonslag som knytter oppsett av SPIFFE-regler tettere opp mot \xf8vrig konfigurasjon\nav applikasjoner p\xe5 SKIP, f.eks via ",(0,i.jsx)(n.code,{children:"argokit"}),", direkte i definisjon av Skiperator-applikasjoner, eller via en egen\n",(0,i.jsx)(n.em,{children:"custom resource"}),". Kom gjerne med innspill p\xe5 hvordan dette b\xf8r se ut i praksis!"]})}),"\n",(0,i.jsx)(n.admonition,{title:"SKIP st\xf8tter ikke SPIFFE p\xe5 tvers av Kubernetes-cluster",type:"warning",children:(0,i.jsx)(n.p,{children:"Dersom du har applikasjoner som prater sammen p\xe5 tvers av Kubernetes-cluster og \xf8nsker \xe5 bruke SPIFFE, ta gjerne kontakt\nmed Team Tilgangsstyring. Basert p\xe5 behov og ettersp\xf8rsel vil vi vurdere \xe5 tilby st\xf8tte for dette i fremtiden."})}),"\n",(0,i.jsxs)(n.p,{children:["For \xe5 definere SPIFFE-regler bruker vi Istio sine ",(0,i.jsx)(n.code,{children:"AuthorizationPolicy"}),"-ressurser. Disse kan defineres med enten ",(0,i.jsx)(n.code,{children:"DENY"}),"\neller ",(0,i.jsx)(n.code,{children:"ALLOW"})," som ",(0,i.jsx)(n.code,{children:"action"}),". F\xf8rstnevnte brukes gjerne sammen med ",(0,i.jsx)(n.code,{children:"notPrincipals"})," for \xe5 nekte tilgang for alle andre\nidentiteter enn den som spesifiseres, mens sistnevnte brukes sammen med ",(0,i.jsx)(n.code,{children:"principals"})," for \xe5 gi tilgang til spesifikke\nidentiteter. \xc5 beskytte et API med bruk av SPIFFE-regler vil gjerne inneb\xe6re en kombinasjon av ",(0,i.jsx)(n.code,{children:"ALLOW"}),"- og\n",(0,i.jsx)(n.code,{children:"DENY"}),"-regler."]}),"\n",(0,i.jsxs)(n.p,{children:["Dersom en foresp\xf8rsel matcher en ",(0,i.jsx)(n.code,{children:"DENY"}),"-regel vil den alltid bli avvist, uavhengig av eventuelle ",(0,i.jsx)(n.code,{children:"ALLOW"}),"-regler.\nDersom det eksisterer ",(0,i.jsx)(n.code,{children:"ALLOW"}),"-regler s\xe5 m\xe5 en foresp\xf8rsel matche minst \xe9n av disse for \xe5 bli tillatt."]}),"\n",(0,i.jsxs)(n.p,{children:["Eksemplene under viser hvordan AuthorizationPolicy-ressurser med SPIFFE-regler kan defineres. Principals og\nnotPrincipals spesifiseres p\xe5 formatet ",(0,i.jsx)(n.code,{children:"<cluster>/ns/<namespace>/sa/<serviceaccount>"}),". For kommunikasjon med\nidentiteter i sammen Kubernetes-cluster brukes ",(0,i.jsx)(n.code,{children:"cluster.local"})," som cluster-navn. En applikasjon sin ",(0,i.jsx)(n.em,{children:"Service Account"})," vil\nalltid ha samme navn som den tilh\xf8rende Skiperator-applikasjonen. For applikasjoner p\xe5 SKIP vil alts\xe5 principals v\xe6re\np\xe5 formatet ",(0,i.jsx)(n.code,{children:"cluster.local/ns/<namespace>/sa/<app-name>"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["I definisjon av paths brukes wildcards ",(0,i.jsx)(n.code,{children:"{*}"})," og ",(0,i.jsx)(n.code,{children:"{**}"})," for \xe5 matche hhv. ett eller flere path-segmenter. Sistnevnte kan\nkun opptre i slutten av en path, mens f\xf8rstnevnte kan opptre hvor som helst i pathen. Wildcard-operatorene kan ikke\nopptre sammen med andre tegn i samme path-segment, dvs. ",(0,i.jsx)(n.code,{children:"/foo/bar/{*}"})," er gyldig, mens ",(0,i.jsx)(n.code,{children:"/foo/bar{*}"})," er ikke er gyldig."]}),"\n",(0,i.jsxs)(n.h3,{id:"eksempel-p\xe5-deny-policy-med-notprincipals",children:["Eksempel p\xe5 ",(0,i.jsx)(n.code,{children:"DENY"}),"-policy med ",(0,i.jsx)(n.code,{children:"notPrincipals"})]}),"\n",(0,i.jsxs)(n.p,{children:["Eksemplet avviser alle foresp\xf8rsler mot ",(0,i.jsx)(n.code,{children:"/secure{**}"}),", unntatt de som kommer fra ",(0,i.jsx)(n.code,{children:"other-app"})," sin SPIFFE-identitet."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: security.istio.io/v1\nkind: AuthorizationPolicy\nmetadata:\n  name: my-app\n  namespace: my-namespace\nspec:\n  selector:\n    matchLabels:\n      app: my-app\n  action: DENY\n  rules:\n    - from:\n      - source:\n          notPrincipals:\n            - cluster.local/ns/<other-app-namespace>/sa/<other-app>\n      to:\n        - operation:\n            paths:\n              - /secure/{**}\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"eksempel-p\xe5-allow-policy-med-principals",children:["Eksempel p\xe5 ",(0,i.jsx)(n.code,{children:"ALLOW"}),"-policy med ",(0,i.jsx)(n.code,{children:"principals"})]}),"\n",(0,i.jsxs)(n.p,{children:["Eksemplet gir ",(0,i.jsx)(n.code,{children:"other-app-with-full-access"})," tilgang med alle HTTP-verb, mens ",(0,i.jsx)(n.code,{children:"other-app-with-only-get-access"})," kun f\xe5r\ntilgang til GET-foresp\xf8rsler. I tillegg tillater den alle foresp\xf8rsler til ",(0,i.jsx)(n.code,{children:"/public"})," og alle under-stier, uavhengig av\nidentitet."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: security.istio.io/v1\nkind: AuthorizationPolicy\nmetadata:\n  name: my-app\n  namespace: my-namespace\nspec:\n  selector:\n    matchLabels:\n      app: my-app\n  action: ALLOW\n  rules:\n    - from:\n      - source:\n          principals:\n            - cluster.local/ns/<other-app-namespace>/sa/<other-app-with-full-access>\n    - from:\n      - source:\n          principals:\n            - cluster.local/ns/<other-app-namespace>/sa/<other-app-with-only-get-access>\n      to:\n        - operation:\n            methods:\n              - GET\n    - to:\n      - operation:\n          methods:\n            - GET\n          paths:\n            - /public/{**}\n"})})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},28453(e,n,r){r.d(n,{R:()=>l,x:()=>o});var s=r(96540);const i={},t=s.createContext(i);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);