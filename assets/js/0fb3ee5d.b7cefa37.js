"use strict";(self.webpackChunkskip_docs=self.webpackChunkskip_docs||[]).push([[6981],{32269:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>a,toc:()=>d});var s=n(74848),t=n(28453);const i={},o="Retningslinjer for Kubernetes",a={id:"kubernetes/retningslinjer-for-kubernetes",title:"Retningslinjer for Kubernetes",description:"Minstekrav for sikkerhet",source:"@site/docs/06-kubernetes/03-retningslinjer-for-kubernetes.md",sourceDirName:"06-kubernetes",slug:"/kubernetes/retningslinjer-for-kubernetes",permalink:"/docs/kubernetes/retningslinjer-for-kubernetes",draft:!1,unlisted:!1,editUrl:"https://github.com/kartverket/skip-docs/edit/main/docs/06-kubernetes/03-retningslinjer-for-kubernetes.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Jobbe med Kubernetes cluster",permalink:"/docs/kubernetes/jobbe-med-cluster"},next:{title:"Bruk av porter i pods",permalink:"/docs/kubernetes/bruk-av-porter-i-pods"}},l={},d=[{value:"Minstekrav for sikkerhet",id:"minstekrav-for-sikkerhet",level:2},{value:"Namespaces som avgrensning mellom teams",id:"namespaces-som-avgrensning-mellom-teams",level:2},{value:"Ressursbruk i Kubernetes",id:"ressursbruk-i-kubernetes",level:2}];function m(e){const r={a:"a",admonition:"admonition",h1:"h1",h2:"h2",li:"li",p:"p",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.h1,{id:"retningslinjer-for-kubernetes",children:"Retningslinjer for Kubernetes"}),"\n",(0,s.jsx)(r.h2,{id:"minstekrav-for-sikkerhet",children:"Minstekrav for sikkerhet"}),"\n",(0,s.jsxs)(r.p,{children:['I Kubernetes bruker vi Pod Security Standards for \xe5 sikre at alle pods som kj\xf8rer i clusteret v\xe5rt er sikre. Dette er en standard som er satt av CNCF, og som vi f\xf8lger for \xe5 sikre at vi ikke har noen \xe5penbare sikkerhetshull i Kubernetes-clusteret v\xe5rt. Alle workloads skal f\xf8lge PSS niv\xe5 "restricted", som er et niv\xe5 som f\xf8lger dagens best practices for sikring av containere. Applikasjoner som kj\xf8rer som Skiperator Applications f\xf8lger allerede denne standarden. Les mer om ',(0,s.jsx)(r.a,{href:"https://kubernetes.io/docs/concepts/security/pod-security-standards",children:"Pod Security Standards her"}),"."]}),"\n",(0,s.jsx)(r.h2,{id:"namespaces-som-avgrensning-mellom-teams",children:"Namespaces som avgrensning mellom teams"}),"\n",(0,s.jsxs)(r.p,{children:["Hvert team kan lage s\xe5 mange Namespaces som de har behov for. Dette er for \xe5 kunne skille p\xe5 ressurser og tilganger mellom forskjellige applikasjoner og team. Dette er ogs\xe5 for \xe5 kunne gi teamene mulighet til \xe5 eksperimentere og teste ting uten at det p\xe5virker andre team. Les mer om dette p\xe5 ",(0,s.jsx)(r.a,{href:"../argo-cd",children:"Argo CD"}),"."]}),"\n",(0,s.jsxs)(r.p,{children:["Kommunikasjon mellom tjenester internt i ett namespace er helt lukket (\u201cdefault deny\u201d-policy), og det er opp til teamet selv \xe5 s\xf8rge for \xe5 \xe5pne for kommunikasjon mellom tjenester. Les mer om dette p\xe5 ",(0,s.jsx)(r.a,{href:"https://github.com/kartverket/skiperator",children:"Skiperator"}),"."]}),"\n",(0,s.jsxs)(r.p,{children:["Informasjon om kommunikasjon mot tjenester som ligger i andre namespaces finnes her: ",(0,s.jsx)(r.a,{href:"https://kartverket.atlassian.net/wiki/spaces/SKIP/pages/305956270/Anthos+Service+Mesh+Brukerdokumentasjon",children:"Anthos Service Mesh Brukerdokumentasjon"})]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Tjenester og fellesfunksjoner som brukes av flere teams skal settes i egne namespaces. Tilgang til disse namespacene gis ved at det opprettes en ny gruppe i AD p\xe5 samme m\xe5te som et produktteam."}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"ressursbruk-i-kubernetes",children:"Ressursbruk i Kubernetes"}),"\n",(0,s.jsx)(r.p,{children:"Ressursbruk i Kubernetes dreier seg om hvor mye CPU og RAM hver pod skal bruke."}),"\n",(0,s.jsx)(r.p,{children:"Requests er hvor mye CPU og minne hvercontainersp\xf8r om n\xe5r den f\xf8rst settes p\xe5 en node. Hvis man for eksempel ber om 500 mCPUer, men noden bare har 250 mCPU ledig, kan containeres ikke kj\xf8res p\xe5 den noden."}),"\n",(0,s.jsx)(r.p,{children:"Merk at man kan spesifisere CPU helt ned i millicpuer (mCPU)."}),"\n",(0,s.jsxs)(r.p,{children:["Minne-requests kan settes i mange forskjellige enheter, se ",(0,s.jsx)(r.a,{href:"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/",children:"dokumentasjonen"})," for detaljer. Vi anbefaler dog at man holder seg til M - megabytes."]}),"\n",(0,s.jsx)(r.p,{children:"Limits er hvor mye ressurser en container maksimalt f\xe5r lov til \xe5 bruke. Dette er med andre ord noe som settes for \xe5 forhindre at en container med en bug tar over alle ressursene, og gj\xf8r det umulig for andre containere \xe5 skalere."}),"\n",(0,s.jsx)(r.p,{children:"Vi anbefaler at du ser p\xe5 Limiten som en mulighet til \xe5 finne bugs og memory leaks. Sett den s\xe5 lavt du er komfortabel med, og f\xf8lg med p\xe5 det faktiske forbruket. Hvis noe kr\xe6sjer er det da god sjanse for at det ble innf\xf8rt en bug."}),"\n",(0,s.jsx)(r.p,{children:"Dersom det faktiske forbruket n\xe6rmer seg limiten p\xe5 grunn av naturlige grunner - flere requests eller tyngre load+ er det p\xe5 tide \xe5 \xf8ke limiten. Ikke vent til appliasjonen kr\xe6sjer - det skaper en d\xe5rlig brukeropplevelse."}),"\n",(0,s.jsx)(r.admonition,{type:"tip",children:(0,s.jsx)(r.p,{children:"En god tommelfingerregel for requests og limits er f\xf8lgende: For minne b\xf8r man profilere applikasjonens gjennomsnittlige minnebruk og doble denne som limit. For CPU trenger man ikke limit, men heller definere en fornuftig request."})}),"\n",(0,s.jsx)(r.p,{children:"Logikken bak dette er at dersom en applikasjon bruker altfor mye minne kan det f\xf8re til at andre applikasjoner g\xe5r ned. Dersom en applikasjon bruker mye CPU f\xf8rer det derimot bare i verste fall til at ting g\xe5r tregere."}),"\n",(0,s.jsx)(r.p,{children:"Dette er reglene for ressursbruk i Kubernetes p\xe5 SKIP"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:"Produktteamet velger selv hva som er naturlig ressursbruk for sine containere, og skal ha et bevisst forhold til hvilke grenser som er satt."}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:"Produktteamet skal f\xf8lge med p\xe5 ressursbruken over tid, og oppdatere grensene slik at de til enhver tid reflekterer hva applikasjonen faktisk trenger."}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:"Resource requests og limits skal settes p\xe5 alle containere slik at det blir tydelig hva som er forventet ressursbruk."}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:"Resource limits skal skal alltid settes h\xf8yere enn requests, men aldri unaturlig h\xf8yt. Husk at dette fungerer b\xe5de som dokumentasjon og som en sikring mot bugs og feilkonfigurasjon."}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:"Resource limits skal aldri fjernes permanent, men kan fjernes for debugging. Da skal SKIP-teamet gj\xf8res oppmerksom p\xe5 dette."}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.a,{href:"https://akobor.me/posts/heap-size-and-resource-limits-in-kubernetes-for-jvm-applications",children:"Godt blogginnlegg om korrelasjonen mellom JVMs og Kubernetes\u2019 minnebruk"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.a,{href:"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/",children:"Kubernetes\u2019 dokumentasjon om ressursbruk"})}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.a,{href:"https://cloud.google.com/architecture/best-practices-for-running-cost-effective-kubernetes-applications-on-gke#set_appropriate_resource_requests_and_limits",children:"Google Clouds dokumentasjon om \u201ccost effective apps\u201d"})," (Merk at Google anbefaler \xe5 sette limit til det samme som requests - vi setter driftsstabilitet over kostnad, og er derfor uenig i dette.)"]})]})}function u(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(m,{...e})}):m(e)}},28453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>a});var s=n(96540);const t={},i=s.createContext(t);function o(e){const r=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(i.Provider,{value:r},e.children)}}}]);