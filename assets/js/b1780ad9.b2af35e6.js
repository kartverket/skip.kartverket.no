"use strict";(self.webpackChunkskip_docs=self.webpackChunkskip_docs||[]).push([[5533],{30972:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>g});const s=JSON.parse('{"id":"applikasjon-utrulling/github-actions/pharos","title":"Sikkerhetsscanning med Pharos","description":"Pharos er en GitHub action som forenkler statisk skanning av konfigurasjon og container images.","source":"@site/docs/03-applikasjon-utrulling/08-github-actions/pharos.md","sourceDirName":"03-applikasjon-utrulling/08-github-actions","slug":"/applikasjon-utrulling/github-actions/pharos","permalink":"/docs/applikasjon-utrulling/github-actions/pharos","draft":false,"unlisted":false,"editUrl":"https://github.com/kartverket/skip-docs/edit/main/docs/03-applikasjon-utrulling/08-github-actions/pharos.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Kubectl fra GitHub Actions","permalink":"/docs/applikasjon-utrulling/github-actions/kubectl-fra-github"},"next":{"title":"Tilgang til on-prem infrastruktur fra GitHub Actions","permalink":"/docs/applikasjon-utrulling/github-actions/tilgang-til-on-prem-infrastruktur-fra-github-actions"}}');var a=r(74848),t=r(28453);const i={},o="Sikkerhetsscanning med Pharos",l={},g=[{value:"Eksempler",id:"eksempler",level:2},{value:"Kj\xf8r skannere en gang i d\xf8gnet",id:"kj\xf8r-skannere-en-gang-i-d\xf8gnet",level:3},{value:"Kj\xf8r skannere for hver gang et nytt image bygges",id:"kj\xf8r-skannere-for-hver-gang-et-nytt-image-bygges",level:3},{value:"Konfigurasjon av skannere",id:"konfigurasjon-av-skannere",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"sikkerhetsscanning-med-pharos",children:"Sikkerhetsscanning med Pharos"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://github.com/kartverket/pharos",children:"Pharos"})," er en GitHub action som forenkler statisk skanning av konfigurasjon og container images."]}),"\n",(0,a.jsx)(n.p,{children:"Det er anbefalt \xe5 skanne images minst en gang i d\xf8gnet og ved bygging av images fra hovedbranchen."}),"\n",(0,a.jsxs)(n.p,{children:["For \xe5 f\xe5 Pharos-oppdateringer automatisk er det anbefalt \xe5 sette opp ",(0,a.jsx)(n.a,{href:"../07-github/06-dependabot.md",children:"Dependabot"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"eksempler",children:"Eksempler"}),"\n",(0,a.jsx)(n.h3,{id:"kj\xf8r-skannere-en-gang-i-d\xf8gnet",children:"Kj\xf8r skannere en gang i d\xf8gnet"}),"\n",(0,a.jsxs)(n.p,{children:["Scanning en gang i d\xf8gnet kan se ut som eksempelet under. Merk at ",(0,a.jsx)(n.code,{children:"matrix"})," er brukt for \xe5 scanne flere images i parallel, men det er ikke n\xf8dvendig for repoer med kun ett image:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"name: Sikkerhetsscanning av images\n\non:\n  schedule:\n    - cron: '00 5 * * *'  # 05:00 UTC each day. \n\nenv:\n  registry: ghcr.io\n\njobs:\n  pharos:\n    name: Run Pharos\n    runs-on: ubuntu-latest\n    strategy:\n      fail-fast: false    # De andre jobbene i matrisen vil kj\xf8re selv om en av dem feiler\n      matrix:\n        package-name: [ 'image1', 'image2', 'image3', 'image4' ]\n\n    # Permissions p\xe5krevd av pharos\n    permissions:\n      actions: read\n      packages: read\n      contents: read\n      security-events: write\n\n    steps:\n      - name: Run Pharos\n        uses: kartverket/pharos@v0.2.5\n        with:\n          trivy_category: ${{ matrix.package-name }}\n          image_url: ${{ env.registry }}/${{ github.repository_owner }}/${{ matrix.package-name }}:latest\n\n"})}),"\n",(0,a.jsx)(n.h3,{id:"kj\xf8r-skannere-for-hver-gang-et-nytt-image-bygges",children:"Kj\xf8r skannere for hver gang et nytt image bygges"}),"\n",(0,a.jsxs)(n.p,{children:['Det er lurt \xe5 skanne images ved hvert push til hovedbranchen. Da m\xe5 imaget pushes f\xf8rst, og s\xe5 kan det skannes av Pharos. Det er anbefalt \xe5 kj\xf8re scanning for push til hovedbranchen, og ikke ved f.eks. push til tag. Om scanning kj\xf8res ved push til hovebranchen for repoet blir "Code scanning"-oversikten blir intuitiv og resultatene dukker ogs\xe5 opp i sikkerhetsmetrikkerverkt\xf8yet i ',(0,a.jsx)(n.a,{href:"https://kartverket.dev/",children:"Utviklerportalen"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"on:\n  push:\n    branches:\n      - main\n\nenv:\n  image_name: ghcr.io/${{ github.repository }} # ghcr.io/kartverket/repo-name\n\njobs:\n  build:\n    steps:\n      # Most steps skipped for brevity\n      - name: Build and push container image\n        id: build-image\n        uses: docker/build-push-action@v6\n        with:\n          push: true # Image must be pushed before scanning\n          tags: ${{ env.image_name }}:latest\n          # Remaining properties skipped for brevity\n\n    outputs:\n      image_digest: ${{ steps.build-image.outputs.image_digest }}\n\n  run-pharos:\n    name: Run Pharos\n    runs-on: ubuntu-latest\n    # Only run on pushes to default branch\n    if: github.event_name == 'push' && github.ref_name == github.event.repository.default_branch\n    permissions:\n      actions: read\n      packages: read\n      contents: read\n      security-events: write\n    steps:\n      - name: \"Run Pharos\"\n        uses: kartverket/pharos@v0.2.5\n        with:\n          image_url: ${{ env.image_name }}@${{ needs.build.outputs.image_digest }}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"konfigurasjon-av-skannere",children:"Konfigurasjon av skannere"}),"\n",(0,a.jsxs)(n.p,{children:["Konfigurasjonsskanning gj\xf8res automatisk om det ikke skrus av. Da vil bl.a. ",(0,a.jsx)(n.code,{children:"Dockerfile"})," og Terraform-kode skannes. Skanning av container images gj\xf8res automatisk om ",(0,a.jsx)(n.code,{children:"image_url"})," er spesifisert."]}),"\n",(0,a.jsxs)(n.p,{children:["Workflowen vil feile om s\xe5rbarheter vurdert som ",(0,a.jsx)(n.code,{children:"high"})," eller ",(0,a.jsx)(n.code,{children:"critical"})," finnes. Dette kan konfigureres enten ved \xe5 sette ",(0,a.jsx)(n.code,{children:"allow_serverity_level"})," til ",(0,a.jsx)(n.code,{children:"high"})," eller ",(0,a.jsx)(n.code,{children:"critical"}),", eller med \xe5 sette ",(0,a.jsx)(n.code,{children:"disable_serverity_check"})," til false."]}),"\n",(0,a.jsxs)(n.p,{children:["For mer informasjon, se p\xe5 ",(0,a.jsx)(n.a,{href:"https://github.com/kartverket/pharos?tab=readme-ov-file#inputs",children:"dokumentasjonen for konfigurerbare inputs"}),"."]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>o});var s=r(96540);const a={},t=s.createContext(a);function i(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);