"use strict";(self.webpackChunkskip_docs=self.webpackChunkskip_docs||[]).push([[5020],{32431:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>h,contentTitle:()=>c,default:()=>j,frontMatter:()=>a,metadata:()=>s,toc:()=>p});const s=JSON.parse('{"id":"applikasjon-utrulling/tilgangsstyring/token-validering","title":"\ud83d\udee1\ufe0f Token-validering og grovkornet autorisasjon","description":"SKIP tilbyr innebygd st\xf8tte for \xe5 sette opp Kubernetes-ressurser som kan validere autentisiteten og autorisasjonen p\xe5","source":"@site/docs/03-applikasjon-utrulling/04-tilgangsstyring/02-token-validering.mdx","sourceDirName":"03-applikasjon-utrulling/04-tilgangsstyring","slug":"/applikasjon-utrulling/tilgangsstyring/token-validering","permalink":"/docs/applikasjon-utrulling/tilgangsstyring/token-validering","draft":false,"unlisted":false,"editUrl":"https://github.com/kartverket/skip-docs/edit/main/docs/03-applikasjon-utrulling/04-tilgangsstyring/02-token-validering.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\ud83d\udcdd Klientregistrering","permalink":"/docs/applikasjon-utrulling/tilgangsstyring/klientregistrering"},"next":{"title":"\ud83d\udd11 Auto-login","permalink":"/docs/applikasjon-utrulling/tilgangsstyring/auto-login"}}');var i=n(74848),t=n(28453),o=n(11470),l=n(19365),d=n(27293);const a={},c="\ud83d\udee1\ufe0f Token-validering og grovkornet autorisasjon",h={},p=[{value:"\ud83e\uddfeSpesifikasjonen til <code>AuthPolicy</code>",id:"spesifikasjonen-til-authpolicy",level:3},{value:"\ud83d\udcd6 Eksempler",id:"-eksempler",level:2}];function g(e){const r={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components},{Details:s}=r;return s||function(e,r){throw new Error("Expected "+(r?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"\ufe0f-token-validering-og-grovkornet-autorisasjon",children:"\ud83d\udee1\ufe0f Token-validering og grovkornet autorisasjon"})}),"\n",(0,i.jsxs)(r.p,{children:["SKIP tilbyr innebygd st\xf8tte for \xe5 sette opp Kubernetes-ressurser som kan validere autentisiteten og autorisasjonen p\xe5\ninkommende requests f\xf8r den i det hele tatt n\xe5r applikasjonen. Dette er mulig fordi SKIP benytter seg av ",(0,i.jsx)(r.a,{href:"https://istio.io/",children:"Istio"})," som service mesh\nog instruerer Istio til \xe5 sette opp en ",(0,i.jsx)(r.a,{href:"https://istio.io/latest/docs/reference/config/networking/sidecar/",children:"Istio-sidecar"}),"\ni hver ",(0,i.jsx)(r.code,{children:"pod"}),"."]}),"\n",(0,i.jsxs)(r.p,{children:["Fordelen med at hver ",(0,i.jsx)(r.code,{children:"pod"})," har en ",(0,i.jsx)(r.code,{children:"istio-sidecar"})," er at Istio introduserer flere nyttige CRD-er som kan berike kapabilitetene\ntil ",(0,i.jsx)(r.code,{children:"istio-sidecar"}),". To av disse CRD-ene er ",(0,i.jsx)(r.a,{href:"https://istio.io/latest/docs/reference/config/security/request_authentication/",children:(0,i.jsx)(r.code,{children:"RequestAuthentication"})}),"\nog ",(0,i.jsx)(r.a,{href:"https://istio.io/latest/docs/reference/config/security/authorization-policy/",children:(0,i.jsx)(r.code,{children:"AuthorizationPolicy"})}),", som blant annet kan brukes til \xe5 validere tokens (JWT) til innkommende requests og autorisere tilgang basert p\xe5 claims."]}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.img,{alt:"Istio Sidecar Container Architecture",src:n(17792).A+"",width:"1141",height:"456"}),"\n",(0,i.jsxs)(r.em,{children:["Kilde: ",(0,i.jsx)(r.a,{href:"https://kubebyexample.com/learning-paths/istio/intro",children:"Kube by Example"})]})]}),"\n",(0,i.jsxs)(r.p,{children:["SKIP benytter seg av kubernetes operatoren ",(0,i.jsx)(r.a,{href:"https://github.com/kartverket/ztoperator",children:"Ztoperator"})," for \xe5 h\xe5ndheve token-validering og grovkornet autorisasjon for tjenester som kj\xf8rer p\xe5 SKIP."]}),"\n",(0,i.jsxs)(r.p,{children:["Hvis man \xf8nsker \xe5 benytte seg av SKIP sin l\xf8sning for \xe5 sette opp token-validering og grovkornet autorisasjon, har man to valg.\nMan kan benytte seg av ",(0,i.jsx)(r.a,{href:"/docs/applikasjon-utrulling/skiperator/",children:"Skiperator"})," dersom man \xf8nsker \xe5 holde konfigurasjonen n\xe6r Skiperator-manifestet.\nAlternativt kan man bruke CRD-en fra ",(0,i.jsx)(r.a,{href:"https://github.com/kartverket/ztoperator",children:"Ztoperator"})," direkte."]}),"\n",(0,i.jsx)(r.p,{children:"Felles for begge alternativene er at de bygger inn to prinsipper i hvordan token-validering og grovkornet autorisasjon settes opp."}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Gyldig JWT by default"}),": Med mindre endepunkt er eksplisitt spesifisert som \xe5pne ",(0,i.jsx)(r.em,{children:"m\xe5"}),"\ninnkommende request ha en gyldig JWT."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Trygge standardinnstillinger"}),": Hvis man ved en feil spesifiserer et endepunkt som b\xe5de \xe5pent og autorisert, vil foresp\xf8rselen som standard kreve et gyldig og autorisert JWT."]}),"\n"]}),"\n",(0,i.jsxs)(o.A,{groupId:"operator",children:[(0,i.jsx)(l.A,{value:"skiperator",label:"Skiperator",children:(0,i.jsxs)(r.p,{children:["\ud83d\udea7 ",(0,i.jsx)(r.strong,{children:"UNDER UTVIKLING"})," \ud83d\udea7",(0,i.jsx)("br",{}),"\nSt\xf8tte for \xe5 sette opp token-validering og grovkornet autorisasjon via Skiperator-manifestet er under utvikling og er forel\xf8pig ikke tilgjengelig."]})}),(0,i.jsxs)(l.A,{value:"ztoperator",label:"Ztoperator",children:[(0,i.jsxs)(r.p,{children:["Ztoperator introduserer CRD-en ",(0,i.jsx)(r.code,{children:"AuthPolicy"}),", som har i oppgave \xe5 sette opp token-validering og grovkornet autorisasjon.\n",(0,i.jsx)(r.code,{children:"AuthPolicy"})," har som hovedoppgave \xe5 opprette Istio-ressursene ",(0,i.jsx)(r.code,{children:"RequestAuthentication"})," og ",(0,i.jsx)(r.code,{children:"AuthorizationPolicy"}),"\np\xe5 en m\xe5te som f\xf8lger brukerens definerte ",(0,i.jsx)(r.em,{children:"regler"}),", samtidig som de to prinsippene nevnt ovenfor ivaretas."]}),(0,i.jsxs)(r.p,{children:["Hvilken workload reglene definert i en ",(0,i.jsx)(r.code,{children:"AuthPolicy"})," skal gjelde for spesifiseres ved \xe5 referere til ",(0,i.jsx)(r.em,{children:"labels"}),"."]}),(0,i.jsx)(d.A,{type:"tip",title:"Visste du at...",children:(0,i.jsxs)(r.p,{children:["Hvis du har en Skiperator-applikasjon med navn ",(0,i.jsx)(r.code,{children:"some-application"})," vil den f\xe5 labelen ",(0,i.jsx)(r.code,{children:"app: some-application"}),"."]})}),(0,i.jsxs)(r.h3,{id:"spesifikasjonen-til-authpolicy",children:["\ud83e\uddfeSpesifikasjonen til ",(0,i.jsx)(r.code,{children:"AuthPolicy"})]}),(0,i.jsxs)(s,{children:[(0,i.jsxs)("summary",{children:[(0,i.jsx)("strong",{children:"spec"})," ",(0,i.jsx)(r.em,{children:"(object, required)"})," \u2013 Spesifikasjon for ",(0,i.jsx)(r.code,{children:"AuthPolicy"})]}),(0,i.jsxs)(s,{children:[(0,i.jsxs)("summary",{children:[(0,i.jsx)("strong",{children:"rules"})," ",(0,i.jsx)(r.em,{children:"([]object, required)"})," \u2013 Regler som bestemmer hvordan innkommende foresp\xf8rsler skal tillates eller avvises basert p\xe5 JWT-validering."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"enabled"})," ",(0,i.jsx)(r.em,{children:"(boolean, required)"})," \u2013 Angir om JWT-validering skal v\xe6re aktivert. Hvis aktivert, vil innkommende JWT-er bli validert mot spesifisert utsteder og audience."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"issuerURI"})," ",(0,i.jsx)(r.em,{children:"(string, required)"})," \u2013 Forventet ",(0,i.jsx)(r.code,{children:"iss"}),"-claim i JWT. M\xe5 samsvare med den som ble brukt da tokenet ble utstedt."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"jwksURI"})," ",(0,i.jsx)(r.em,{children:"(string, required)"})," \u2013 URI for \xe5 hente JWKS (n\xf8kkelsett brukt til \xe5 verifisere JWT-signatur)."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"audience"})," ",(0,i.jsx)(r.em,{children:"([]string, required)"})," \u2013 Liste med aksepterte ",(0,i.jsx)(r.code,{children:"aud"}),"-verdier i JWT. Minst \xe9n verdi m\xe5 finnes i tokenet for at det skal v\xe6re gyldig."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"forwardJwt"})," ",(0,i.jsx)(r.em,{children:"(boolean, optional)"})," \u2013 Hvis satt til ",(0,i.jsx)(r.code,{children:"true"}),", videresendes den originale JWT-en. Standard er ",(0,i.jsx)(r.code,{children:"true"}),"."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"fromCookies"})," ",(0,i.jsx)(r.em,{children:"([]string, optional)"})," \u2013 Lister hvilke cookies som skal unders\xf8kes for JWT."]}),(0,i.jsxs)(s,{children:[(0,i.jsxs)("summary",{children:[(0,i.jsx)("strong",{children:"outputClaimToHeaders"})," ",(0,i.jsx)(r.em,{children:"([]object, optional)"})," \u2013 Definerer hvordan claims fra verifisert JWT skal kopieres til HTTP-headere. St\xf8tter enkle og n\xf8stede verdier av typen ",(0,i.jsx)(r.code,{children:"string"}),", ",(0,i.jsx)(r.code,{children:"int"})," eller `bool."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"claim"})," ",(0,i.jsx)(r.em,{children:"(string, required)"})," \u2013 Navn p\xe5 claimet som skal hentes fra JWT."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"header"})," ",(0,i.jsx)(r.em,{children:"(string, required)"})," \u2013 Navn p\xe5 HTTP-headeren som skal inneholde claim-verdien."]})]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"acceptedResources"})," ",(0,i.jsx)(r.em,{children:"([]string, optional)"})," \u2013 Liste med ressursindikatorer som m\xe5 finnes i JWT (",(0,i.jsx)(r.code,{children:"aud"}),"). F\xf8lger ",(0,i.jsx)("a",{href:"https://datatracker.ietf.org/doc/html/rfc8707",target:"_blank",rel:"noopener noreferrer",children:"RFC8707"}),". M\xe5 v\xe6re gyldige URI-er."]}),(0,i.jsxs)(s,{children:[(0,i.jsxs)("summary",{children:[(0,i.jsx)("strong",{children:"authRules"})," ",(0,i.jsx)(r.em,{children:"([]object, optional)"})," \u2013 Regler for \xe5 tillate HTTP-foresp\xf8rsler basert p\xe5 p\xe5stander i JWT."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"paths"})," ",(0,i.jsx)(r.em,{children:"([]string, required)"})," \u2013 Stier regelen skal gjelde for. M\xe5 starte med ",(0,i.jsx)(r.code,{children:"/"}),", ikke slutte med ",(0,i.jsx)(r.code,{children:"/"}),", og kan avsluttes med ",(0,i.jsx)(r.code,{children:"*"})," som wildcard-operator."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"methods"})," ",(0,i.jsx)(r.em,{children:"([]string, optional)"})," \u2013 HTTP-metoder som regelen gjelder for. Hvis ikke angitt, tillates alle metoder. Tillatte metoder er ",(0,i.jsx)(r.code,{children:"GET"}),", ",(0,i.jsx)(r.code,{children:"POST"}),", ",(0,i.jsx)(r.code,{children:"PUT"}),", ",(0,i.jsx)(r.code,{children:"PATCH"}),", ",(0,i.jsx)(r.code,{children:"DELETE"}),", ",(0,i.jsx)(r.code,{children:"HEAD"}),", ",(0,i.jsx)(r.code,{children:"OPTIONS"}),", ",(0,i.jsx)(r.code,{children:"TRACE"}),", ",(0,i.jsx)(r.code,{children:"CONNECT"}),"."]}),(0,i.jsxs)(s,{children:[(0,i.jsxs)("summary",{children:[(0,i.jsx)("strong",{children:"when"})," ",(0,i.jsx)(r.em,{children:"([]object, required)"})," \u2013 Tilleggskrav basert p\xe5 JWT-claims. Foresp\xf8rselen tillates hvis minst ett av tilleggskravene er oppfylt."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"claim"})," ",(0,i.jsx)(r.em,{children:"(string, required)"})," \u2013 Navnet p\xe5 JWT-claimet som skal kontrolleres."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"values"})," ",(0,i.jsx)(r.em,{children:"([]string, required)"})," \u2013 Verdier som claimet m\xe5 inneholde for \xe5 v\xe6re gyldig. Tilleggskravet er m\xf8tt hvis claimet fra JWT inneholder \xe9n eller flere av disse verdiene (OR-logikk)."]})]})]}),(0,i.jsxs)(s,{children:[(0,i.jsxs)("summary",{children:[(0,i.jsx)("strong",{children:"ignoreAuthRules"})," ",(0,i.jsx)(r.em,{children:"([]object, optional)"})," \u2013 Definerer hvilke foresp\xf8rsler som ikke krever JWT-autentisering."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"paths"})," ",(0,i.jsx)(r.em,{children:"([]string, required)"})," \u2013 Stier regelen skal gjelde for. M\xe5 starte med ",(0,i.jsx)(r.code,{children:"/"}),", ikke slutte med ",(0,i.jsx)(r.code,{children:"/"}),", og kan avsluttes med ",(0,i.jsx)(r.code,{children:"*"})," som wildcard-operator."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"methods"})," ",(0,i.jsx)(r.em,{children:"([]string, optional)"})," \u2013 HTTP-metoder som regelen gjelder for. Hvis ikke angitt, tillates alle metoder. Tillatte metoder er ",(0,i.jsx)(r.code,{children:"GET"}),", ",(0,i.jsx)(r.code,{children:"POST"}),", ",(0,i.jsx)(r.code,{children:"PUT"}),", ",(0,i.jsx)(r.code,{children:"PATCH"}),", ",(0,i.jsx)(r.code,{children:"DELETE"}),", ",(0,i.jsx)(r.code,{children:"HEAD"}),", ",(0,i.jsx)(r.code,{children:"OPTIONS"}),", ",(0,i.jsx)(r.code,{children:"TRACE"}),", ",(0,i.jsx)(r.code,{children:"CONNECT"}),"."]})]})]}),(0,i.jsxs)(s,{children:[(0,i.jsxs)("summary",{children:[(0,i.jsx)("strong",{children:"selector"})," ",(0,i.jsx)(r.em,{children:"(object, required)"})," \u2013 Bestemmer hvilke workloads policyen skal gjelde for."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"matchLabels"})," ",(0,i.jsx)(r.em,{children:"(map[string]string, optional)"})," \u2013 Et sett med labels som brukes til \xe5 identifisere hvilke workloads policyen skal gjelde for. Gjelder bare innenfor samme namespace. Label-n\xf8kler kan ikke v\xe6re tomme eller inneholde wildcard-tegn."]})]})]})]})]}),"\n",(0,i.jsx)(r.h2,{id:"-eksempler",children:"\ud83d\udcd6 Eksempler"}),"\n",(0,i.jsx)(r.p,{children:"Under f\xf8lger en rekke eksempler p\xe5 hvordan \xe5 konfigurere token-validering og grovkornet autorisasjon p\xe5 SKIP."}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:(0,i.jsxs)("strong",{children:["Eksempel 1: Token-validering for ",(0,i.jsx)(r.em,{children:"alle"})," endepunkt"]})}),(0,i.jsxs)(o.A,{groupId:"operator",children:[(0,i.jsx)(l.A,{value:"skiperator",label:"Skiperator",children:(0,i.jsxs)(r.p,{children:["\ud83d\udea7 ",(0,i.jsx)(r.strong,{children:"UNDER UTVIKLING"})," \ud83d\udea7",(0,i.jsx)("br",{}),"\nSt\xf8tte for \xe5 sette opp token-validering og grovkornet autorisasjon via Skiperator-manifestet er under utvikling og er forel\xf8pig ikke tilgjengelig."]})}),(0,i.jsxs)(l.A,{value:"ztoperator",label:"Ztoperator",children:[(0,i.jsxs)(r.p,{children:["F\xf8lgende ",(0,i.jsx)(r.code,{children:"AuthPolicy"}),"-manifest konfigurerer token-validering for alle endepunktene inn til workloads med labelen ",(0,i.jsx)(r.code,{children:"app: some-application"})," i namespacet ",(0,i.jsx)(r.code,{children:"some-namespace"}),"."]}),(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",children:"apiVersion: ztoperator.kartverket.no/v1alpha1\nkind: AuthPolicy\nmetadata:\n  name: some-auth-policy\n  namespace: some-namespace\nspec:\n  rules:\n    - enabled: true\n      audience:\n        - some-audience\n      issuerURI: https://some-issuer.com\n      jwksURI: https://some-jwks-uri.com\n  selector:\n    matchLabels:\n      app: some-application\n"})})]})]})]}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:(0,i.jsx)("strong",{children:"Eksempel 2: Legg til \xe5pne endepunkt"})}),(0,i.jsxs)(o.A,{groupId:"operator",children:[(0,i.jsx)(l.A,{value:"skiperator",label:"Skiperator",children:(0,i.jsxs)(r.p,{children:["\ud83d\udea7 ",(0,i.jsx)(r.strong,{children:"UNDER UTVIKLING"})," \ud83d\udea7",(0,i.jsx)("br",{}),"\nSt\xf8tte for \xe5 sette opp token-validering og grovkornet autorisasjon via Skiperator-manifestet er under utvikling og er forel\xf8pig ikke tilgjengelig."]})}),(0,i.jsxs)(l.A,{value:"ztoperator",label:"Ztoperator",children:[(0,i.jsxs)(r.p,{children:["F\xf8lgende ",(0,i.jsx)(r.code,{children:"AuthPolicy"}),"-manifest konfigurerer token-validering for alle endepunktene inn til ",(0,i.jsx)(r.code,{children:"some-application"}),", ",(0,i.jsx)(r.strong,{children:"utenom"})," for ",(0,i.jsx)(r.code,{children:"GET"})," til ",(0,i.jsx)(r.code,{children:"/api/cars"})," og ",(0,i.jsx)(r.code,{children:"/api/cars/public*"}),"."]}),(0,i.jsx)(d.A,{type:"warning",title:"Legg merke til...",children:(0,i.jsxs)(r.p,{children:["Her er wildcard (",(0,i.jsx)(r.code,{children:"*"}),") brukt. Resultatet blir da at ",(0,i.jsx)(r.code,{children:"GET"})," mot ",(0,i.jsx)(r.code,{children:"/api/cars"}),", ",(0,i.jsx)(r.code,{children:"/api/cars/public"})," og alle andre sub-paths av ",(0,i.jsx)(r.code,{children:"/api/cars/public"})," vil v\xe6re \xe5pne,\nmens requests mot andre stier vil kreve autentisert JWT, dvs. JWT med claimet ",(0,i.jsx)(r.code,{children:"iss: https://some-issuer.com"})," og ",(0,i.jsx)(r.code,{children:"aud: some-audience"}),"."]})}),(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",children:'apiVersion: ztoperator.kartverket.no/v1alpha1\nkind: AuthPolicy\nmetadata:\n  name: some-auth-policy\n  namespace: some-namespace\nspec:\n  rules:\n    - enabled: true\n      audience:\n        - some-audience\n      issuerURI: https://some-issuer.com\n      jwksURI: https://some-jwks-uri.com\n      ignoreAuthRules:\n        - paths:\n            - "/api/cars"\n            - "/api/cars/public*"\n          methods:\n            - "GET"\n  selector:\n    matchLabels:\n      app: some-application\n'})})]})]})]}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:(0,i.jsx)("strong",{children:"Eksempel 3: Legg til autoriserte endepunkt"})}),(0,i.jsxs)(o.A,{groupId:"operator",children:[(0,i.jsx)(l.A,{value:"skiperator",label:"Skiperator",children:(0,i.jsxs)(r.p,{children:["\ud83d\udea7 ",(0,i.jsx)(r.strong,{children:"UNDER UTVIKLING"})," \ud83d\udea7",(0,i.jsx)("br",{}),"\nSt\xf8tte for \xe5 sette opp token-validering og grovkornet autorisasjon via Skiperator-manifestet er under utvikling og er forel\xf8pig ikke tilgjengelig."]})}),(0,i.jsxs)(l.A,{value:"ztoperator",label:"Ztoperator",children:[(0,i.jsxs)(r.p,{children:["F\xf8lgende ",(0,i.jsx)(r.code,{children:"AuthPolicy"}),"-manifest konfigurerer token-validering for alle endepunktene inn til ",(0,i.jsx)(r.code,{children:"some-application"}),", ",(0,i.jsx)(r.strong,{children:"utenom"})," for endepunktene ",(0,i.jsx)(r.code,{children:"/api/cars*"})," og ",(0,i.jsx)(r.code,{children:"/api/cars/public"})," ",(0,i.jsx)(r.strong,{children:"for alle metoder"}),".\nI tillegg spesifiserer den at ",(0,i.jsx)(r.code,{children:"POST"}),", ",(0,i.jsx)(r.code,{children:"PUT"})," og ",(0,i.jsx)(r.code,{children:"DELETE"})," mot ",(0,i.jsx)(r.code,{children:"/api/cars/admin"})," kun er lov hvis JWT-claimet ",(0,i.jsx)(r.code,{children:"roles"})," eksisterer med verdien ",(0,i.jsx)(r.code,{children:"admin"}),"."]}),(0,i.jsx)(d.A,{type:"warning",title:"Legg merke til...",children:(0,i.jsxs)(r.p,{children:["Stiene ",(0,i.jsx)(r.code,{children:"/api/cars"})," og alle sub-stier er n\xe5 spesifisert som \xe5pne, som ",(0,i.jsx)(r.strong,{children:"er i konflikt"})," med at ",(0,i.jsx)(r.code,{children:"POST"}),", ",(0,i.jsx)(r.code,{children:"PUT"})," og ",(0,i.jsx)(r.code,{children:"DELETE"})," mot ",(0,i.jsx)(r.code,{children:"/api/cars/admin"}),"\nkrever autorisert JWT (",(0,i.jsx)(r.code,{children:"roles: admin"}),"). Her spiller prinsippet om ",(0,i.jsx)(r.strong,{children:"trygge standardinnstillinger"})," inn, og Ztoperator vil falle tilbake til \xe5 kreve autorisert\nJWT for ",(0,i.jsx)(r.code,{children:"POST"}),", ",(0,i.jsx)(r.code,{children:"PUT"})," og ",(0,i.jsx)(r.code,{children:"DELETE"})," mot ",(0,i.jsx)(r.code,{children:"/api/cars/admin"}),"."]})})]})]})]}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:(0,i.jsx)("strong",{children:"Eksempel 4: Token-validering og grovkornet autorisasjon med flere identitetstilbydere"})}),(0,i.jsxs)(o.A,{groupId:"operator",children:[(0,i.jsx)(l.A,{value:"skiperator",label:"Skiperator",children:(0,i.jsxs)(r.p,{children:["\ud83d\udea7 ",(0,i.jsx)(r.strong,{children:"UNDER UTVIKLING"})," \ud83d\udea7",(0,i.jsx)("br",{}),"\nSt\xf8tte for \xe5 sette opp token-validering og grovkornet autorisasjon via Skiperator-manifestet er under utvikling og er forel\xf8pig ikke tilgjengelig."]})}),(0,i.jsxs)(l.A,{value:"ztoperator",label:"Ztoperator",children:[(0,i.jsxs)(r.p,{children:["F\xf8lgende ",(0,i.jsx)(r.code,{children:"AuthPolicy"}),"-manifest konfigurerer token-validering og grovkornet autorisasjon inn til ",(0,i.jsx)(r.code,{children:"some-application"})," for ",(0,i.jsx)(r.strong,{children:"to"})," identitetstilbydere: ID-porten og Maksinporten.\nZtoperator tolker de definerte reglene som f\xf8lger:"]}),(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.code,{children:"/api/idporten/public"})," og ",(0,i.jsx)(r.code,{children:"/api/maskinporten/public"})," er \xe5pne endepunkt for alle metoder."]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.code,{children:"/api/idporten/secret"})," ",(0,i.jsx)(r.strong,{children:"m\xe5"})," ha en gyldig JWT signert av ID-porten med claimet ",(0,i.jsx)(r.code,{children:"roles"})," har verdien ",(0,i.jsx)(r.code,{children:"admin"})," for alle metoder."]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.code,{children:"/api/maskinporten/secret"})," ",(0,i.jsx)(r.strong,{children:"m\xe5"})," ha en gyldig JWT signert av Maskinporten med claimet ",(0,i.jsx)(r.code,{children:"consumer"})," har verdien ",(0,i.jsx)(r.code,{children:"123456789"})," for alle metoder."]}),"\n"]}),"\n",(0,i.jsxs)(r.li,{children:["\n",(0,i.jsxs)(r.p,{children:["Resterende endepunkt krever gydlgi JWT signert av ",(0,i.jsx)(r.strong,{children:"enten ID-porten eller Maskinporten"}),"."]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",children:'apiVersion: ztoperator.kartverket.no/v1alpha1\nkind: AuthPolicy\nmetadata:\n  name: some-auth-policy\n  namespace: some-namespace\nspec:\n  rules:\n    - enabled: true\n      audience:\n        - <DIN ID-PORTEN CLIENT-ID>\n      issuerURI: https://idporten.no\n      jwksURI: https://idporten.no/jwks.json\n      ignoreAuthRules:\n        - paths:\n            - "/api/idporten/public"\n      authRules:\n        - paths:\n            - "/api/idporten/secret"\n          when:\n            - claim: "roles"\n              values: "admin"\n    - enabled: true\n      audience:\n        - <DIN MASKINPORTEN CLIENT-ID>\n      issuerURI: https://maskinporten.no/\n      jwksURI: https://maskinporten.no/jwk\n      ignoreAuthRules:\n        - paths:\n            - "/api/maskinporten/public"\n      authRules:\n        - paths:\n            - "/api/maskinporten/secret"\n          when:\n            - claim: "consumer"\n              values: "123456789"\n  selector:\n    matchLabels:\n      app: some-application\n'})}),"\n"]}),"\n"]})]})]})]})]})}function j(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(g,{...e})}):g(e)}},17792:(e,r,n)=>{n.d(r,{A:()=>s});const s=n.p+"assets/images/istio-sidecar-d95987a3ec354e23e9f0aef55b6b5eea.png"}}]);