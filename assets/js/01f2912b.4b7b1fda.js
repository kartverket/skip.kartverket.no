"use strict";(self.webpackChunkskip_docs=self.webpackChunkskip_docs||[]).push([[692],{46921:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"applikasjon-utrulling/argo-cd/hvordan-bruke-argocd","title":"Hvordan bruke Argo CD","description":"ArgoCD","source":"@site/docs/03-applikasjon-utrulling/09-argo-cd/03-hvordan-bruke-argocd.md","sourceDirName":"03-applikasjon-utrulling/09-argo-cd","slug":"/applikasjon-utrulling/argo-cd/hvordan-bruke-argocd","permalink":"/docs/applikasjon-utrulling/argo-cd/hvordan-bruke-argocd","draft":false,"unlisted":false,"editUrl":"https://github.com/kartverket/skip-docs/edit/main/docs/03-applikasjon-utrulling/09-argo-cd/03-hvordan-bruke-argocd.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Hva er et apps-repo","permalink":"/docs/applikasjon-utrulling/argo-cd/hva-er-et-apps-repo"},"next":{"title":"Hente hemmeligheter fra hemmelighetshvelv","permalink":"/docs/applikasjon-utrulling/argo-cd/hente-hemmeligheter-fra-hemmelighetsvelv"}}');var t=r(74848),i=r(28453);const a={},o="Hvordan bruke Argo CD",l={},d=[{value:"Applikasjoner",id:"applikasjoner",level:2},{value:"Sync",id:"sync",level:2},{value:"Rollback",id:"rollback",level:2},{value:"Detaljer og Web Terminal",id:"detaljer-og-web-terminal",level:2},{value:"Hvordan bruke Argo gjennom API",id:"hvordan-bruke-argo-gjennom-api",level:2}];function g(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"hvordan-bruke-argo-cd",children:"Hvordan bruke Argo CD"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.img,{alt:"ArgoCD",src:r(95526).A+"",width:"1600",height:"900"}),"\nArgo har et godt grensesnitt som gir godt innsyn inn i synkingen av manifester til SKIP, og her skal vi nevne noen funksjoner som er verdt \xe5 vite om. Det anbefales ogs\xe5 \xe5 se p\xe5 ",(0,t.jsx)(n.a,{href:"https://argo-cd.readthedocs.io/en/stable/user-guide/",children:"Argo sin brukerdokumentasjon"})," for Argo CD, den er godt skrevet og inneholder god informasjon om hvordan man skal bruke systemet."]}),"\n",(0,t.jsxs)(n.p,{children:["Om man ellers skulle ha sp\xf8rsm\xe5l rundt bruk av Argo CD anbefaler vi \xe5 sp\xf8rre p\xe5 ",(0,t.jsx)(n.a,{href:"https://kartverketgroup.slack.com/archives/C04KH6A4FNW",children:"#gen-argocd"})," -kanalen p\xe5 Slack."]}),"\n",(0,t.jsxs)(n.p,{children:["Vi kan ogs\xe5 anbefale kurset ",(0,t.jsx)(n.a,{href:"https://kodekloud.com/courses/argocd/",children:"https://kodekloud.com/courses/argocd/"})," for de som \xf8nsker en lengre gjennomgang."]}),"\n",(0,t.jsx)(n.h2,{id:"applikasjoner",children:"Applikasjoner"}),"\n",(0,t.jsxs)(n.p,{children:["Det f\xf8rste man gj\xf8r n\xe5r man skal ta i bruk Argo er \xe5 g\xe5 til nettsiden og logge inn. Lenkene til nettsiden finner man p\xe5 ",(0,t.jsx)(n.a,{href:"/docs/applikasjon-utrulling/argo-cd/",children:"Argo CD"})," og alle kan logge inn med kartverket-brukeren sin hvis man er p\xe5 et team som har fulgt ",(0,t.jsx)(n.a,{href:"/docs/applikasjon-utrulling/argo-cd/komme-i-gang-med-argocd",children:"Komme i gang med Argo CD"}),"."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"ArgoCD applikasjoner",src:r(23196).A+"",width:"2094",height:"1206"})}),"\n",(0,t.jsxs)(n.p,{children:["Det neste som m\xf8ter deg er en oversikt over applikasjonene som Argo leser ut, avbildet over. Dersom man ikke sere noen applikasjoner her, sjekk om dere har fulgt alle stegene i ",(0,t.jsx)(n.a,{href:"/docs/applikasjon-utrulling/argo-cd/komme-i-gang-med-argocd",children:"Komme i gang med Argo CD"})," og at dere har manifester som er satt opp til \xe5 bli synket inn fra ",(0,t.jsx)(n.a,{href:"/docs/applikasjon-utrulling/argo-cd/hva-er-et-apps-repo",children:"apps-repoet"})," deres. Disse prosjektene blir automatisk opprettet basert p\xe5 mappestrukturen i apps-repoet deres, s\xe5 det er ingen behov for \xe5 opprette eller rydde opp prosjekter manuelt."]}),"\n",(0,t.jsx)(n.p,{children:"Klikk p\xe5 et av kortene p\xe5 denne siden og dere vil g\xe5 inn i en mer detaljert visning hvor man ser alle ressursene som blir synkronisert."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"ArgoCD details",src:r(53840).A+"",width:"1588",height:"537"})}),"\n",(0,t.jsxs)(n.p,{children:["Dersom man bruker Skiperator og eksponererer en URL via ",(0,t.jsx)(n.code,{children:"ingresses"})," vil man ogs\xe5 kunne se sm\xe5 ikoner som er lenker og om man klikker p\xe5 dem \xe5pnes applikasjonen i nettleseren."]}),"\n",(0,t.jsx)(n.p,{children:"Det er ogs\xe5 et sett med filtere p\xe5 venstre side som er lurt \xe5 bli kjent med, spesielt dersom applikasjonene blir store og vanskelige \xe5 se p\xe5 en skjerm uten \xe5 scrolle."}),"\n",(0,t.jsx)(n.h2,{id:"sync",children:"Sync"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Sync",src:r(10456).A+"",width:"960",height:"464"})}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsx)(n.p,{children:"Merk at i dev synkroniseres applikasjoner automatisk"})}),"\n",(0,t.jsx)(n.p,{children:"P\xe5 prosjektsiden ser man alle kubernetes-ressurser som er en del av applikasjonen. Legg merke til de sm\xe5 fargede symbolene p\xe5 hvert kort som sier noe om statusen p\xe5 ressursen. Hvis de er gr\xf8nne viser det at den ressursen er \u201chealthy\u201d. Dersom den er r\xf8d er det et tegn p\xe5 at noe er galt med ressursen. Dersom den er gul er den \u201cute av synk\u201d, og da m\xe5 man synkronisere applikasjonen."}),"\n",(0,t.jsxs)(n.p,{children:["Bildet over viser hvordan man kan synkronisere ut endringene til kubernetes-milj\xf8et. Sync-knappen i menylinjen lar deg velge hvordan ting skal synkroniseres ut, og man kan til og med gj\xf8re en ",(0,t.jsx)(n.a,{href:"https://argo-cd.readthedocs.io/en/stable/user-guide/selective_sync/",children:"Selective Sync"})," av kun noen av ressursene. Det vanligste og tryggeste er vel \xe5 merke \xe5 synkronisere alt med default-innstillingene."]}),"\n",(0,t.jsx)(n.p,{children:"Dersom en synk ikke har fungert vil man se en feilmelding i menylinjen \xf8verst. I det tilfellet kan det v\xe6re lurt \xe5 trykke p\xe5 \u201csync status\u201d-knappen \xf8verst for \xe5 f\xe5 en mer detaljert oversikt over hva som har g\xe5tt galt."}),"\n",(0,t.jsx)(n.h2,{id:"rollback",children:"Rollback"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.img,{alt:"Rollback",src:r(33423).A+"",width:"2558",height:"1258"}),"\nI noen tilfeller kan man tenke seg at en u\xf8nsket endring er kommet ut i kj\xf8remilj\xf8et. Da vil den raskeste og enkleste m\xe5ten \xe5 gjenopprette funksjonaliteten for brukerene ofte v\xe6re en rollback til en tidligere kjent fungerende versjon."]}),"\n",(0,t.jsx)(n.p,{children:"Rollbacks er det innebygget st\xf8tte for i Argo CD som en del av applikasjonsvisningen. Klikk \u201cHistory and rollback\u201d for \xe5 f\xe5 en liste over alle tidligere synker som er gjort i denne applikasjonen. Dersom man \xf8nsker \xe5 rulle tilbake finner man versjonen man \xf8nsker i listen og trykker p\xe5 de tre prikkene og velger rollback. \u201cRevisjonene\u201d i listen peker p\xe5 en commit i git-historikken til apps-repoet."}),"\n",(0,t.jsx)(n.p,{children:"Ved en rollback gj\xf8r Argo CD en synk som vanlig, men mot en tidligere kjent tilstand. Den vil da ikke bruke tilstanden som ligger i git, men tilstanden til en tidligere synk. Etter en rollback vil applikasjonen st\xe5 som \u201cout of sync\u201d, og det er forventet siden den ikke matcher tilstanden i git."}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["Husk at container imaget m\xe5 finnes for at det skal v\xe6re mulig \xe5 rulle tilbake. Om container imaget er slettet i ",(0,t.jsx)(n.a,{href:"http://ghcr.io/",children:"ghcr.io"})," , for eksempel av en oppryddingsjobb, s\xe5 vil det ikke v\xe6re mulig \xe5 starte opp den tidligere versjonen."]})}),"\n",(0,t.jsx)(n.h2,{id:"detaljer-og-web-terminal",children:"Detaljer og Web Terminal"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Detaljer",src:r(47876).A+"",width:"2542",height:"1258"})}),"\n",(0,t.jsx)(n.p,{children:"Dersom man klikker p\xe5 en ressurs i prosjektvisningen vil man se flere detaljer om denne ressursen. Man finner blant annet en oversikt over metadata, manfiest-filen som Argo CD skal synke ut, events og logger."}),"\n",(0,t.jsx)(n.p,{children:"Det er ogs\xe5 mulig \xe5 endre p\xe5 manifestfilen som ligger i clusteret om man g\xe5r p\xe5 \u201clive manifest\u201d og trykker \u201cedit\u201d. Dette vil f\xf8re til at applikasjonen kommer ut av synk, og i milj\xf8er hvor auto-synking er skrudd p\xe5 vil det tilbakestilles med en gang. Men i noen tilfeller kan det v\xe6re nyttig."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Web terminal",src:r(82556).A+"",width:"2556",height:"1263"})}),"\n",(0,t.jsx)(n.p,{children:"Legg ogs\xe5 merke til \u201cterminal\u201d-fanen. Denne er kun synlig om man velger en pod. Velger man denne fanen f\xe5r man en live terminaltilkobling inn til podden som man kan bruke til feils\xf8king."}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsx)(n.p,{children:"Web terminal er ikke tilgjengelig i prod"})}),"\n",(0,t.jsx)(n.h2,{id:"hvordan-bruke-argo-gjennom-api",children:"Hvordan bruke Argo gjennom API"}),"\n",(0,t.jsxs)(n.p,{children:["Visst du \xf8nsker \xe5 automatisere oppgaver, for eksempel synk ved ny image versjon s\xe5 kan det v\xe6re greit \xe5 ha muligheten til \xe5 gj\xf8re dette fra Github. Det f\xf8rste du trengre da er nettverkstilgang fra Github, det f\xe5r du med ",(0,t.jsx)(n.a,{href:"https://kartverket.atlassian.net/wiki/spaces/SKIPDOK/pages/683376648",children:"tailscale"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["For \xe5 autentisere mot Argo s\xe5 m\xe5 du generere en JWT, dette kan du gj\xf8re i Argo UIet. G\xe5 inn p\xe5 f.eks ",(0,t.jsx)(n.a,{href:"https://argo-dev.kartverket.dev"}),", trykk p\xe5 settings oppe til venstre \u2192 Projects \u2192 ditt prosjekt \u2192 trykk p\xe5 \u201cRoles\u201d fanen, og deretter p\xe5 apiuser. Scroll helt ned p\xe5 modalen som kommer opp og trykk Create under JWT Tokens. Det er samme framgangsm\xe5te i andre milj\xf8."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"JWT",src:r(82505).A+"",width:"2560",height:"1332"})}),"\n",(0,t.jsx)(n.p,{children:"Etter at token er generert kan du testen den med kommandoen:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'curl https://argo-dev.kartverket.dev/api/v1/applications/<min-app> -H "Content-Type: application/json" -H "Authorization: Bearer <token>"\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Argos API spec kan man finne her: ",(0,t.jsx)(n.a,{href:"https://argo-dev.kartverket.dev/swagger-ui"})]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(g,{...e})}):g(e)}},95526:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/556662850-ff56477a315a6a794b59e161b924eb28.png"},10456:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/557318179-86f78238a46f35a5d10dae24e7e58545.gif"},82556:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/557318208-15ece4ad9ca7ebfb986c6f146ce1f0e9.png"},33423:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/557449248-f3400d7790f4f31eb2204fb589a1d28f.png"},53840:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/557645847-1f6f04a760b80cb3890057af497aaec5.png"},47876:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/557776914-aa2e5e0f5c02eb35d42c5c19de4ecbc4.png"},23196:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/applikasjonerargocd-1c50378af0d8b31151dabb53ced18f47.png"},82505:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/genererejwtargo-0c2eca7136a140abf04fcf650b222937.gif"},28453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>o});var s=r(96540);const t={},i=s.createContext(t);function a(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);