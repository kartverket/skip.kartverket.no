"use strict";(globalThis.webpackChunkskip_docs=globalThis.webpackChunkskip_docs||[]).push([[606],{600(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>c,frontMatter:()=>i,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"applikasjon-utrulling/tilgangsstyring/ztoperator/tutorials","title":"Tutorials","description":"Under finner du video-gjennomganger av hvordan du kan sikre applikasjoner med Ztoperator p\xe5 SKIP for","source":"@site/docs/03-applikasjon-utrulling/04-tilgangsstyring/02-ztoperator/01-tutorials.mdx","sourceDirName":"03-applikasjon-utrulling/04-tilgangsstyring/02-ztoperator","slug":"/applikasjon-utrulling/tilgangsstyring/ztoperator/tutorials","permalink":"/docs/applikasjon-utrulling/tilgangsstyring/ztoperator/tutorials","draft":false,"unlisted":false,"editUrl":"https://github.com/kartverket/skip-docs/edit/main/docs/03-applikasjon-utrulling/04-tilgangsstyring/02-ztoperator/01-tutorials.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Ztoperator","permalink":"/docs/applikasjon-utrulling/tilgangsstyring/ztoperator/"},"next":{"title":"API Reference","permalink":"/docs/applikasjon-utrulling/tilgangsstyring/ztoperator/api-docs"}}');var a=t(74848),o=t(28453);const i={},s="Tutorials",l={},d=[{value:"\ud83d\udd39  Microsoft Entra ID",id:"--microsoft-entra-id",level:2},{value:"\ud83d\udccb Manifester",id:"-manifester",level:3},{value:"\ud83e\udeaa ID-Porten",id:"-id-porten",level:2},{value:"\ud83d\udccb Manifester",id:"-manifester-1",level:3},{value:"\ud83d\udc69\u200d\ud83d\udcbc Ansattporten",id:"-ansattporten",level:2},{value:"\ud83d\udccb Manifester",id:"-manifester-2",level:3}];function p(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"tutorials",children:"Tutorials"})}),"\n",(0,a.jsx)(n.p,{children:"Under finner du video-gjennomganger av hvordan du kan sikre applikasjoner med Ztoperator p\xe5 SKIP for\nidentitetstilbyderne Microsoft Entra ID, ID-Porten og Ansattporten."}),"\n",(0,a.jsx)(n.h2,{id:"--microsoft-entra-id",children:"\ud83d\udd39  Microsoft Entra ID"}),"\n",(0,a.jsxs)(n.p,{children:["F\xf8lgende eksempel g\xe5r gjennom hvordan man kan konfigurere en Ztoperator-",(0,a.jsx)(n.code,{children:"AuthPolicy"})," til \xe5 beskytte en\neksempelapplikasjon og logge inn brukere mot Kartverket sin Microsoft Entra ID. Til det s\xe5 benyttes Azurerator til klientregistrering,\nSkiperator til applikasjonsutrulling og Ztoperator til tilgangsstyring og innloggingsflyt."]}),"\n",(0,a.jsxs)(n.p,{children:["Oppsettet for eksempelet finner du i ",(0,a.jsxs)(n.a,{href:"https://github.com/kartverket/tilgangsstyring-apps/tree/main/env/atgcp1-sandbox/ztoperator-demo-entraid",children:[(0,a.jsx)(n.code,{children:"env/atgcp1-sandbox/ztoperator-demo-entraid"})," i tilgangsstyring-apps"]}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["Den beskyttede applikasjonen kan n\xe5s p\xe5 ",(0,a.jsx)(n.a,{href:"https://entraid-ztoperator.atgcp1-sandbox.kartverket.cloud",children:"entraid-ztoperator.atgcp1-sandbox.kartverket.cloud"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"-manifester",children:"\ud83d\udccb Manifester"}),"\n",(0,a.jsx)(n.p,{children:"F\xf8lgende manifester ble opprettet for \xe5 realisere eksempelet:"}),"\n",(0,a.jsxs)(t,{children:[(0,a.jsx)("summary",{children:(0,a.jsxs)("strong",{children:[(0,a.jsx)(n.code,{children:"AzureAdApplication"}),": ztoperator-demo-entraid/entraid-reg"]})}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"apiVersion: nais.io/v1\nkind: AzureAdApplication\nmetadata:\n  name: entraid-reg\nspec:\n  claims:\n    groups:\n      - id: a6578085-e0ee-4168-bf97-1b3026f6f3bd # Kartverket@kartverket.no\n  replyUrls:\n    - url: https://entraid-ztoperator.atgcp1-sandbox.kartverket.cloud/oauth2/callback\n  secretName: entraid-secret\n"})})]}),"\n",(0,a.jsxs)(t,{children:[(0,a.jsx)("summary",{children:(0,a.jsxs)("strong",{children:[(0,a.jsx)(n.code,{children:"Application"}),": ztoperator-demo-entraid/entraid-demo-app"]})}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'apiVersion: skiperator.kartverket.no/v1alpha1\nkind: Application\nmetadata:\n  name: entraid-demo-app\nspec:\n  podSettings:\n    annotations:\n      sidecar.istio.io/userVolume: |\n        [\n          {\n            "name": "istio-oauth2",\n            "secret": {\n              "secretName": "authpolicy-entraid-envoy-secret"\n            }\n          }\n        ]\n      sidecar.istio.io/userVolumeMount: |\n        [\n          {\n            "name": "istio-oauth2",\n            "mountPath": "/etc/istio/config",\n            "readonly": true\n          }\n        ]\n  image: ghcr.io/kartverket/ztoperator-echo-app:v0\n  port: 5000\n  env:\n    - name: ECHO_TITLE\n      value: Hello from Entra ID Ztoperator Demo\n  ingresses:\n    - entraid-ztoperator.atgcp1-sandbox.kartverket.cloud\n'})})]}),"\n",(0,a.jsxs)(t,{children:[(0,a.jsx)("summary",{children:(0,a.jsxs)("strong",{children:[(0,a.jsx)(n.code,{children:"AuthPolicy"}),": ztoperator-demo-entraid/authpolicy-entraid"]})}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"apiVersion: ztoperator.kartverket.no/v1alpha1\nkind: AuthPolicy\nmetadata:\n  name: authpolicy-entraid\nspec:\n  enabled: true\n  selector:\n    matchLabels:\n      app: entraid-demo-app\n  wellKnownURI: https://login.microsoftonline.com/7f74c8a2-43ce-46b2-b0e8-b6306cba73a3/v2.0/.well-known/openid-configuration\n  audience:\n    - 51525343-f969-4820-9ddc-4c41526f6aae\n  ignoreAuthRules:\n    - paths:\n        - /\n        - /favicon.ico\n  autoLogin:\n    enabled: true\n    logoutPath: /logout\n    redirectPath: /oauth2/callback\n    scopes:\n      - 51525343-f969-4820-9ddc-4c41526f6aae/.default\n  oAuthCredentials:\n    clientIDKey: AZURE_APP_CLIENT_ID\n    clientSecretKey: AZURE_APP_CLIENT_SECRET\n    secretRef: entraid-secret\n  outputClaimToHeaders:\n    - claim: preferred_username\n      header: zt-mail\n    - claim: name\n      header: zt-name\n"})})]}),"\n",(0,a.jsx)("div",{style:{maxWidth:640},children:(0,a.jsx)("div",{style:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden"},children:(0,a.jsx)("iframe",{src:"https://kartverket-my.sharepoint.com/personal/lars_sorensen_kartverket_no/_layouts/15/embed.aspx?UniqueId=3d1d102d-26ca-4671-bbc8-fcb61afaa037&embed=%7B%22ust%22%3Afalse%2C%22hv%22%3A%22CopyEmbedCode%22%7D&referrer=StreamWebApp&referrerScenario=EmbedDialog.Create",width:"640",height:"360",frameBorder:"0",scrolling:"no",allowFullScreen:!0,title:"Ztoperator - Microsoft Entra ID",style:{border:"none",position:"absolute",top:0,left:0,right:0,bottom:0,height:"100%",maxWidth:"100%"}})})}),"\n",(0,a.jsx)(n.h2,{id:"-id-porten",children:"\ud83e\udeaa ID-Porten"}),"\n",(0,a.jsxs)(n.p,{children:["F\xf8lgende eksempel g\xe5r gjennom hvordan man kan konfigurere en Ztoperator-",(0,a.jsx)(n.code,{children:"AuthPolicy"})," til \xe5 beskytte en\neksempelapplikasjon og logge inn brukere mot ID-Porten i test. Til det s\xe5 benyttes Digdir sin selvbetjeningsl\xf8sning til klientregistrering,\nSkiperator til applikasjonsutrulling og Ztoperator til tilgangsstyring og innloggingsflyt."]}),"\n",(0,a.jsxs)(n.p,{children:["Oppsettet for eksempelet finner du i ",(0,a.jsxs)(n.a,{href:"https://github.com/kartverket/tilgangsstyring-apps/tree/main/env/atgcp1-sandbox/ztoperator-demo-idporten",children:[(0,a.jsx)(n.code,{children:"env/atgcp1-sandbox/ztoperator-demo-idporten"})," i tilgangsstyring-apps"]}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["Den beskyttede applikasjonen kan n\xe5s p\xe5 ",(0,a.jsx)(n.a,{href:"https://idporten-ztoperator.atgcp1-sandbox.kartverket.cloud",children:"idporten-ztoperator.atgcp1-sandbox.kartverket.cloud"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"-manifester-1",children:"\ud83d\udccb Manifester"}),"\n",(0,a.jsx)(n.p,{children:"F\xf8lgende manifester ble opprettet for \xe5 realisere eksempelet:"}),"\n",(0,a.jsxs)(t,{children:[(0,a.jsx)("summary",{children:(0,a.jsxs)("strong",{children:[(0,a.jsx)(n.code,{children:"ExternalSecret"}),": ztoperator-demo-idporten/idporten-secrets"]})}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"apiVersion: external-secrets.io/v1\nkind: SecretStore\nmetadata:\n  name: idporten-gsm\nspec:\n  provider:\n    gcpsm:\n      projectID: tilgangsstyring-sandbox-e5ab\n---\napiVersion: external-secrets.io/v1\nkind: ExternalSecret\nmetadata:\n  name: idporten-secrets\nspec:\n  secretStoreRef:\n    kind: SecretStore\n    name: idporten-gsm\n  target:\n    name: idporten-secrets\n  data:\n    - secretKey: CLIENT_ID\n      remoteRef:\n        key: idporten-client-id\n        metadataPolicy: None\n    - secretKey: CLIENT_SECRET\n      remoteRef:\n        key: idporten-client-secret\n        metadataPolicy: None       \n  refreshInterval: 1h\n"})})]}),"\n",(0,a.jsxs)(t,{children:[(0,a.jsx)("summary",{children:(0,a.jsxs)("strong",{children:[(0,a.jsx)(n.code,{children:"Application"}),": ztoperator-demo-idporten/idporten-demo-app"]})}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'apiVersion: skiperator.kartverket.no/v1alpha1\nkind: Application\nmetadata:\n  name: idporten-demo-app\nspec:\n  podSettings:\n    annotations:\n      sidecar.istio.io/userVolume: |\n        [\n          {\n            "name": "istio-oauth2",\n            "secret": {\n              "secretName": "authpolicy-idporten-envoy-secret"\n            }\n          }\n        ]\n      sidecar.istio.io/userVolumeMount: |\n        [\n          {\n            "name": "istio-oauth2",\n            "mountPath": "/etc/istio/config",\n            "readonly": true\n          }\n        ]\n  image: ghcr.io/kartverket/ztoperator-echo-app:v0\n  port: 5000\n  env:\n    - name: ECHO_TITLE\n      value: Hello from Ztoperator ID-Porten Demo App\n  ingresses:\n    - idporten-ztoperator.atgcp1-sandbox.kartverket.cloud\n'})})]}),"\n",(0,a.jsxs)(t,{children:[(0,a.jsx)("summary",{children:(0,a.jsxs)("strong",{children:[(0,a.jsx)(n.code,{children:"AuthPolicy"}),": ztoperator-demo-idporten/authpolicy-idporten"]})}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"apiVersion: ztoperator.kartverket.no/v1alpha1\nkind: AuthPolicy\nmetadata:\n  name: authpolicy-idporten\nspec:\n  enabled: true\n  selector:\n    matchLabels:\n      app: idporten-demo-app\n  wellKnownURI: https://test.idporten.no/.well-known/openid-configuration\n  audience:\n    - 8ad04c24-ac32-4252-9491-763d83d2cfad\n  acceptedResources:\n    - https://idporten-ztoperator.atgcp1-sandbox.kartverket.cloud\n  ignoreAuthRules:\n    - paths:\n        - /\n        - /favicon.ico\n  autoLogin:\n    enabled: true\n    logoutPath: /logout\n    redirectPath: /oauth2/callback\n    scopes:\n      - openid\n      - profile\n  oAuthCredentials:\n    clientIDKey: CLIENT_ID\n    clientSecretKey: CLIENT_SECRET\n    secretRef: idporten-secrets\n  outputClaimToHeaders:\n    - claim: pid\n      header: zt-pid\n"})})]}),"\n",(0,a.jsx)("div",{style:{maxWidth:640},children:(0,a.jsx)("div",{style:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden"},children:(0,a.jsx)("iframe",{src:"https://kartverket-my.sharepoint.com/personal/lars_sorensen_kartverket_no/_layouts/15/embed.aspx?UniqueId=90418fbc-7e6f-4568-a88c-c9c44b63595e&embed=%7B%22ust%22%3Atrue%2C%22hv%22%3A%22CopyEmbedCode%22%7D&referrer=StreamWebApp&referrerScenario=EmbedDialog.Create",width:"640",height:"360",frameBorder:"0",scrolling:"no",allowFullScreen:!0,title:"Ztoperator - ID-Porten",style:{border:"none",position:"absolute",top:0,left:0,right:0,bottom:0,height:"100%",maxWidth:"100%"}})})}),"\n",(0,a.jsx)(n.h2,{id:"-ansattporten",children:"\ud83d\udc69\u200d\ud83d\udcbc Ansattporten"}),"\n",(0,a.jsxs)(n.p,{children:["F\xf8lgende eksempel g\xe5r gjennom hvordan man kan konfigurere en Ztoperator-",(0,a.jsx)(n.code,{children:"AuthPolicy"})," til \xe5 beskytte en\neksempelapplikasjon og logge inn brukere mot Ansattporten i test. Til det s\xe5 benyttes Digdir sin selvbetjeningsl\xf8sning til klientregistrering,\nSkiperator til applikasjonsutrulling og Ztoperator til tilgangsstyring og innloggingsflyt."]}),"\n",(0,a.jsxs)(n.p,{children:["Oppsettet for eksempelet finner du i ",(0,a.jsxs)(n.a,{href:"https://github.com/kartverket/tilgangsstyring-apps/tree/main/env/atgcp1-sandbox/ztoperator-demo-ansattporten",children:[(0,a.jsx)(n.code,{children:"env/atgcp1-sandbox/ztoperator-demo-ansattporten"})," i tilgangsstyring-apps"]}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["Den beskyttede applikasjonen kan n\xe5s p\xe5 ",(0,a.jsx)(n.a,{href:"https://ansattporten-ztoperator.atgcp1-sandbox.kartverket.cloud",children:"ansattporten-ztoperator.atgcp1-sandbox.kartverket.cloud"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"-manifester-2",children:"\ud83d\udccb Manifester"}),"\n",(0,a.jsx)(n.p,{children:"F\xf8lgende manifester ble opprettet for \xe5 realisere eksempelet:"}),"\n",(0,a.jsxs)(t,{children:[(0,a.jsx)("summary",{children:(0,a.jsxs)("strong",{children:[(0,a.jsx)(n.code,{children:"ExternalSecret"}),": ztoperator-demo-ansattporten/ansattporten-secrets"]})}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"apiVersion: external-secrets.io/v1\nkind: SecretStore\nmetadata:\n  name: ansattporten-gsm\nspec:\n  provider:\n    gcpsm:\n      projectID: tilgangsstyring-sandbox-e5ab\n---\napiVersion: external-secrets.io/v1\nkind: ExternalSecret\nmetadata:\n  name: ansattporten-secrets\nspec:\n  secretStoreRef:\n    kind: SecretStore\n    name: ansattporten-gsm\n  target:\n    name: ansattporten-secrets\n  data:\n    - secretKey: CLIENT_ID\n      remoteRef:\n        key: ansattporten-client-id\n        metadataPolicy: None\n    - secretKey: CLIENT_SECRET\n      remoteRef:\n        key: ansattporten-client-secret\n        metadataPolicy: None\n  refreshInterval: 1h\n"})})]}),"\n",(0,a.jsxs)(t,{children:[(0,a.jsx)("summary",{children:(0,a.jsxs)("strong",{children:[(0,a.jsx)(n.code,{children:"Application"}),": ztoperator-demo-ansattporten/ansattporten-demo-app"]})}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'apiVersion: skiperator.kartverket.no/v1alpha1\nkind: Application\nmetadata:\n  name: ansattporten-demo-app\nspec:\n  podSettings:\n    annotations:\n      sidecar.istio.io/userVolume: |\n        [\n          {\n            "name": "istio-oauth2",\n            "secret": {\n              "secretName": "authpolicy-ansattporten-envoy-secret"\n            }\n          }\n        ]\n      sidecar.istio.io/userVolumeMount: |\n        [\n          {\n            "name": "istio-oauth2",\n            "mountPath": "/etc/istio/config",\n            "readonly": true\n          }\n        ]\n  image: ghcr.io/kartverket/ztoperator-echo-app:v0\n  port: 5000\n  env:\n    - name: ECHO_TITLE\n      value: Hello from Ztoperator Ansattporten Demo App\n  ingresses:\n    - ansattporten-ztoperator.atgcp1-sandbox.kartverket.cloud\n'})})]}),"\n",(0,a.jsxs)(t,{children:[(0,a.jsx)("summary",{children:(0,a.jsxs)("strong",{children:[(0,a.jsx)(n.code,{children:"AuthPolicy"}),": ztoperator-demo-ansattporten/authpolicy-ansattporten"]})}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'apiVersion: ztoperator.kartverket.no/v1alpha1\nkind: AuthPolicy\nmetadata:\n  name: authpolicy-ansattporten\nspec:\n  enabled: true\n  selector:\n    matchLabels:\n      app: ansattporten-demo-app\n  wellKnownURI: https://test.ansattporten.no/.well-known/openid-configuration\n  audience:\n    - a2b58353-e3b5-4f69-a453-3f180c1f00de\n  acceptedResources:\n    - https://ansattporten-ztoperator.atgcp1-sandbox.kartverket.cloud\n  ignoreAuthRules:\n    - paths:\n        - /\n        - /favicon.ico\n  autoLogin:\n    enabled: true\n    logoutPath: /logout\n    redirectPath: /oauth2/callback\n    scopes:\n      - openid\n      - profile\n    loginParams:\n      authorization_details: |\n        [\n          {\n            "type": "ansattporten:altinn:service",\n            "resource": "urn:altinn:resource:5822:1",\n            "allow_multiple_organizations": false\n          }\n        ]\n  oAuthCredentials:\n    clientIDKey: CLIENT_ID\n    clientSecretKey: CLIENT_SECRET\n    secretRef: ansattporten-secrets\n  outputClaimToHeaders:\n    - claim: pid\n      header: zt-pid\n'})})]}),"\n",(0,a.jsx)("div",{style:{maxWidth:640},children:(0,a.jsx)("div",{style:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden"},children:(0,a.jsx)("iframe",{src:"https://kartverket-my.sharepoint.com/personal/lars_sorensen_kartverket_no/_layouts/15/embed.aspx?UniqueId=9f1cb5d8-0e76-448a-9e5d-87259fbde584&embed=%7B%22ust%22%3Atrue%2C%22hv%22%3A%22CopyEmbedCode%22%7D&referrer=StreamWebApp&referrerScenario=EmbedDialog.Create",width:"640",height:"360",frameBorder:"0",scrolling:"no",allowFullScreen:!0,title:"Ztoperator - Ansattporten",style:{border:"none",position:"absolute",top:0,left:0,right:0,bottom:0,height:"100%",maxWidth:"100%"}})})})]})}function c(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}},28453(e,n,t){t.d(n,{R:()=>i,x:()=>s});var r=t(96540);const a={},o=r.createContext(a);function i(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);