"use strict";(self.webpackChunkskip_docs=self.webpackChunkskip_docs||[]).push([[1877],{20911:(e,i,t)=>{t.r(i),t.d(i,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"applikasjon-utrulling/argokit/argokit-v2","title":"ArgoKit v2","description":"ArgoKit v2 is a set of reusable jsonnet templates, building on the old argoKit, that makes it easier to deploy","source":"@site/docs/03-applikasjon-utrulling/10-argokit/03-argokit-v2.md","sourceDirName":"03-applikasjon-utrulling/10-argokit","slug":"/applikasjon-utrulling/argokit/argokit-v2","permalink":"/docs/applikasjon-utrulling/argokit/argokit-v2","draft":false,"unlisted":false,"editUrl":"https://github.com/kartverket/skip-docs/edit/main/docs/03-applikasjon-utrulling/10-argokit/03-argokit-v2.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Argokit V1","permalink":"/docs/applikasjon-utrulling/argokit/argokit-v1"},"next":{"title":"Kom i gang med Argokit","permalink":"/docs/applikasjon-utrulling/argokit/getting-started"}}');var n=t(74848),r=t(28453);const o={},a="ArgoKit v2",l={},c=[{value:"Installation",id:"installation",level:2},{value:"Git submodules",id:"git-submodules",level:3},{value:"Automatic version updates",id:"automatic-version-updates",level:3},{value:"Usage",id:"usage",level:2},{value:"jsonnet argokit API",id:"jsonnet-argokit-api",level:3},{value:"argoKit&#39;s Replicas API",id:"argokits-replicas-api",level:3},{value:"argoKit&#39;s Environment API",id:"argokits-environment-api",level:3},{value:"argoKit&#39;s Ingress API",id:"argokits-ingress-api",level:3},{value:"argoKit&#39;s accessPolicies API",id:"argokits-accesspolicies-api",level:3},{value:"argoKit&#39;s Probe API",id:"argokits-probe-api",level:3},{value:"Contributing",id:"contributing",level:2},{value:"License",id:"license",level:2}];function d(e){const i={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.header,{children:(0,n.jsx)(i.h1,{id:"argokit-v2",children:"ArgoKit v2"})}),"\n",(0,n.jsx)("p",{align:"center",children:(0,n.jsx)("img",{src:"logo.png",alt:"ArgoKit Logo",width:"300px"})}),"\n",(0,n.jsx)(i.p,{children:"ArgoKit v2 is a set of reusable jsonnet templates, building on the old argoKit, that makes it easier to deploy\nArgoCD applications on SKIP. It is a work in progress and will be updated as we\nlearn more about how to best deploy with ArgoCD on SKIP. If you have any\nquestions, please reach out to the #gen-argocd or #spire-kartverket-devex-sparring channels in Slack."}),"\n",(0,n.jsx)(i.h2,{id:"installation",children:"Installation"}),"\n",(0,n.jsxs)(i.p,{children:["Assuming you have followed the ",(0,n.jsx)(i.a,{href:"https://kartverket.atlassian.net/wiki/spaces/SKIPDOK/pages/554827836/Komme+i+gang+med+Argo+CD",children:"Getting Started"}),"\nguide, you can use ArgoKit in your apps-repo."]}),"\n",(0,n.jsxs)(i.p,{children:["First you need to install jsonnet bundler. This is done by running ",(0,n.jsx)(i.code,{children:"brew install jsonnet-bundler"})," or download the\n",(0,n.jsx)(i.a,{href:"https://github.com/jsonnet-bundler/jsonnet-bundler",children:"binary release"}),".\nNext run ",(0,n.jsx)(i.code,{children:"jb init"}),", and finally run ",(0,n.jsx)(i.code,{children:"jb install github.com/kartverket/argokit@main"}),". If you want\nto stay on a specific version use ",(0,n.jsx)(i.code,{children:"jb install github.com/kartverket/argokit@2.0.0"})]}),"\n",(0,n.jsxs)(i.p,{children:["Remember to add ",(0,n.jsx)(i.code,{children:"vendor/"})," to .gitignore"]}),"\n",(0,n.jsx)(i.h3,{id:"git-submodules",children:"Git submodules"}),"\n",(0,n.jsx)(i.p,{children:"Alternatively you can use submodules if you prefer it over jsonnet bundler (We recommend jsonnet bundler).\nInclude the ArgoKit library by running the following command:"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"$ git submodule add https://github.com/kartverket/argokit.git\n"})}),"\n",(0,n.jsx)(i.h3,{id:"automatic-version-updates",children:"Automatic version updates"}),"\n",(0,n.jsxs)(i.p,{children:["It is highly recommended to use dependabot to automatically update the ArgoKit\nversion when a new version is released. To do this, add the following to your\n",(0,n.jsx)(i.code,{children:".github/dependabot.yml"})," file:"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-yaml",children:"version: 2\nupdates:\n  - package-ecosystem: gitsubmodule\n    directory: /\n    schedule:\n      interval: daily\n"})}),"\n",(0,n.jsx)(i.p,{children:"With this configuration, dependabot will automatically create a PR to update the\nArgoKit version once a day provided that a new version has been released."}),"\n",(0,n.jsx)(i.h2,{id:"usage",children:"Usage"}),"\n",(0,n.jsxs)(i.p,{children:["If you use jsonnet in your apps-repo, you can use the ArgoKit library to deploy\nArgoCD applications by including the ",(0,n.jsx)(i.code,{children:"argokit.libsonnet"})," file in your jsonnet\nfile and calling the ",(0,n.jsx)(i.code,{children:"argokit.Application"})," function. For example, to deploy an\napplication, you can use the following jsonnet file:"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-jsonnet",children:"local argokit = import 'github.com/kartverket/argokit/v2/jsonnet/argokit.libsonnet';\n\nargokit.application.new('foo-backend')\n+argokit.application.withReplicas(initial=2, max=5, targetCpuUtilization=80)\n+argokit.application.forHostnames('foo.bar.com')\n+argokit.application.withInboundSkipApp('foo-frontend')\n"})}),"\n",(0,n.jsx)(i.h3,{id:"jsonnet-argokit-api",children:"jsonnet argokit API"}),"\n",(0,n.jsxs)(i.p,{children:["The following examples are available at ",(0,n.jsx)(i.a,{href:"https://github.com/kartverket/argokit/v2/examples",children:"our github"})]}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"Template"}),(0,n.jsx)(i.th,{children:"Description"}),(0,n.jsx)(i.th,{children:"Example"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"argokit.application.new()"})}),(0,n.jsx)(i.td,{children:"Creates a Skiperator application, using the appAndObjects convention (this is default)."}),(0,n.jsx)(i.td,{children:"See above"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"argokit.skipJob.new()"})}),(0,n.jsx)(i.td,{children:"Creates a Skiperator job, using the appAndObjects convention."}),(0,n.jsx)(i.td,{children:(0,n.jsx)(i.a,{href:"https://github.com/kartverket/argokit/blob/main/v2/examples/accessPolicies-for-job.jsonnet",children:"examples/accessPolicies-for-job.jsonnet"})})]})]})]}),"\n",(0,n.jsx)(i.h3,{id:"argokits-replicas-api",children:"argoKit's Replicas API"}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"NOTE!"})," It is not recommended to run with less than 2 replicas..."]}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"Template"}),(0,n.jsx)(i.th,{children:"Description"}),(0,n.jsx)(i.th,{children:"Example"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"argokit.application.withReplicas"})}),(0,n.jsx)(i.td,{children:"Create replicas for an application with sensible defaults"}),(0,n.jsx)(i.td,{children:(0,n.jsx)(i.a,{href:"https://github.com/kartverket/argokit/blob/main/v2/examples/replicas.jsonnet",children:"examples/replicas.jsonnet"})})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"argokit.application.withReplicas"})}),(0,n.jsx)(i.td,{children:"Create replicas for an application with memory monitoring"}),(0,n.jsx)(i.td,{children:(0,n.jsx)(i.a,{href:"https://github.com/kartverket/argokit/blob/main/v2/examples/replicas-with-memory.jsonnet",children:"examples/replicasets-with-memory.jsonnet"})})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"argokit.application.withReplicas"})}),(0,n.jsx)(i.td,{children:"Creates a static replica without cpu- and memory monitoring"}),(0,n.jsx)(i.td,{children:(0,n.jsx)(i.a,{href:"https://github.com/kartverket/argokit/blob/main/v2/examples/replicas-static.jsonnet",children:"examples/replicasets-static.jsonnet"})})]})]})]}),"\n",(0,n.jsx)(i.h3,{id:"argokits-environment-api",children:"argoKit's Environment API"}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"Template"}),(0,n.jsx)(i.th,{children:"Description"}),(0,n.jsx)(i.th,{children:"Example"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"argokit.[application|skipJOB].withVariable"})}),(0,n.jsx)(i.td,{children:"Creates environment variables for an app"}),(0,n.jsx)(i.td,{children:(0,n.jsx)(i.a,{href:"https://github.com/kartverket/argokit/blob/main/v2/examples/envVariables.jsonnet",children:"examples/envVariables.jsonnet"})})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"argokit.[application|skipJOB].withVariableSecret"})}),(0,n.jsx)(i.td,{children:"Creates environment variable from a secret"}),(0,n.jsx)(i.td,{children:(0,n.jsx)(i.a,{href:"https://github.com/kartverket/argokit/blob/main/v2/examples/envVariables.jsonnet",children:"examples/envVariables.jsonnet"})})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"argokit.[application|skipJOB].withVariableSecret"})}),(0,n.jsx)(i.td,{children:"Creates environment variable from a secret for a Job container"}),(0,n.jsx)(i.td,{children:(0,n.jsx)(i.a,{href:"https://github.com/kartverket/argokit/blob/main/v2/examples/envVariables.jsonnet",children:"examples/envVariables.jsonnet"})})]})]})]}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.h3,{id:"argokits-ingress-api",children:"argoKit's Ingress API"}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"Template"}),(0,n.jsx)(i.th,{children:"Description"}),(0,n.jsx)(i.th,{children:"Example"})]})}),(0,n.jsx)(i.tbody,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"argokit.application.forHostname"})}),(0,n.jsx)(i.td,{children:"Creates ingress for an app or a job"}),(0,n.jsx)(i.td,{children:(0,n.jsx)(i.a,{href:"https://github.com/kartverket/argokit/blob/main/v2/examples/ingress.jsonnet",children:"examples/ingress.jsonnet"})})]})})]}),"\n",(0,n.jsx)(i.h3,{id:"argokits-accesspolicies-api",children:"argoKit's accessPolicies API"}),"\n",(0,n.jsxs)(i.p,{children:["You can define what external services (hosts/IPs) and internal SKIP applications your app or job may communicate with.",(0,n.jsx)(i.br,{}),"\n","All functions work for both applications and skipJobs: ",(0,n.jsx)(i.code,{children:"argokit.application.*"})," or ",(0,n.jsx)(i.code,{children:"argokit.skipJob.*"}),"."]}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"Template"}),(0,n.jsx)(i.th,{children:"Description"}),(0,n.jsx)(i.th,{children:"Example"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"argokit.[application|skipJob].withOutboundPostgres(host, ip)"})}),(0,n.jsx)(i.td,{children:"Allow outbound traffic to a Postgres instance"}),(0,n.jsx)(i.td,{children:(0,n.jsx)(i.a,{href:"https://github.com/kartverket/argokit/blob/main/v2/examples/accessPolicies-for-job.jsonnet",children:"examples/accessPolicies-for-job.jsonnet"})})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"argokit.[application|skipJob].withOutboundOracle(host, ip)"})}),(0,n.jsx)(i.td,{children:"Allow outbound traffic to an Oracle DB"}),(0,n.jsx)(i.td,{children:(0,n.jsx)(i.a,{href:"https://github.com/kartverket/argokit/blob/main/v2/examples/accessPolicies-for-job.jsonnet",children:"examples/accessPolicies-for-job.jsonnet"})})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"argokit.[application|skipJob].withOutboundSsh(host, ip)"})}),(0,n.jsx)(i.td,{children:"Allow outbound SSH"}),(0,n.jsx)(i.td,{children:(0,n.jsx)(i.a,{href:"https://github.com/kartverket/argokit/blob/main/v2/examples/accessPolicies-for-job.jsonnet",children:"examples/accessPolicies-for-job.jsonnet"})})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"argokit.[application|skipJob].withOutboundLdaps(host, ip)"})}),(0,n.jsx)(i.td,{children:"Allow outbound secure LDAP port"}),(0,n.jsx)(i.td,{children:(0,n.jsx)(i.a,{href:"https://github.com/kartverket/argokit/blob/main/v2/examples/accessPolicies-for-job.jsonnet",children:"examples/accessPolicies-for-job.jsonnet"})})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"argokit.[application|skipJob].withOutboundHttp(host, portname='', port=443, protocol='')"})}),(0,n.jsx)(i.td,{children:"Allow outbound HTTPS/HTTP to a host"}),(0,n.jsx)(i.td,{children:(0,n.jsx)(i.a,{href:"https://github.com/kartverket/argokit/blob/main/v2/examples/accessPolicies-for-job.jsonnet",children:"examples/accessPolicies-for-job.jsonnet"})})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"argokit.[application|skipJob].withOutboundSkipApp(appname, namespace='')"})}),(0,n.jsx)(i.td,{children:"Allow outbound traffic to another SKIP application (outbound rule)"}),(0,n.jsx)(i.td,{children:(0,n.jsx)(i.a,{href:"https://github.com/kartverket/argokit/blob/main/v2/examples/accessPolicies-for-job.jsonnet",children:"examples/accessPolicies-for-job.jsonnet"})})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"argokit.[application|skipJob].withInboundSkipApp(appname, namespace='')"})}),(0,n.jsx)(i.td,{children:"Allow another SKIP application to reach this one (inbound rule)"}),(0,n.jsx)(i.td,{children:(0,n.jsx)(i.a,{href:"https://github.com/kartverket/argokit/blob/main/v2/examples/accessPolicies-for-job.jsonnet",children:"examples/accessPolicies-for-job.jsonnet"})})]})]})]}),"\n",(0,n.jsx)(i.h3,{id:"argokits-probe-api",children:"argoKit's Probe API"}),"\n",(0,n.jsx)(i.p,{children:"Configure health probes for applications and skipJobs."}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"Template"}),(0,n.jsx)(i.th,{children:"Description"}),(0,n.jsx)(i.th,{children:"Example"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"argokit.[application|skipJob].probe(path, port, failureThreshold=3, timeout=1, initialDelay=0)"})}),(0,n.jsx)(i.td,{children:"Builds a probe object (path, port, thresholds)"}),(0,n.jsx)(i.td,{children:"-"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"argokit.[application|skipJob].withReadiness(probe)"})}),(0,n.jsx)(i.td,{children:"Adds a readiness probe (controls when traffic is sent to the pod)"}),(0,n.jsx)(i.td,{children:(0,n.jsx)(i.a,{href:"https://github.com/kartverket/argokit/blob/main/v2/examples/probes.jsonnet",children:"examples/probes"})})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"argokit.[application|skipJob].withLiveness(probe)"})}),(0,n.jsx)(i.td,{children:"Adds a liveness probe (restarts container if failing)"}),(0,n.jsx)(i.td,{children:(0,n.jsx)(i.a,{href:"https://github.com/kartverket/argokit/blob/main/v2/examples/probes.jsonnet",children:"examples/probes"})})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"argokit.[application|skipJob].withStartup(probe)"})}),(0,n.jsx)(i.td,{children:"Adds a startup probe (gates other probes until it succeeds)"}),(0,n.jsx)(i.td,{children:(0,n.jsx)(i.a,{href:"https://github.com/kartverket/argokit/blob/main/v2/examples/probes.jsonnet",children:"examples/probes"})})]})]})]}),"\n",(0,n.jsx)(i.h2,{id:"contributing",children:"Contributing"}),"\n",(0,n.jsx)(i.p,{children:"Contributions are welcome! Please open an issue or PR if you would like to\nsee something changed or added."}),"\n",(0,n.jsx)(i.h2,{id:"license",children:"License"}),"\n",(0,n.jsxs)(i.p,{children:["ArgoKit is licensed under the MIT License. See ",(0,n.jsx)(i.a,{href:"https://github.com/kartverket/argokit/blob/main/LICENSE",children:"LICENSE"})," for the full\nlicense text."]})]})}function h(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},28453:(e,i,t)=>{t.d(i,{R:()=>o,x:()=>a});var s=t(96540);const n={},r=s.createContext(n);function o(e){const i=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),s.createElement(r.Provider,{value:i},e.children)}}}]);