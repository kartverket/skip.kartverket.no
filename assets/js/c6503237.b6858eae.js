"use strict";(self.webpackChunkskip_docs=self.webpackChunkskip_docs||[]).push([[6842],{28453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>l});var t=r(96540);const s={},i=t.createContext(s);function o(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(i.Provider,{value:n},e.children)}},49961:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>c,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"applikasjon-utrulling/argokit/appAndObjects","title":"AppAndObjects Konseptet","description":"Motivasjon","source":"@site/docs/03-applikasjon-utrulling/10-argokit/03-appAndObjects.md","sourceDirName":"03-applikasjon-utrulling/10-argokit","slug":"/applikasjon-utrulling/argokit/appAndObjects","permalink":"/docs/applikasjon-utrulling/argokit/appAndObjects","draft":false,"unlisted":false,"editUrl":"https://github.com/kartverket/skip-docs/edit/main/docs/03-applikasjon-utrulling/10-argokit/03-appAndObjects.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Kom i gang med ArgoKit","permalink":"/docs/applikasjon-utrulling/argokit/getting-started"},"next":{"title":"ArgoKit v1 API Reference","permalink":"/docs/applikasjon-utrulling/argokit/argokit-v1"}}');var s=r(74848),i=r(28453);const o={},l="AppAndObjects Konseptet",a={},d=[{value:"Motivasjon",id:"motivasjon",level:2},{value:"Introduksjon",id:"introduksjon",level:2},{value:"Innhold",id:"innhold",level:2},{value:"Hovedtemaer",id:"hovedtemaer",level:2},{value:"N\xe5r b\xf8r du bruke AppAndObjects",id:"n\xe5r-b\xf8r-du-bruke-appandobjects",level:3},{value:"N\xe5r trenger du ikke \xe5 bruke AppAndObjects",id:"n\xe5r-trenger-du-ikke-\xe5-bruke-appandobjects",level:3},{value:"Konseptuell modell",id:"konseptuell-modell",level:3},{value:"Eksempel med Azure AD Application",id:"eksempel-med-azure-ad-application",level:2},{value:"Uten App And Objects",id:"uten-app-and-objects",level:3},{value:"Med App And Objects",id:"med-app-and-objects",level:3}];function p(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"appandobjects-konseptet",children:"AppAndObjects Konseptet"})}),"\n",(0,s.jsx)(n.h2,{id:"motivasjon",children:"Motivasjon"}),"\n",(0,s.jsx)(n.p,{children:"N\xe5r du skal skrive mer komplekse manifester for applikasjoner med ekstra ressursser (som ConfigMap, ExternalSecret eller AzureAdApplication),\nm\xe5 du som regel legge til variabler, secrets, access policies eller annen konfigurasjon p\xe5 applikasjonsobjektet ditt.\nDette kan v\xe6re vanskelig \xe5 koordinere, da ofte navn m\xe5 stemme p\xe5 tvers av flere ressursser, og du m\xe5 huske p\xe5 sette krevd koknfigurasjon.\nAppAndObjects l\xf8ser dette ved at du kan legge til ekstra ressursser til din applikasjon og riktig konfigurasjon blir lagt til applikasjonsobjektet ditt automatisk."}),"\n",(0,s.jsx)(n.h2,{id:"introduksjon",children:"Introduksjon"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"AppAndObjects er et abstraksjonslag i ArgoKit over applikasjonsobjektet som lar deg legge til ekstra ressurser samtidig som du manipulerer applikasjonen."}),"\n",(0,s.jsx)(n.li,{children:"Samler applikasjon og relaterte ressurser i ett wrapper-objekt som renderes til en Kubernetes List."}),"\n",(0,s.jsx)(n.li,{children:"Denne siden forklarer hva AppAndObjects er, hvorfor det finnes, hvordan det fungerer p\xe5 et overordnet niv\xe5, og n\xe5r du b\xf8r bruke det."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"innhold",children:"Innhold"}),"\n",(0,s.jsx)(n.p,{children:"I stedet for \xe5 jobbe direkte p\xe5 ett objekt, jobber vi n\xe5 p\xe5 et slags wrapper-objekt med to felter: application og objects. Derav navnet AppAndObjects."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsonnet",children:"// uten AppAndObjects\n{\n  apiVersion: 'skiperator.kartverket.no/v1alpha1',\n  kind: 'Application',\n  metadata: {\n    name: 'test-app',\n  },\n}\n\n// med AppAndObjects\n{\n  application: {\n    apiVersion: 'skiperator.kartverket.no/v1alpha1',\n    kind: 'Application',\n    metadata: {\n      name: 'test-app',\n    },\n  },\n  objects: [] // ekstra Kubernetes-ressurser legges her\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"NB!"})," application-feltet kan ogs\xe5 inneholde et SKIPJob objekt."]}),"\n",(0,s.jsx)(n.h2,{id:"hovedtemaer",children:"Hovedtemaer"}),"\n",(0,s.jsx)(n.h3,{id:"n\xe5r-b\xf8r-du-bruke-appandobjects",children:"N\xe5r b\xf8r du bruke AppAndObjects"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"N\xe5r du vil knytte applikasjonen din til \xe9n eller flere relaterte ressurser (for eksempel Azure AD, ConfigMap, ExternalSecret) uten \xe5 koordinere navn, secrets og policies manuelt."}),"\n",(0,s.jsx)(n.li,{children:"N\xe5r du \xf8nsker en konsistent m\xe5te \xe5 legge til og fjerne integrasjoner p\xe5, slik at relevant konfigurasjon f\xf8lger med automatisk."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"n\xe5r-trenger-du-ikke-\xe5-bruke-appandobjects",children:"N\xe5r trenger du ikke \xe5 bruke AppAndObjects"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"N\xe5r du skal ha en enkel applikasjon uten tilleggsressurser (men AppAndObjects kan godt brukes her ogs\xe5)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"konseptuell-modell",children:"Konseptuell modell"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Wrapper-objektet"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["AppAndObjects representerer applikasjonen som et wrapper-objekt med to felter: ",(0,s.jsx)(n.code,{children:"application"})," og ",(0,s.jsx)(n.code,{children:"objects"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"application"})," er selve applikasjonsobjektet (Skiperator Application eller SKIPJob)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"objects"})," er en liste med tilleggsressurser som h\xf8rer til applikasjonen (for eksempel AzureAdApplication, ConfigMap, ExternalSecret)."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Utvidelser med"})," ",(0,s.jsx)(n.code,{children:".with*"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:".with*"}),"-funksjoner utvider modellen ved \xe5 oppdatere ",(0,s.jsx)(n.code,{children:"application"})," og samtidig legge til matchende ressurser i ",(0,s.jsx)(n.code,{children:"objects"})," der dette er relevant."]}),"\n",(0,s.jsx)(n.li,{children:"Referanser som f.eks. secrets og policies koordineres i samme operasjon for \xe5 redusere feil og duplisering."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Transformasjon ved rendering"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Ved rendering transformeres wrapper-objektet til en Kubernetes ",(0,s.jsx)(n.code,{children:"List"})," med ",(0,s.jsx)(n.code,{children:"application"})," og alle elementer i ",(0,s.jsx)(n.code,{children:"objects"})," som separate ",(0,s.jsx)(n.code,{children:"items"})]}),"\n",(0,s.jsx)(n.li,{children:"Dette gj\xf8r at du kan \u201capplye\u201d hele applikasjonen med tilh\xf8rende ressurser i \xe9n operasjon."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["AppAndObjects funksjoner bruker ",(0,s.jsx)(n.code,{children:".with"})," prefiks som betyr at du har en\napplikasjon ",(0,s.jsx)(n.em,{children:"med"})," noe ekstra. For eksempel ",(0,s.jsx)(n.code,{children:".withAzureAdApplication"}),".\nSe eksempelet under for hvordan dette ser ut i praksis:"]}),"\n",(0,s.jsx)(n.h2,{id:"eksempel-med-azure-ad-application",children:"Eksempel med Azure AD Application"}),"\n",(0,s.jsx)(n.p,{children:"Si at du \xf8nsker \xe5 legge til Azure AD i applikasjonen din, da er det et par ting du m\xe5 gj\xf8re:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Lage AzureAdApplication-ressursen"}),"\n",(0,s.jsx)(n.li,{children:"Sette access policies i applikasjonen som skal bruke AD"}),"\n",(0,s.jsxs)(n.li,{children:["Sette secret\nUten AppAndObjects m\xe5 du koordinere navn/namespace/secret manuelt. Med AppAndObjects h\xe5ndteres dette av ",(0,s.jsx)(n.code,{children:".withAzureAdApplication"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"uten-app-and-objects",children:"Uten App And Objects"}),"\n",(0,s.jsx)(n.p,{children:"Her definerer vi f\xf8rst en ny Skiperator Application med tilh\xf8rende access policies for Microsoft, i tillegg til \xe5 legge inn env fra secret som matcher Azure AD Application.\nDeretter definerer vi en ny AzureAdApplication-ressurs med matchende name og secretPrefix som i steget over."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsonnet",children:"local argokit = import '../jsonnet/argokit.libsonnet';\nlocal application = argokit.application;\n\n[\n  application.new('foo-backend')\n  + application.withOutboundHttp('login.microsoftonline.com')\n  + application.withSecret('foosecrets-foo-ad'),\n\n  argokit.azureAdApplication.new(\n    name='foo-ad',\n    namespace='foo-team-main',\n    secretPrefix='foosecrets',\n  ),\n]\n"})}),"\n",(0,s.jsx)(n.h3,{id:"med-app-and-objects",children:"Med App And Objects"}),"\n",(0,s.jsxs)(n.p,{children:["N\xe5r vi har AppAndObjects-abstraksjonslaget kan vi f\xf8rst definere en applikasjon, deretter kalle\n",(0,s.jsx)(n.code,{children:".withAzureAdApplication"})," p\xe5 dette objektet.\nDet vil gj\xf8re to ting: opprette et AzureAdApplication-objekt, helt likt som i eksempelet over, og legge det til i ",(0,s.jsx)(n.code,{children:"objects"}),"-lista.\nDeretter vil access policies og env fra secret bli satt med riktig navn.\nFordelen er at all konfigurasjon som trengs for \xe5 legge til Azure AD i applikasjonen din, er bakt inn i ",(0,s.jsx)(n.code,{children:".withAzureAdApplication()"}),",\ns\xe5 du slipper \xe5 tenke p\xe5 det. Det vil ogs\xe5 f\xf8re til at dersom du bytter ut/fjerner Azure AD, kan du fjerne ett funksjonskall, s\xe5 vil annen sammenhengende konfigurasjon ogs\xe5 bli fjernet."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsonnet",children:"local argokit = import '../jsonnet/argokit.libsonnet';\nlocal application = argokit.appAndObjects.application; // bruk appAndObjects\n\napplication.new('foo-backend')\n+ application.withAzureAdApplication(\n  name='foo-ad',\n  namespace='foo-team-main',\n  secretPrefix='foosecrets',\n)\n"})})]})}function c(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}}}]);