"use strict";(globalThis.webpackChunkskip_docs=globalThis.webpackChunkskip_docs||[]).push([[4043],{90630(e,n,t){t.r(n),t.d(n,{assets:()=>h,contentTitle:()=>p,default:()=>j,frontMatter:()=>c,metadata:()=>r,toc:()=>g});const r=JSON.parse('{"id":"applikasjon-utrulling/tilgangsstyring/ztoperator/index","title":"Ztoperator","description":"Ztoperator er en Kubernetes-operator som lar deg deklarativt definere hvordan tilgang til en applikasjons endepunkter skal styres. Den gir st\xf8tte for \xe5","source":"@site/docs/03-applikasjon-utrulling/04-tilgangsstyring/02-ztoperator/index.mdx","sourceDirName":"03-applikasjon-utrulling/04-tilgangsstyring/02-ztoperator","slug":"/applikasjon-utrulling/tilgangsstyring/ztoperator/","permalink":"/docs/applikasjon-utrulling/tilgangsstyring/ztoperator/","draft":false,"unlisted":false,"editUrl":"https://github.com/kartverket/skip-docs/edit/main/docs/03-applikasjon-utrulling/04-tilgangsstyring/02-ztoperator/index.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Ansattporten","permalink":"/docs/applikasjon-utrulling/tilgangsstyring/klientregistrering/ansattporten"},"next":{"title":"Tutorials","permalink":"/docs/applikasjon-utrulling/tilgangsstyring/ztoperator/tutorials"}}');var i=t(74848),o=t(28453);const s=t.p+"assets/images/ztoperator-logo-29b99be6f3f57bff5fbcdcbd3812eab4.png";t(96540);var l=t(34164);function d({children:e,className:n,style:t}){return(0,i.jsx)("div",{className:"container center",children:(0,i.jsx)("div",{className:(0,l.A)("row",n),style:t,children:e})})}function a({children:e,className:n,style:t}){return(0,i.jsx)("div",{className:(0,l.A)("col",n),style:t,children:e})}const c={},p="Ztoperator",h={},g=[{value:"\ud83d\ude80 Innlogging og utlogging med Ztoperator",id:"-innlogging-og-utlogging-med-ztoperator",level:2},{value:"\ud83c\udfac Tutorials",id:"-tutorials",level:2},{value:"\ud83d\udee0 St\xf8ttede identitetstilbydere",id:"-st\xf8ttede-identitetstilbydere",level:2}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"ztoperator",children:"Ztoperator"})}),"\n",(0,i.jsxs)(d,{children:[(0,i.jsxs)(a,{className:"col--8",children:[(0,i.jsx)(n.p,{children:"Ztoperator er en Kubernetes-operator som lar deg deklarativt definere hvordan tilgang til en applikasjons endepunkter skal styres. Den gir st\xf8tte for \xe5"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"definere hvilke endepunkter som skal v\xe6re \xe5pne."}),"\n",(0,i.jsx)(n.li,{children:"definere hvilke endepunkter som krever et gyldig OAuth 2.0-token."}),"\n",(0,i.jsx)(n.li,{children:"definere hvilke endepunkter som krever spesifikke claims."}),"\n",(0,i.jsx)(n.li,{children:"definere hvilke endepunkter som skal omdirigere brukeren til innlogging."}),"\n"]})]}),(0,i.jsx)(a,{className:"text--center",children:(0,i.jsx)("img",{src:s,style:{width:300}})})]}),"\n",(0,i.jsxs)(n.p,{children:["Ztoperator konfigureres opp mot en identitetstilbyder med feltet ",(0,i.jsx)(n.code,{children:"spec.wellKnownURI"}),", som peker til et ",(0,i.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-discovery-1_0.html",children:"OpenID Connect Discovery Document"}),". Dette dokumentet inneholder informasjon om hvordan Ztoperator skal kommunisere med identitetstilbyderen, slik som endepunkter for autentisering, tokenvalidering og utlogging.\nHvilke identitetstilbydere Ztoperator st\xf8tter per n\xe5 kan ses under ",(0,i.jsx)(n.a,{href:"#-st%C3%B8ttede-identitetstilbydere",children:"St\xf8ttede identitetstilbydere"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Hvilke felter som eksisterer og deres oppf\xf8rsel er dokumentert i ",(0,i.jsx)(n.a,{href:"/docs/applikasjon-utrulling/tilgangsstyring/ztoperator/api-docs",children:"API Reference"}),".\nHvordan du kan teste og verifisere oppf\xf8rselen til en ",(0,i.jsx)(n.code,{children:"AuthPolicy"})," finner du under ",(0,i.jsx)(n.a,{href:"/docs/applikasjon-utrulling/tilgangsstyring/ztoperator/test-authpolicy",children:"Test din Ztoperator-AuthPolicy"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"-innlogging-og-utlogging-med-ztoperator",children:"\ud83d\ude80 Innlogging og utlogging med Ztoperator"}),"\n",(0,i.jsxs)(n.p,{children:["Det g\xe5r an \xe5 konfigurere Ztoperator til \xe5 h\xe5ndtere innlogging og utlogging av sluttbrukere p\xe5 vegne av applikasjonen din.\nDette gj\xf8res ved \xe5 sette opp ",(0,i.jsx)(n.code,{children:"spec.autoLogin"})," og ",(0,i.jsx)(n.code,{children:"spec.oAuthCredentials"})," i Ztoperator-",(0,i.jsx)(n.code,{children:"AuthPolicy"}),"-ressursen din.\n",(0,i.jsx)(n.code,{children:"spec.autoLogin"})," konfigurerer ulike endepunkter brukt i innloggings -og utloggingsflyten, mens ",(0,i.jsx)(n.code,{children:"spec.oAuthCredentials"}),"\npeker til en Kubernetes-hemmelighet som inneholder klient-ID ",(0,i.jsx)(n.code,{children:"client_id"})," og klienthemmelighet ",(0,i.jsx)(n.code,{children:"client_secret"})," for en registrert OIDC-klient hos identitetstilbyderen."]}),"\n",(0,i.jsxs)(n.p,{children:["En annen ting \xe5 merke seg er at Ztoperator ikke har lov til \xe5 laste inn hemmeligheter som brukes for innlogging i den beskyttede applikasjonen.\nFor \xe5 l\xf8se dette er man n\xf8dt til \xe5 legge til en konfigurasjon p\xe5 den beskyttede Skiperator-applikasjonen for at innloggingshemligheter som Ztoperator h\xe5ndterer skal kunne lastes inn.\nF\xf8lgende eksempel viser hvordan dette kan gj\xf8res i en Skiperator-applikasjon. Hvorfor det m\xe5 til overlates som en oppgave til leseren, men det viktige er at\nman er n\xf8dt til \xe5 erstatte ",(0,i.jsx)(n.code,{children:"<NAVN P\xc5 AUTHPOLICY>"})," med navnet p\xe5 sin Ztoperator-",(0,i.jsx)(n.code,{children:"AuthPolicy"}),". S\xe5 hvis din ",(0,i.jsx)(n.code,{children:"AuthPolicy"})," heter ",(0,i.jsx)(n.code,{children:"my-auth-policy"}),", s\xe5 m\xe5 du sette ",(0,i.jsx)(n.code,{children:"secretName: my-auth-policy-envoy-secret"}),"."]}),"\n",(0,i.jsx)(n.admonition,{title:"OBS",type:"danger",children:(0,i.jsxs)(n.p,{children:["For at innlogging skal fungere med Ztoperator, ",(0,i.jsx)(n.strong,{children:"m\xe5"})," den beskyttede Skiperator-applikasjonen oppdateres med\n",(0,i.jsx)(n.code,{children:"spec.podSettings.annotations.sidecar.istio.io/userVolume"})," og ",(0,i.jsx)(n.code,{children:"spec.podSettings.annotations.sidecar.istio.io/userVolumeMount"}),"."]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="Skiperator-applikasjon med Ztoperator-innlogging"',children:'apiVersion: skiperator.kartverket.no/v1alpha1\nkind: Application\nmetadata:\n  name: myapp\nspec:\n//diff-add-start\n  podSettings:\n    annotations:\n      sidecar.istio.io/userVolume: |\n        [\n          {\n            "name": "istio-oauth2",\n            "secret": {\n              "secretName": "<NAVN P\xc5 AUTHPOLICY>-envoy-secret"\n            }\n          }\n        ]\n      sidecar.istio.io/userVolumeMount: |\n        [\n          {\n            "name": "istio-oauth2",\n            "mountPath": "/etc/istio/config",\n            "readonly": true\n          }\n        ]\n//diff-add-end\n  image: ghcr.io/kartverket/myapp:latest\n  port: 8080\n  ingresses:\n    - myapp.atkv3-dev.kartverket-intern.cloud\n  redirectToHTTPS: true\n  accessPolicy:\n    inbound: \n      rules:\n        - application: myjob-skipjob\n'})}),"\n",(0,i.jsx)(n.h2,{id:"-tutorials",children:"\ud83c\udfac Tutorials"}),"\n",(0,i.jsx)(n.p,{children:"I denne docsen finner du en rekke tutorials p\xe5 hvordan du tar i bruk Ztoperator for \xe5 beskytte en applikasjon p\xe5 SKIP."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/applikasjon-utrulling/tilgangsstyring/ztoperator/tutorials#--microsoft-entra-id",children:"Eksempeloppsett av Ztoperator: Microsoft Entra ID"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/applikasjon-utrulling/tilgangsstyring/ztoperator/tutorials#-id-porten",children:"Eksempeloppsett av Ztoperator: ID-Porten"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/applikasjon-utrulling/tilgangsstyring/ztoperator/tutorials#-ansattporten",children:"Eksempeloppsett av Ztoperator: Ansattporten"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"-st\xf8ttede-identitetstilbydere",children:"\ud83d\udee0 St\xf8ttede identitetstilbydere"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Milj\xf8"}),(0,i.jsx)(n.th,{children:"Identitetstilbyder"}),(0,i.jsx)(n.th,{children:(0,i.jsx)(n.code,{children:"wellKnownURI"})})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PROD"})}),(0,i.jsx)(n.td,{children:"Microsoft Entra ID (Kartverket)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://login.microsoftonline.com/7f74c8a2-43ce-46b2-b0e8-b6306cba73a3/v2.0/.well-known/openid-configuration",children:"https://login.microsoftonline.com/7f74c8a2-43ce-46b2-b0e8-b6306cba73a3/v2.0/.well-known/openid-configuration"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TEST"})}),(0,i.jsx)(n.td,{children:"ID-porten"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://test.idporten.no/.well-known/openid-configuration",children:"https://test.idporten.no/.well-known/openid-configuration"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PROD"})}),(0,i.jsx)(n.td,{children:"ID-porten"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://idporten.no/.well-known/openid-configuration",children:"https://idporten.no/.well-known/openid-configuration"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TEST"})}),(0,i.jsx)(n.td,{children:"Maskinporten"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://test.maskinporten.no/.well-known/oauth-authorization-server",children:"https://test.maskinporten.no/.well-known/oauth-authorization-server"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PROD"})}),(0,i.jsx)(n.td,{children:"Maskinporten"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://maskinporten.no/.well-known/oauth-authorization-server",children:"https://maskinporten.no/.well-known/oauth-authorization-server"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"TEST"})}),(0,i.jsx)(n.td,{children:"Ansattporten"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://test.ansattporten.no/.well-known/openid-configuration",children:"https://test.ansattporten.no/.well-known/openid-configuration"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PROD"})}),(0,i.jsx)(n.td,{children:"Ansattporten"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://ansattporten.no/.well-known/openid-configuration",children:"https://ansattporten.no/.well-known/openid-configuration"})})]})]})]})]})}function j(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},28453(e,n,t){t.d(n,{R:()=>s,x:()=>l});var r=t(96540);const i={},o=r.createContext(i);function s(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);