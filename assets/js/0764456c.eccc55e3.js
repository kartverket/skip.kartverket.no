"use strict";(self.webpackChunkskip_docs=self.webpackChunkskip_docs||[]).push([[994],{28453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>d});var r=n(96540);const s={},l=r.createContext(s);function i(e){const t=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(l.Provider,{value:t},e.children)}},68374:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"applikasjon-utrulling/argokit/argokit-v1","title":"Argokit V1","description":"ArgoKit er et sett med gjenbrukbare jsonnet templates som gj\xf8r det enklere \xe5 rulle ut ArgoCD-applikasjoner p\xe5 SKIP.","source":"@site/docs/03-applikasjon-utrulling/10-argokit/02-argokit-v1.md","sourceDirName":"03-applikasjon-utrulling/10-argokit","slug":"/applikasjon-utrulling/argokit/argokit-v1","permalink":"/docs/applikasjon-utrulling/argokit/argokit-v1","draft":false,"unlisted":false,"editUrl":"https://github.com/kartverket/skip-docs/edit/main/docs/03-applikasjon-utrulling/10-argokit/02-argokit-v1.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Velkommen til ArgoKit \ud83e\udd91","permalink":"/docs/applikasjon-utrulling/argokit/argokit-velkommen"},"next":{"title":"ArgoKit v2","permalink":"/docs/applikasjon-utrulling/argokit/argokit-v2"}}');var s=n(74848),l=n(28453);const i={},d="Argokit V1",o={},a=[{value:"Installasjon",id:"installasjon",level:2},{value:"Automatiske versjonsoppdateringer",id:"automatiske-versjonsoppdateringer",level:3},{value:"Bruk med jsonnet",id:"bruk-med-jsonnet",level:2},{value:"jsonnet argokit API",id:"jsonnet-argokit-api",level:3},{value:"Input parametre",id:"input-parametre",level:3},{value:"dbArchiveJob",id:"dbarchivejob",level:4},{value:"Bidrag",id:"bidrag",level:2}];function c(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"argokit-v1",children:"Argokit V1"})}),"\n",(0,s.jsx)("div",{style:{margin:"0 auto 2rem auto",maxWidth:"300px"},children:(0,s.jsx)("img",{src:"https://github.com/kartverket/argokit/raw/main/logo.png",alt:"ArgoKit Logo",width:"100%"})}),"\n",(0,s.jsxs)(t.p,{children:["ArgoKit er et sett med gjenbrukbare jsonnet templates som gj\xf8r det enklere \xe5 rulle ut ArgoCD-applikasjoner p\xe5 SKIP.\nHvis du har sp\xf8rsm\xe5l, ta kontakt med ",(0,s.jsx)(t.a,{href:"https://kartverketgroup.slack.com/archives/C04KH6A4FNW",children:"#gen-argocd"})," kanalen p\xe5 Slack.\nDu finner koden ",(0,s.jsx)(t.a,{href:"https://github.com/kartverket/argokit",children:"her"}),"."]}),"\n",(0,s.jsx)(t.h2,{id:"installasjon",children:"Installasjon"}),"\n",(0,s.jsxs)(t.p,{children:["Forutsatt at du har fulgt ",(0,s.jsx)(t.a,{href:"/docs/applikasjon-utrulling/argo-cd/komme-i-gang-med-argocd",children:"Komme i gang"}),"-guiden, kan du bruke ArgoKit i ditt apps-repo.\nF\xf8rste steg er \xe5 inkludere ArgoKit-biblioteket ved \xe5 kj\xf8re f\xf8lgende kommando:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"$ git submodule add https://github.com/kartverket/argokit.git\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Alternativt kan du bruke jsonnet-bundler hvis du foretrekker \xe5 bruke en package manager fremfor submoduler.\nFor \xe5 gj\xf8re dette, installer CLI-en ved \xe5 f\xf8lge instruksjonene i ",(0,s.jsx)(t.a,{href:"https://github.com/jsonnet-bundler/jsonnet-bundler",children:"jsonnet-bundler"})," repoet og kj\xf8r f\xf8lgende kommando:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"$ jb install https://github.com/kartverket/argokit@main\n"})}),"\n",(0,s.jsx)(t.h3,{id:"automatiske-versjonsoppdateringer",children:"Automatiske versjonsoppdateringer"}),"\n",(0,s.jsxs)(t.p,{children:["Det anbefales sterkt \xe5 bruke dependabot for \xe5 automatisk oppdatere ArgoKit-versjonen n\xe5r en ny versjon blir utgitt.\nFor \xe5 gj\xf8re dette, legg til f\xf8lgende i din ",(0,s.jsx)(t.code,{children:".github/dependabot.yml"})," fil:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",children:"version: 2\nupdates:\n  - package-ecosystem: git-submodules\n    directory: /\n    schedule:\n      interval: daily\n"})}),"\n",(0,s.jsx)(t.p,{children:"Med denne konfigurasjonen vil dependabot sjekke \xe9n gang om dagen om det finnes en ny versjon av ArgoKit. Hvis den finner en ny versjon, oppretter den automatisk en PR for \xe5 oppdatere versjonen."}),"\n",(0,s.jsx)(t.h2,{id:"bruk-med-jsonnet",children:"Bruk med jsonnet"}),"\n",(0,s.jsxs)(t.p,{children:["For grunnleggende informasjon om jsonnet, se ",(0,s.jsx)(t.a,{href:"/docs/applikasjon-utrulling/argo-cd/hva-er-et-apps-repo#gjenbruke-konfigurasjon",children:"Gjenbruke konfigurasjon"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["Hvis du bruker jsonnet i ditt apps-repo, kan du bruke ArgoKit-biblioteket til \xe5 rulle ut ArgoCD-applikasjoner ved \xe5 inkludere ",(0,s.jsx)(t.code,{children:"argokit.libsonnet"}),"-filen i din jsonnet-fil og kalle ",(0,s.jsx)(t.code,{children:"argokit.Application"}),"-funksjonen.\nFor eksempel, for \xe5 rulle ut en applikasjon, kan du bruke f\xf8lgende jsonnet-fil:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-jsonnet",children:'local argokit = import \'argokit/jsonnet/argokit.libsonnet\';\n\nlocal Probe = {\n    path: "/healthz",\n    port: 8080,\n    failureThreshold: 3,\n    timeout: 1,\n    initialDelay: 0,\n};\n\nlocal BaseApp = {\n    spec: {\n        port: 8080,\n        replicas: {\n            min: 2,\n            max: 5,\n            targetCPUUtilization: 80,\n        },\n        liveness: Probe,\n        readiness: Probe,\n    },\n};\n\n[\n    BaseApp + argokit.Application("foo-backend") {\n        spec+: {\n            image: "hello-world",\n            ingresses: ["foo.bar.com"],\n            accessPolicy: {\n                inbound: {\n                    rules: [{\n                        application: "foo-frontend",\n                    }],\n                },\n            },\n        },\n    },\n]\n'})}),"\n",(0,s.jsx)(t.h3,{id:"jsonnet-argokit-api",children:"jsonnet argokit API"}),"\n",(0,s.jsxs)(t.p,{children:["F\xf8lgende templates er tilgjengelige for bruk i ",(0,s.jsx)(t.code,{children:"argokit.libsonnet"}),"-filen:"]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Template"}),(0,s.jsx)(t.th,{children:"Beskrivelse"}),(0,s.jsx)(t.th,{children:"Eksempel"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"argokit.Application"})}),(0,s.jsx)(t.td,{children:"Oppretter en Skiperator-applikasjon"}),(0,s.jsx)(t.td,{children:"Se ovenfor"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"argokit.GSMSecretStore"})}),(0,s.jsxs)(t.td,{children:["Oppretter en Google Secret Manager External Secrets ",(0,s.jsx)(t.code,{children:"SecretStore"})]}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.a,{href:"https://github.com/kartverket/argokit/blob/main/examples/jsonnet/secretstore-gsm.jsonnet",children:"examples/jsonnet/secretstore-gsm.jsonnet"})})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"argokit.GSMSecret"})}),(0,s.jsxs)(t.td,{children:["Oppretter en Google Secret Manager External Secrets ",(0,s.jsx)(t.code,{children:"Secret"})]}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.a,{href:"https://github.com/kartverket/argokit/blob/main/examples/jsonnet/secretstore-gsm.jsonnet",children:"examples/jsonnet/secretstore-gsm.jsonnet"})})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"argokit.Roles"})}),(0,s.jsx)(t.td,{children:"Oppretter et sett med RBAC-roller for dette navnerommet"}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.a,{href:"https://github.com/kartverket/argokit/blob/main/examples/jsonnet/roles.jsonnet",children:"examples/jsonnet/roles.jsonnet"})})]})]})]}),"\n",(0,s.jsxs)(t.p,{children:["F\xf8lgende templates er tilgjengelige for bruk i ",(0,s.jsx)(t.code,{children:"dbArchive.libsonnet"}),"-filen:"]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Template"}),(0,s.jsx)(t.th,{children:"Beskrivelse"}),(0,s.jsx)(t.th,{children:"Eksempel"})]})}),(0,s.jsx)(t.tbody,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"dbArchive.dbArchiveJob"})}),(0,s.jsx)(t.td,{children:"Oppretter en SKIPJob som lager en sql-dump og lagrer den i S3"}),(0,s.jsx)(t.td,{children:(0,s.jsx)(t.a,{href:"https://github.com/kartverket/argokit/blob/main/examples/jsonnet/dbArchive.jsonnet",children:"examples/jsonnet/dbArchive.jsonnet"})})]})})]}),"\n",(0,s.jsx)(t.h3,{id:"input-parametre",children:"Input parametre"}),"\n",(0,s.jsx)(t.h4,{id:"dbarchivejob",children:"dbArchiveJob"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Parameter"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Type"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Standardverdi"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Beskrivelse"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:(0,s.jsx)(t.code,{children:"instanceName"})})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"-"}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.strong,{children:"P\xe5krevd."})," Et unikt navn for jobben og relaterte ressurser. Dette navnet brukes som base for ",(0,s.jsx)(t.code,{children:"SKIPJob"})," og hemmeligheter."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:(0,s.jsx)(t.code,{children:"schedule"})})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"-"}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.strong,{children:"P\xe5krevd."})," En cron uttrykk som definerer n\xe5r jobben skal kj\xf8re (f.eks. ",(0,s.jsx)(t.code,{children:'"0 2 * * *"'})," for \xe5 kj\xf8re kl. 02:00 hver natt)."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:(0,s.jsx)(t.code,{children:"databaseIP"})})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"-"}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.strong,{children:"P\xe5krevd."})," IP-adressen til PostgreSQL-databasen som skal arkiveres."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:(0,s.jsx)(t.code,{children:"gcpS3CredentialsSecret"})})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"-"}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.strong,{children:"P\xe5krevd."})," Navn p\xe5 hemmeligheten i GSM som inneholder S3-hemmeligheter (",(0,s.jsx)(t.code,{children:"AWS_ACCESS_KEY_ID"})," og ",(0,s.jsx)(t.code,{children:"AWS_SECRET_ACCESS_KEY"}),")."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:(0,s.jsx)(t.code,{children:"databaseName"})})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"-"}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.strong,{children:"P\xe5krevd."})," Navn p\xe5 databasen som skal arkiveres."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:(0,s.jsx)(t.code,{children:"archiveUser"})})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"'postgres'"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Databasebrukeren jobben skal bruke for \xe5 koble til."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:(0,s.jsx)(t.code,{children:"serviceAccount"})})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"'dummyaccount@gcp.iam'"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"GCP Service Account som brukes av Kubernetes-jobben for \xe5 autentisere mot Google Cloud (f.eks. for \xe5 hente hemmeligheter fra GSM)."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:(0,s.jsx)(t.code,{children:"cloudsqlInstanceConnectionName"})})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"-"}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.strong,{children:"P\xe5krevd."})," Tilkoblingsnavnet til Cloud SQL-instansen (format: ",(0,s.jsx)(t.code,{children:"project:region:instance"}),"). N\xf8dvendig for Cloud SQL Auth Proxy."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:(0,s.jsx)(t.code,{children:"port"})})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Integer"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"5432"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Portnummeret til PostgreSQL-databasen."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:(0,s.jsx)(t.code,{children:"S3Host"})})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"'s3-rin.statkart.no'"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Hostnavnet til S3-endepunktet hvor arkivet skal lagres."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:(0,s.jsx)(t.code,{children:"S3DestinationPath"})})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"-"}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:[(0,s.jsx)(t.strong,{children:"P\xe5krevd."})," Full S3-sti hvor databasearkivet skal plasseres (f.eks. ",(0,s.jsx)(t.code,{children:"s3://my-bucket/archive/database/"}),")."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:(0,s.jsx)(t.code,{children:"fullDump"})})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Bool"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"false"}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["Flagg for \xe5 inkludere databaseroller ",(0,s.jsx)(t.code,{children:"uten passord"})," i dumpen."]})]})]})]}),"\n",(0,s.jsx)(t.h2,{id:"bidrag",children:"Bidrag"}),"\n",(0,s.jsx)(t.p,{children:"Bidrag er velkomne! Vennligst \xe5pne et issue eller PR hvis du \xf8nsker \xe5\nse noe endret eller lagt til."})]})}function h(e={}){const{wrapper:t}={...(0,l.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}}}]);