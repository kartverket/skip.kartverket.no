"use strict";(self.webpackChunkskip_docs=self.webpackChunkskip_docs||[]).push([[440,7336],{11470:(e,n,t)=>{t.d(n,{A:()=>y});var r=t(96540),i=t(34164),s=t(23104),o=t(56347),l=t(205),a=t(57485),d=t(31682),c=t(70679);function u(e){return r.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function g(e){const{values:n,children:t}=e;return(0,r.useMemo)(()=>{const e=n??function(e){return u(e).map(({props:{value:e,label:n,attributes:t,default:r}})=>({value:e,label:n,attributes:t,default:r}))}(t);return function(e){const n=(0,d.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,t])}function p({value:e,tabValues:n}){return n.some(n=>n.value===e)}function h({queryString:e=!1,groupId:n}){const t=(0,o.W6)(),i=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,a.aZ)(i),(0,r.useCallback)(e=>{if(!i)return;const n=new URLSearchParams(t.location.search);n.set(i,e),t.replace({...t.location,search:n.toString()})},[i,t])]}function m(e){const{defaultValue:n,queryString:t=!1,groupId:i}=e,s=g(e),[o,a]=(0,r.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!p({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find(e=>e.default)??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:s})),[d,u]=h({queryString:t,groupId:i}),[m,f]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,i]=(0,c.Dv)(n);return[t,(0,r.useCallback)(e=>{n&&i.set(e)},[n,i])]}({groupId:i}),k=(()=>{const e=d??m;return p({value:e,tabValues:s})?e:null})();(0,l.A)(()=>{k&&a(k)},[k]);return{selectedValue:o,selectValue:(0,r.useCallback)(e=>{if(!p({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);a(e),u(e),f(e)},[u,f,s]),tabValues:s}}var f=t(92303);const k={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var j=t(74848);function v({className:e,block:n,selectedValue:t,selectValue:r,tabValues:o}){const l=[],{blockElementScrollPositionUntilNextRender:a}=(0,s.a_)(),d=e=>{const n=e.currentTarget,i=l.indexOf(n),s=o[i].value;s!==t&&(a(n),r(s))},c=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const t=l.indexOf(e.currentTarget)+1;n=l[t]??l[0];break}case"ArrowLeft":{const t=l.indexOf(e.currentTarget)-1;n=l[t]??l[l.length-1];break}}n?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":n},e),children:o.map(({value:e,label:n,attributes:r})=>(0,j.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{l.push(e)},onKeyDown:c,onClick:d,...r,className:(0,i.A)("tabs__item",k.tabItem,r?.className,{"tabs__item--active":t===e}),children:n??e},e))})}function x({lazy:e,children:n,selectedValue:t}){const s=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=s.find(e=>e.props.value===t);return e?(0,r.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:s.map((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==t}))})}function b(e){const n=m(e);return(0,j.jsxs)("div",{className:(0,i.A)("tabs-container",k.tabList),children:[(0,j.jsx)(v,{...n,...e}),(0,j.jsx)(x,{...n,...e})]})}function y(e){const n=(0,f.A)();return(0,j.jsx)(b,{...e,children:u(e.children)},String(n))}},19365:(e,n,t)=>{t.d(n,{A:()=>o});t(96540);var r=t(34164);const i={tabItem:"tabItem_Ymn6"};var s=t(74848);function o({children:e,hidden:n,className:t}){return(0,s.jsx)("div",{role:"tabpanel",className:(0,r.A)(i.tabItem,t),hidden:n,children:e})}},27293:(e,n,t)=>{t.d(n,{A:()=>z});var r=t(96540),i=t(74848);function s(e){const{mdxAdmonitionTitle:n,rest:t}=function(e){const n=r.Children.toArray(e),t=n.find(e=>r.isValidElement(e)&&"mdxAdmonitionTitle"===e.type),s=n.filter(e=>e!==t),o=t?.props.children;return{mdxAdmonitionTitle:o,rest:s.length>0?(0,i.jsx)(i.Fragment,{children:s}):null}}(e.children),s=e.title??n;return{...e,...s&&{title:s},children:t}}var o=t(34164),l=t(21312),a=t(17559);const d="admonition_xJq3",c="admonitionHeading_Gvgb",u="admonitionIcon_Rf37",g="admonitionContent_BuS1";function p({type:e,className:n,children:t}){return(0,i.jsx)("div",{className:(0,o.A)(a.G.common.admonition,a.G.common.admonitionType(e),d,n),children:t})}function h({icon:e,title:n}){return(0,i.jsxs)("div",{className:c,children:[(0,i.jsx)("span",{className:u,children:e}),n]})}function m({children:e}){return e?(0,i.jsx)("div",{className:g,children:e}):null}function f(e){const{type:n,icon:t,title:r,children:s,className:o}=e;return(0,i.jsxs)(p,{type:n,className:o,children:[r||t?(0,i.jsx)(h,{title:r,icon:t}):null,(0,i.jsx)(m,{children:s})]})}function k(e){return(0,i.jsx)("svg",{viewBox:"0 0 14 16",...e,children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})})}const j={icon:(0,i.jsx)(k,{}),title:(0,i.jsx)(l.A,{id:"theme.admonition.note",description:"The default label used for the Note admonition (:::note)",children:"note"})};function v(e){return(0,i.jsx)(f,{...j,...e,className:(0,o.A)("alert alert--secondary",e.className),children:e.children})}function x(e){return(0,i.jsx)("svg",{viewBox:"0 0 12 16",...e,children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})})}const b={icon:(0,i.jsx)(x,{}),title:(0,i.jsx)(l.A,{id:"theme.admonition.tip",description:"The default label used for the Tip admonition (:::tip)",children:"tip"})};function y(e){return(0,i.jsx)(f,{...b,...e,className:(0,o.A)("alert alert--success",e.className),children:e.children})}function A(e){return(0,i.jsx)("svg",{viewBox:"0 0 14 16",...e,children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})})}const I={icon:(0,i.jsx)(A,{}),title:(0,i.jsx)(l.A,{id:"theme.admonition.info",description:"The default label used for the Info admonition (:::info)",children:"info"})};function w(e){return(0,i.jsx)(f,{...I,...e,className:(0,o.A)("alert alert--info",e.className),children:e.children})}function D(e){return(0,i.jsx)("svg",{viewBox:"0 0 16 16",...e,children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})})}const E={icon:(0,i.jsx)(D,{}),title:(0,i.jsx)(l.A,{id:"theme.admonition.warning",description:"The default label used for the Warning admonition (:::warning)",children:"warning"})};function N(e){return(0,i.jsx)("svg",{viewBox:"0 0 12 16",...e,children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"})})}const S={icon:(0,i.jsx)(N,{}),title:(0,i.jsx)(l.A,{id:"theme.admonition.danger",description:"The default label used for the Danger admonition (:::danger)",children:"danger"})};const T={icon:(0,i.jsx)(D,{}),title:(0,i.jsx)(l.A,{id:"theme.admonition.caution",description:"The default label used for the Caution admonition (:::caution)",children:"caution"})};const P={...{note:v,tip:y,info:w,warning:function(e){return(0,i.jsx)(f,{...E,...e,className:(0,o.A)("alert alert--warning",e.className),children:e.children})},danger:function(e){return(0,i.jsx)(f,{...S,...e,className:(0,o.A)("alert alert--danger",e.className),children:e.children})}},...{secondary:e=>(0,i.jsx)(v,{title:"secondary",...e}),important:e=>(0,i.jsx)(w,{title:"important",...e}),success:e=>(0,i.jsx)(y,{title:"success",...e}),caution:function(e){return(0,i.jsx)(f,{...T,...e,className:(0,o.A)("alert alert--warning",e.className),children:e.children})}}};function z(e){const n=s(e),t=(r=n.type,P[r]||(console.warn(`No admonition component found for admonition type "${r}". Using Info as fallback.`),P.info));var r;return(0,i.jsx)(t,{...n})}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>l});var r=t(96540);const i={},s=r.createContext(i);function o(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(s.Provider,{value:n},e.children)}},86155:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>g});const r=JSON.parse('{"id":"applikasjon-utrulling/tilgangsstyring/auto-login","title":"Auto-login","description":"SKIP st\xf8tter automatisk provisjonering av ressurser i en applikasjons Istio-sidecar for \xe5 h\xe5ndtere OAuth 2.0 authorization code flow.","source":"@site/docs/03-applikasjon-utrulling/04-tilgangsstyring/03-auto-login.mdx","sourceDirName":"03-applikasjon-utrulling/04-tilgangsstyring","slug":"/applikasjon-utrulling/tilgangsstyring/auto-login","permalink":"/docs/applikasjon-utrulling/tilgangsstyring/auto-login","draft":false,"unlisted":false,"editUrl":"https://github.com/kartverket/skip-docs/edit/main/docs/03-applikasjon-utrulling/04-tilgangsstyring/03-auto-login.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Token-validering og grovkornet autorisasjon","permalink":"/docs/applikasjon-utrulling/tilgangsstyring/token-validering"},"next":{"title":"Ztoperator","permalink":"/docs/applikasjon-utrulling/tilgangsstyring/ztoperator/"}}');var i=t(74848),s=t(28453),o=t(11470),l=t(19365),a=t(27293);const d={},c="Auto-login",u={},g=[{value:"\ud83d\udcd6 Eksempler",id:"-eksempler",level:2}];function p(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"auto-login",children:"Auto-login"})}),"\n",(0,i.jsxs)(n.p,{children:["SKIP st\xf8tter automatisk provisjonering av ressurser i en applikasjons Istio-sidecar for \xe5 h\xe5ndtere ",(0,i.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/html/rfc6749#section-4.1",children:"OAuth 2.0 authorization code flow"}),".\nDette gj\xf8r det mulig \xe5 konfigurere en innloggingsflyt rundt applikasjonen, og selv bestemme n\xe5r denne flyten skal initieres og h\xe5ndheves, uten \xe5 gj\xf8re endringer inne i selve applikasjonskoden.\nN\xe5r funksjonen er aktivert, vil uautentiserte brukere som fors\xf8ker \xe5 n\xe5 applikasjonen automatisk bli omdirigert til en innloggingsflyt\nmot en valgt identitetsleverand\xf8r. Etter fullf\xf8rt og vellykket autentisering blir brukeren returnert til applikasjonen med gyldig tilgang."]}),"\n",(0,i.jsx)(n.p,{children:"Det er ogs\xe5 st\xf8tte for \xe5 definere eksplisitte login-endepunkt, som kan benyttes til \xe5 initiere en innloggingssl\xf8yfe\nmanuelt. Dette gir st\xf8rre fleksibilitet i brukeropplevelsen og muliggj\xf8r tilpasset integrasjon med frontend-applikasjoner."}),"\n",(0,i.jsxs)(n.p,{children:["Det finnes to m\xe5ter \xe5 konfigurere denne funksjonaliteten p\xe5. Den ene er \xe5 bruke Ztoperator direkte ved \xe5 definere en ",(0,i.jsx)(n.code,{children:"AuthPolicy"}),"-ressurs,\nsom gir full kontroll over autentiserings- og autorisasjonsregler inn mot \xe9n eller flere workloads. Alternativt kan man benytte Skiperator via ",(0,i.jsx)(n.code,{children:"Application"}),"-CRD-en. I dette tilfellet vil Skiperator automatisk\ngenerere n\xf8dvendig AuthPolicy-ressurs bak kulissene, noe som forenkler konfigurasjonen og integreres s\xf8ml\xf8st med \xf8vrig SKIP-funksjonalitet, som for eksempel ",(0,i.jsx)(n.a,{href:"/docs/applikasjon-utrulling/tilgangsstyring/klientregistrering",children:"klientregistrering"}),"."]}),"\n",(0,i.jsxs)(o.A,{groupId:"operator",children:[(0,i.jsxs)(l.A,{value:"ztoperator",label:"Ztoperator",children:[(0,i.jsxs)(n.p,{children:["Ztoperator muliggj\xf8r automatisk innlogging ved \xe5 benytte ",(0,i.jsx)(n.a,{href:"https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/oauth2_filter",children:"Envoy OAuth2-filter"}),".\nDette filteret inspiserer innkommende foresp\xf8rsler og vurderer om brukeren er autentisert. Dersom foresp\xf8rselen ikke er autentisert, vil brukeren automatisk bli omdirigert til innlogging hos den konfigurerte identitetsleverand\xf8ren.\nZtoperator utvider funksjonaliteten ved \xe5 gi mulighet for \xe5 spesifisere hvilke URL-stier som skal utl\xf8se innloggingsflyten.\nFor en mer detaljert beskrivelse av hvordan automatisk innlogging kan konfigureres, se ",(0,i.jsx)(n.a,{href:"/docs/applikasjon-utrulling/tilgangsstyring/ztoperator/api-docs",children:"API-dokumentasjonen til Ztoperator"}),".\nLes mer om hvordan du kan ",(0,i.jsxs)(n.a,{href:"/docs/applikasjon-utrulling/tilgangsstyring/ztoperator/test-authpolicy",children:["teste din ",(0,i.jsx)(n.code,{children:"AuthPolicy"})]})," for \xe5 validere at en ",(0,i.jsx)(n.code,{children:"AuthPolicy"})," fungerer som forventet."]}),(0,i.jsxs)(n.p,{children:["En forutsetning for \xe5 kunne sette opp automatisk innlogging med Ztoperator er at det eksisterer en Kubernetes hemmelighet i samme ",(0,i.jsx)(n.code,{children:"namespace"}),". Hemmeligheten m\xe5 inneholde klient-ID (client ID) og\nklient-hemmelighet (client secret). Dette f\xe5r man automatisk opprettet hvis man registrerer en klienten gjennom ",(0,i.jsx)(n.a,{href:"/docs/applikasjon-utrulling/tilgangsstyring/klientregistrering",children:"Skiperator, Digdirator eller Azurerator"}),".\nEventuelt kan en bruke ",(0,i.jsx)(n.a,{href:"/docs/applikasjon-utrulling/argo-cd/hente-hemmeligheter-fra-hemmelighetsvelv",children:"External Secrets Operator"})," for \xe5 hente verdiene fra ",(0,i.jsx)(n.a,{href:"https://cloud.google.com/security/products/secret-manager?hl=en",children:"Google Secret Manager"}),"."]}),(0,i.jsx)(a.A,{type:"warning",title:"Husk...",children:(0,i.jsxs)(n.p,{children:["Ved \xe5 navigere til stien som settes som utloggingssti (",(0,i.jsx)(n.code,{children:"logoutPath"}),"), termineres den innloggede sesjonen b\xe5de lokalt ",(0,i.jsx)(n.strong,{children:"og"})," hos den konfigurerte identitetsleverand\xf8ren (IDP).\nZtoperator vil deretter navigere brukeren tilbake til rot (",(0,i.jsx)(n.code,{children:"https://<ingress>/"}),"). Dette ",(0,i.jsx)(n.strong,{children:"m\xe5"})," samsvare med det som er konfigurert som ",(0,i.jsx)(n.code,{children:"post_logout_redirect_uri"})," hos IDP for at utlogging hos IDP skal fungere."]})}),(0,i.jsx)(a.A,{type:"warning",title:"Husk...",children:(0,i.jsxs)(n.p,{children:["Digdirator oppretter ",(0,i.jsx)(n.strong,{children:"kun"})," en ",(0,i.jsx)(n.a,{href:"https://oauth.net/private-key-jwt/",children:"private key JWT"})," for \xe5 veksle inn autorisasjonskode mot access token / refresh token og ",(0,i.jsx)(n.strong,{children:"ikke"})," en client secret.\n",(0,i.jsx)(n.a,{href:"https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_filters/oauth2_filter",children:"Envoy OAuth2-filter"})," st\xf8tter per n\xe5 ",(0,i.jsx)(n.strong,{children:"kun"})," client secret og ID-porten integrasjoner opprettet\nmed Digdirator vil derfor ",(0,i.jsx)(n.strong,{children:"ikke"})," v\xe6re kompatibelt med automatisk innlogging med Ztoperator per n\xe5."]})})]}),(0,i.jsx)(l.A,{value:"skiperator",label:"Skiperator",children:(0,i.jsxs)(n.p,{children:["\ud83d\udea7 ",(0,i.jsx)(n.strong,{children:"UNDER UTVIKLING"})," \ud83d\udea7",(0,i.jsx)("br",{}),"\nSt\xf8tte for \xe5 sette opp automatisk innlogging i Istio-sidecar via Skiperator-manifestet er under utvikling og er forel\xf8pig ikke tilgjengelig."]})})]}),"\n",(0,i.jsx)(n.h2,{id:"-eksempler",children:"\ud83d\udcd6 Eksempler"}),"\n",(0,i.jsx)(n.p,{children:"Under f\xf8lger eksempler p\xe5 hvordan \xe5 konfigurere automatisk innlogging p\xe5 SKIP."}),"\n",(0,i.jsx)(n.p,{children:"Eksempel 1 konfigurerer automatisk innlogging for alle beskyttede endepunkt, noe som passer godt for typiske hyllevare-l\xf8sninger."}),"\n",(0,i.jsxs)(n.p,{children:["Eksempel 2 konfigurerer automatisk innlogging med en dedikert innloggingssti (",(0,i.jsx)(n.code,{children:"loginPath"}),").\nEn kan da konfigurere beskyttede endepunkt under ",(0,i.jsx)(n.code,{children:"authRules"})," med feltet ",(0,i.jsx)(n.code,{children:"denyRedirect: true"}),". Ztoperator vil da ikke omdirigere til innlogging og heller returnere ",(0,i.jsx)(n.code,{children:"401 Unauthorized"}),"\nhvis en innkommende foresp\xf8rsel ikke er autentisert. En frontend applikasjon kan da heller omdirigere brukeren til innloggingsstien for \xe5 f\xe5 opprettet en innlogget sesjon.\nDette er noe som passer godt for Single Page Applications (SPA)."]}),"\n",(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:(0,i.jsx)("strong",{children:"Eksempel 1: Automatisk innlogging for alle beskyttede endepunkt"})}),(0,i.jsxs)(o.A,{groupId:"operator",children:[(0,i.jsxs)(l.A,{value:"ztoperator",label:"Ztoperator",children:[(0,i.jsxs)(n.p,{children:["F\xf8lgende ",(0,i.jsx)(n.code,{children:"AuthPolicy"})," er konfigurert til \xe5 ikke sikre endepunktene ",(0,i.jsx)(n.code,{children:"/public*"})," og ",(0,i.jsx)(n.code,{children:"/assets*"}),", men sikre alt annet.\nFor \xe5 sette opp automatisk innlogging m\xe5 Ztoperator ha tilgang til klient ID (client ID) og klient hemmelighet (client secret) tilh\xf8rende en klientregistrering.\nFor \xe5 oppn\xe5 dette m\xe5 en referere til hvilken Kubernetes-hemmelighet de ligger i, samt hvilke data-keys de er mappet til."]}),(0,i.jsxs)(n.p,{children:["Deretter m\xe5 en spesifisere omdirigeringssti, utloggingssti og hvilke ",(0,i.jsx)(n.code,{children:"scopes"})," som skal foresp\xf8rres under innlogginssl\xf8yfen (authorization code flow)."]}),(0,i.jsx)(a.A,{type:"tip",title:"Husk p\xe5 at...",children:(0,i.jsxs)(n.p,{children:["Det er viktig at omdirigeringsstien en oppgir stemmer overens med omdirigeringsstien registrert hos identitetstilbyderen.\nDen m\xe5 da matche applikasjonens ",(0,i.jsx)(n.code,{children:"ingress"})," + ",(0,i.jsx)(n.code,{children:"omdirigeringssti"}),"."]})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: ztoperator.kartverket.no/v1alpha1\nkind: AuthPolicy\nmetadata:\n  name: some-auth-policy\n  namespace: some-namespace\nspec:\n  enabled: true\n  ignoreAuthRules:\n    - paths:\n        - /public*\n        - /assets*\n  audience:\n    - some-audience\n  wellKnownURI: https://some-issuer.com/.well-known/openid-configuration\n  // diff-add-start\n  oAuthCredentials:\n    secretRef: oauth-secret\n    clientIDKey: CLIENT_ID_KEY\n    clientSecretKey: CLIENT_SECRET_SECRET\n  // diff-add-end\n  // diff-add-start\n  autoLogin:\n    enabled: true\n    logoutPath: /logout\n    redirectPath: /oauth2/callback\n    scopes:\n      - offline_access\n      - openid\n  // diff-add-end\n  selector:\n    matchLabels:\n      app: some-application\n\n"})})]}),(0,i.jsx)(l.A,{value:"skiperator",label:"Skiperator",children:(0,i.jsxs)(n.p,{children:["\ud83d\udea7 ",(0,i.jsx)(n.strong,{children:"UNDER UTVIKLING"})," \ud83d\udea7",(0,i.jsx)("br",{}),"\nSt\xf8tte for \xe5 sette opp automatisk innlogging via Skiperator-manifestet er under utvikling og er forel\xf8pig ikke tilgjengelig."]})})]})]}),"\n",(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:(0,i.jsxs)("strong",{children:["Eksempel 2: Automatisk innlogging med dedikert innloggingssti (",(0,i.jsx)(n.code,{children:"loginPath"}),")"]})}),(0,i.jsxs)(o.A,{groupId:"operator",children:[(0,i.jsxs)(l.A,{value:"ztoperator",label:"Ztoperator",children:[(0,i.jsxs)(n.p,{children:["F\xf8lgende ",(0,i.jsx)(n.code,{children:"AuthPolicy"})," er konfigurert til \xe5 sikre endepunktene ",(0,i.jsx)(n.code,{children:"/api*"})," (",(0,i.jsx)(n.code,{children:"/api"})," og alle dens understier).\nHvis dette hadde v\xe6rt en applikasjon som servet frontend OG api-endepunkter under ",(0,i.jsx)(n.code,{children:"/api*"}),", s\xe5 vil s\xe5kalte AJAX-kall ikke kunne automatisk omdirigert brukeren inn p\xe5\nen innloggingssl\xf8yfe. For \xe5 l\xf8se dette spesifiserer vi en dedikert innloggingssti (",(0,i.jsx)(n.code,{children:"loginPath"}),") og setter ",(0,i.jsx)(n.code,{children:"denyRedirect: true"})," for ",(0,i.jsx)(n.code,{children:"/api*"}),". P\xe5 den m\xe5ten\nkan frontend-applikasjonen selv omdirigere brukeren til innloggingsendepunktet for \xe5 opprette en innlogget sesjon hvis den for eksemepel mottar 401 Unauthorized p\xe5 uatentiserte kall mot ",(0,i.jsx)(n.code,{children:"/api*"}),"."]}),(0,i.jsx)(n.p,{children:"For \xe5 sette opp automatisk innlogging m\xe5 Ztoperator ha tilgang til klient ID (client ID) og klient hemmelighet (client secret) tilh\xf8rende en klientregistrering.\nFor \xe5 oppn\xe5 dette m\xe5 en referere til hvilken Kubernetes-hemmelighet de ligger i, samt hvilke data-keys de er mappet til."}),(0,i.jsxs)(n.p,{children:["Deretter m\xe5 en spesifisere omdirigeringssti, utloggingssti og hvilke ",(0,i.jsx)(n.code,{children:"scopes"})," som skal foresp\xf8rres under innlogginssl\xf8yfen (authorization code flow)."]}),(0,i.jsx)(a.A,{type:"tip",title:"Husk p\xe5 at...",children:(0,i.jsxs)(n.p,{children:["Det er viktig at omdirigeringsstien en oppgir stemmer overens med omdirigeringsstien registrert hos identitetstilbyderen.\nDen m\xe5 da matche applikasjonens ",(0,i.jsx)(n.code,{children:"ingress"})," + ",(0,i.jsx)(n.code,{children:"omdirigeringssti"}),"."]})}),(0,i.jsx)(a.A,{type:"warning",title:"Merk...",children:(0,i.jsx)(n.p,{children:"Ved vellykket innlogging via konfigurert innloggingssti vil foresp\xf8rselen mot innloggingsstien fortsette inn til den beskyttede applikasjonen.\nApplikasjonen m\xe5 selv da h\xe5ndtere \xe5 omdirigere brukeren til \xf8nsket sti etter vellykket innlogging."})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: ztoperator.kartverket.no/v1alpha1\nkind: AuthPolicy\nmetadata:\n  name: some-auth-policy\n  namespace: some-namespace\nspec:\n  enabled: true\n  ignoreAuthRules:\n    - paths:\n        - /*\n  authRules:\n    - paths:\n        - /api*\n// diff-add-start\n      denyRedirect: true\n// diff-add-end\n  audience:\n    - some-audience\n  wellKnownURI: https://some-issuer.com/.well-known/openid-configuration\n  // diff-add-start\n  oAuthCredentials:\n    secretRef: oauth-secret\n    clientIDKey: CLIENT_ID_KEY\n    clientSecretKey: CLIENT_SECRET_SECRET\n  // diff-add-end\n  // diff-add-start\n  autoLogin:\n    enabled: true\n    loginPath: /login\n    logoutPath: /logout\n    redirectPath: /oauth2/callback\n    scopes:\n      - offline_access\n      - openid\n  // diff-add-end\n  selector:\n    matchLabels:\n      app: some-application\n\n"})})]}),(0,i.jsx)(l.A,{value:"skiperator",label:"Skiperator",children:(0,i.jsxs)(n.p,{children:["\ud83d\udea7 ",(0,i.jsx)(n.strong,{children:"UNDER UTVIKLING"})," \ud83d\udea7",(0,i.jsx)("br",{}),"\nSt\xf8tte for \xe5 sette opp automatisk innlogging via Skiperator-manifestet er under utvikling og er forel\xf8pig ikke tilgjengelig."]})})]})]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}}}]);