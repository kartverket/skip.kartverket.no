"use strict";(self.webpackChunkskip_docs=self.webpackChunkskip_docs||[]).push([[9034],{28453:(e,t,s)=>{s.d(t,{R:()=>o,x:()=>i});var r=s(96540);const a={},n=r.createContext(a);function o(e){const t=r.useContext(n);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),r.createElement(n.Provider,{value:t},e.children)}},67311:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"observability/grafana-cheat-sheet","title":"Grafana cheat sheet","description":"This is a collection of tips&tricks that are useful when troubleshooting problems in the kubernetes clusters based on data from LGTM","source":"@site/docs/07-observability/07-grafana-cheat-sheet.md","sourceDirName":"07-observability","slug":"/observability/grafana-cheat-sheet","permalink":"/docs/observability/grafana-cheat-sheet","draft":false,"unlisted":false,"editUrl":"https://github.com/kartverket/skip-docs/edit/main/docs/07-observability/07-grafana-cheat-sheet.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Recording and alerting rules","permalink":"/docs/observability/recording-and-alerting-rules"},"next":{"title":"Real User Monitoring with Faro","permalink":"/docs/observability/real-user-monitoring-with-Faro"}}');var a=s(74848),n=s(28453);const o={},i="Grafana cheat sheet",c={},l=[{value:"Useful Mimir queries",id:"useful-mimir-queries",level:2},{value:"Top 20 of metrics with high cardinality",id:"top-20-of-metrics-with-high-cardinality",level:3},{value:"Top 10 namespaces with overallocated cpu resources",id:"top-10-namespaces-with-overallocated-cpu-resources",level:3},{value:"Sum of overallocated cpu for containers by namespace",id:"sum-of-overallocated-cpu-for-containers-by-namespace",level:3},{value:"Daily amount of requests by destination app and response code",id:"daily-amount-of-requests-by-destination-app-and-response-code",level:3},{value:"Useful Loki queries",id:"useful-loki-queries",level:3}];function u(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,n.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"grafana-cheat-sheet",children:"Grafana cheat sheet"})}),"\n",(0,a.jsx)(t.p,{children:"This is a collection of tips&tricks that are useful when troubleshooting problems in the kubernetes clusters based on data from LGTM"}),"\n",(0,a.jsx)(t.h2,{id:"useful-mimir-queries",children:"Useful Mimir queries"}),"\n",(0,a.jsx)(t.h3,{id:"top-20-of-metrics-with-high-cardinality",children:"Top 20 of metrics with high cardinality"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.a,{href:"https://monitoring.kartverket.cloud/goto/cc_GwW1SR?orgId=1",children:"https://monitoring.kartverket.cloud/goto/cc_GwW1SR?orgId=1"})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-promql",children:'# Set time range to "Last 5 minutes"\ntopk(20, count by (__name__)({__name__=~".+"}))\n'})}),"\n",(0,a.jsx)(t.h3,{id:"top-10-namespaces-with-overallocated-cpu-resources",children:"Top 10 namespaces with overallocated cpu resources"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.a,{href:"https://monitoring.kartverket.cloud/goto/6V2jQZJIg?orgId=1",children:"https://monitoring.kartverket.cloud/goto/6V2jQZJIg?orgId=1"})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-promql",children:'topk(10, sum by (namespace)\n  (kube_pod_container_resource_requests{job="integrations/kubernetes/kube-state-metrics", resource="cpu"})\n  - sum by (namespace) (rate(container_cpu_usage_seconds_total{}[$__rate_interval])))\n'})}),"\n",(0,a.jsx)(t.h3,{id:"sum-of-overallocated-cpu-for-containers-by-namespace",children:"Sum of overallocated cpu for containers by namespace"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.a,{href:"https://monitoring.kartverket.cloud/goto/xF2DlW1SR?orgId=1",children:"https://monitoring.kartverket.cloud/goto/xF2DlW1SR?orgId=1"})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-promql",children:'sum by (container)\n  (kube_pod_container_resource_requests{job="integrations/kubernetes/kube-state-metrics", resource="cpu", namespace=~"matrikkel.*"})\n  - sum by (container) (rate(container_cpu_usage_seconds_total{namespace=~"matrikkel.*"}[$__rate_interval]))\n'})}),"\n",(0,a.jsx)(t.h3,{id:"daily-amount-of-requests-by-destination-app-and-response-code",children:"Daily amount of requests by destination app and response code"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-promql",children:'sum by (destination_app, response_code) (\n  increase(istio_requests_total{namespace="<namespace name>", response_code=~".*", source_app="istio-ingress-external"}[1d])\n)\n'})}),"\n",(0,a.jsx)(t.h3,{id:"useful-loki-queries",children:"Useful Loki queries"})]})}function d(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}}}]);