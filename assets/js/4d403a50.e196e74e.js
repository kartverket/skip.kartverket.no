"use strict";(self.webpackChunkskip_docs=self.webpackChunkskip_docs||[]).push([[3352],{42185:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>k,frontMatter:()=>a,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"kom-i-gang/praktisk-intro/github/bruk-av-github-med-jenkins","title":"Bruk av GitHub med Jenkins","description":"Hvis en p\xe5 ditt omr\xe5de (Grunnboka/Matrikkel/etc.) har satt opp repoer p\xe5 GitHub (med Jenkins) s\xe5 skal oppsett av en ny App ikke v\xe6re n\xf8dvendig. Men repoet m\xe5 legges til i Appen! Dette gj\xf8res ved \xe5 sende en PR til https://github.com/kartverket/github-iac/blob/main/apps/modules.tf","source":"@site/docs/02-kom-i-gang/06-praktisk-intro/01-github/05-bruk-av-github-med-jenkins.md","sourceDirName":"02-kom-i-gang/06-praktisk-intro/01-github","slug":"/kom-i-gang/praktisk-intro/github/bruk-av-github-med-jenkins","permalink":"/docs/kom-i-gang/praktisk-intro/github/bruk-av-github-med-jenkins","draft":false,"unlisted":false,"editUrl":"https://github.com/kartverket/skip-docs/edit/main/docs/02-kom-i-gang/06-praktisk-intro/01-github/05-bruk-av-github-med-jenkins.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"H\xe5ndtering av sensitiv data som er kommet p\xe5 repositoriet","permalink":"/docs/kom-i-gang/praktisk-intro/github/h\xe5ndtering-av-sensitiv-data-som-er-kommet-p\xe5-repositoriet"},"next":{"title":"Dependabot","permalink":"/docs/kom-i-gang/praktisk-intro/github/dependabot"}}');var r=n(74848),s=n(28453);const a={},o="Bruk av GitHub med Jenkins",p={},l=[{value:"\ud83d\udcda Autentisering \ud83d\udcda",id:"-autentisering-",level:2},{value:"\ud83e\uddd1\u200d\ud83d\ude92 Brannmurer \ud83e\uddd1\u200d\ud83d\ude92",id:"-brannmurer-",level:2},{value:"\ud83e\ude9d Webhook \ud83e\ude9d",id:"-webhook-",level:2},{value:"\ud83d\udcc1 Oppsett av GitHub App \ud83d\udcc1",id:"-oppsett-av-github-app-",level:2}];function d(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"bruk-av-github-med-jenkins",children:"Bruk av GitHub med Jenkins"})}),"\n",(0,r.jsxs)(t.p,{children:["Hvis en p\xe5 ditt omr\xe5de (Grunnboka/Matrikkel/etc.) har satt opp repoer p\xe5 GitHub (med Jenkins) s\xe5 skal oppsett av en ny App ikke v\xe6re n\xf8dvendig. Men repoet m\xe5 legges til i Appen! Dette gj\xf8res ved \xe5 sende en PR til ",(0,r.jsx)(t.a,{href:"https://github.com/kartverket/github-iac/blob/main/apps/modules.tf",children:"https://github.com/kartverket/github-iac/blob/main/apps/modules.tf"})]}),"\n",(0,r.jsxs)(t.p,{children:["Denne oppskriften tar utgangspunkt i ",(0,r.jsx)(t.strong,{children:"Multibranch-pipeline"})," oppsett i Jenkins. Men skal fungere for andre konfigurasjoner."]}),"\n",(0,r.jsx)(t.p,{children:"Utgangspunktet er at oppsettet i Jenkins skal v\xe6re likt for GitHub som BitBucket, men selve autentiseringen av GitHub (kontra BitBucket) vil v\xe6re noe forskjellig. Dette kommer av naturlige \xe5rsaker, siden BitBucket er lokalt hostet hos Kartverket, sammenlignet med GitHub som er \xe5pent for \u201calle\u201d p\xe5 internet - og bygger p\xe5 litt annen teknologi."}),"\n",(0,r.jsx)(t.h2,{id:"-autentisering-",children:"\ud83d\udcda Autentisering \ud83d\udcda"}),"\n",(0,r.jsx)(t.p,{children:"Det er flere m\xe5ter \xe5 autentisere Jenkins mot GitHub p\xe5, blant annet; deploy keys, personal access tokens, GitHub App. Vi vil se at GitHub Apps er valget vi g\xe5r for n\xe5r vi autentiserer."}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsxs)(t.a,{href:"https://docs.github.com/en/developers/overview/managing-deploy-keys",children:[" ",(0,r.jsx)(t.strong,{children:"Deploy keys"})," "]})," er enkle men;"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"\ud83d\udc4d Eies av repoet og Jenkins (priv + pub n\xf8kler)"}),"\n",(0,r.jsx)(t.li,{children:"\ud83d\udc4a Kan kun brukes som \u201cGit\u201d source p\xe5 Jenkins"}),"\n",(0,r.jsx)(t.li,{children:"\ud83d\udc4e Snakker ikke med GitHub sitt API - kun pulle / pushe kode"}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsxs)(t.a,{href:"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token",children:[" ",(0,r.jsx)(t.strong,{children:"Personal access tokens"})," "]})," **** (PAT) gir mer;"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"\ud83d\udc4d Kan brukes gjennom \u201cGitHub\u201d plugin p\xe5 Jenkins (source)"}),"\n",(0,r.jsx)(t.li,{children:"\ud83d\udc4d Snakker med GitHub API\u2019et - PR/Commit status triggere etc."}),"\n",(0,r.jsx)(t.li,{children:"\ud83d\udc4e N\xf8kkelen f\xf8lger brukeren, selv etter vedkommende bytter team eller slutter (kan slettes fra bruker)"}),"\n",(0,r.jsx)(t.li,{children:"\ud83d\udc4e Ikke i utgangspunktet gjenbrukbar (beta- fine grained PAT\u2019er kan tilegnes flere repo pr. n\xf8kkel)"}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsxs)(t.a,{href:"https://docs.github.com/en/developers/apps/getting-started-with-apps/about-apps",children:[" ",(0,r.jsx)(t.strong,{children:"GitHub Apps"})," "]})," er litt mer \xe5 konfigurere, men er en kombinasjon av de over;"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"\ud83d\udc4d Gjenbrukbare, som flere repoer kan bruke gjennom \xe9n privat n\xf8kkel p\xe5 Jenkins."}),"\n",(0,r.jsx)(t.li,{children:"\ud83d\udc4d Eies av \u201cOrganisasjonen\u201d Kartverket p\xe5 Github, som da ikke er bundet til en GitHub bruker."}),"\n",(0,r.jsx)(t.li,{children:"\ud83d\udc4d Kan brukes gjennom \u201cGitHub\u201d plugin p\xe5 Jenkins (source)"}),"\n",(0,r.jsx)(t.li,{children:"\ud83d\udc4d Snakker med GitHub API\u2019et - PR/Commit status triggere etc."}),"\n",(0,r.jsx)(t.li,{children:"\ud83d\udc4e Ratelimit (men skal ikke v\xe6re et problem)"}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"-brannmurer-",children:"\ud83e\uddd1\u200d\ud83d\ude92 Brannmurer \ud83e\uddd1\u200d\ud83d\ude92"}),"\n",(0,r.jsx)(t.p,{children:"I utgangspunktet s\xe5 skal portene til ditt Jenkins milj\xf8 v\xe6re \xe5pnet, slik at Jenkins n\xe5r ut til GitHub. Men hvis det dette er f\xf8rste gang s\xe5 m\xe5 de \xe5pnes for trafikk mot GitHub. Prim\xe6rt er det HTTPs og SSH trafikk som m\xe5 tilgjengeliggj\xf8res p\xe5 port 443 og 22. Dette m\xe5 bestilles hos drift."}),"\n",(0,r.jsx)(t.h2,{id:"-webhook-",children:"\ud83e\ude9d Webhook \ud83e\ude9d"}),"\n",(0,r.jsx)(t.p,{children:"Work in progress. Er ikke ferdig testet enda."}),"\n",(0,r.jsxs)(t.p,{children:["For \xe5 f\xe5 status p\xe5 PR/Commits i GitHub s\xe5 m\xe5 GitHub ha en vei inn til Jenkins. Dette gj\xf8res p\xe5 et webhook endepunkt typisk seende slik ut ",(0,r.jsx)(t.code,{children:"https://<jenkins-host>/github-webhook/"})," . Dette er noe som m\xe5 \xe5pnes fra drift og spesifiseres inne i GitHub Appen."]}),"\n",(0,r.jsx)(t.p,{children:"\u2699\ufe0f Legg til hvordan det er med webhook secret."}),"\n",(0,r.jsx)(t.h2,{id:"-oppsett-av-github-app-",children:"\ud83d\udcc1 Oppsett av GitHub App \ud83d\udcc1"}),"\n",(0,r.jsxs)(t.p,{children:["SKIP kontaktes og de setter opp en App for ditt behov. Er denne som f\xf8lges: ",(0,r.jsx)(t.a,{href:"https://docs.cloudbees.com/docs/cloudbees-ci/latest/traditional-admin-guide/github-app-auth#_creating_the_github_app",children:"Using GitHub App authentication"})," ."]}),"\n",(0,r.jsxs)(t.admonition,{type:"info",children:[(0,r.jsx)(t.p,{children:"Oppsettet av n\xf8klen m\xe5 du gj\xf8re selv! Og dette F\xd8R du f\xe5r brukt Appen, men ETTER at SKIP setter igang med oppsett av app. SKIP sender melding n\xe5r du m\xe5 gj\xf8re dette."}),(0,r.jsx)(t.p,{children:(0,r.jsx)(t.em,{children:"nb: skal Appen ha flere/mindre rettigheter enn i oppskriften m\xe5 du spesifisere dette"})})]}),"\n",(0,r.jsxs)(t.p,{children:["N\xe5r SKIP har satt opp Appen, m\xe5 du sette den private n\xf8kkelen, som senere skal deles med Jenkins. Dette gj\xf8res slik som beskrevet i punktet ",(0,r.jsx)(t.a,{href:"https://docs.cloudbees.com/docs/cloudbees-ci/latest/traditional-admin-guide/github-app-auth#_generating_a_private_key_for_authenticating_to_the_github_app",children:"Generating a private key for authenticating to the GitHub App"})," ."]}),"\n",(0,r.jsx)(t.p,{children:"Det er f\xf8rst n\xe5r dette er gjort, at SKIP kan installere Appen p\xe5 organisasjonen. Send en heads-up at du har lagret n\xf8kkelen."}),"\n",(0,r.jsx)(t.p,{children:"Hvis Appen er installert i org. og linket til ditt repo, og n\xf8kkelen er satt opp i App og Jenkins s\xe5 skal alt v\xe6re p\xe5 plass! \ud83c\udf89"})]})}function k(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>o});var i=n(96540);const r={},s=i.createContext(r);function a(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);