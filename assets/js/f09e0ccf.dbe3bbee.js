"use strict";(globalThis.webpackChunkskip_docs=globalThis.webpackChunkskip_docs||[]).push([[1711],{95820(e,n,t){t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"observability/synthetic-monitoring","title":"Syntetisk overv\xe5king","description":"Syntetisk overv\xe5king sjekker tilgjengeligheten til tjenestene dine ved \xe5 sende HTTP-foresp\xf8rsler med jevne mellomrom.","source":"@site/docs/07-observability/09-synthetic-monitoring.md","sourceDirName":"07-observability","slug":"/observability/synthetic-monitoring","permalink":"/docs/observability/synthetic-monitoring","draft":false,"unlisted":false,"editUrl":"https://github.com/kartverket/skip-docs/edit/main/docs/07-observability/09-synthetic-monitoring.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"sidebar_position":9},"sidebar":"tutorialSidebar","previous":{"title":"Real User Monitoring with Faro","permalink":"/docs/observability/real-user-monitoring-with-Faro"}}');var s=t(74848),i=t(28453);const l={sidebar_position:9},o="Syntetisk overv\xe5king",a={},d=[{value:"Kom i gang",id:"kom-i-gang",level:2},{value:"Konfigurasjon",id:"konfigurasjon",level:2},{value:"Felter",id:"felter",level:3},{value:"Hva sjekkes?",id:"hva-sjekkes",level:2},{value:"Fjerne syntetisk overv\xe5king",id:"fjerne-syntetisk-overv\xe5king",level:2},{value:"Sp\xf8rsm\xe5l?",id:"sp\xf8rsm\xe5l",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"syntetisk-overv\xe5king",children:"Syntetisk overv\xe5king"})}),"\n",(0,s.jsx)(n.p,{children:"Syntetisk overv\xe5king sjekker tilgjengeligheten til tjenestene dine ved \xe5 sende HTTP-foresp\xf8rsler med jevne mellomrom."}),"\n",(0,s.jsx)(n.h2,{id:"kom-i-gang",children:"Kom i gang"}),"\n",(0,s.jsx)(n.p,{children:"For \xe5 ta i bruk syntetisk overv\xe5king m\xe5 du gj\xf8re f\xf8lgende steg:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Velg et repo der konfigurasjonen skal ligge. Vi anbefaler at den legges i repoet som inneholder koden til applikasjonen, men et apps-repo er ogs\xe5 mulig."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Sett opp tilgang for repoet ditt via Octo STS. Dette er et f\xf8rstegangssteg som gir workflowen tilgang til \xe5 opprette PR-er i det sentrale repoet. Du m\xe5 opprette en PR i ",(0,s.jsxs)(n.a,{href:"https://github.com/kartverket/blackbox-exporter",children:[(0,s.jsx)(n.code,{children:"blackbox-exporter"}),"-repoet"]})," med to endringer:"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"a)"})," Opprett en Octo STS trust policy-fil under ",(0,s.jsx)(n.code,{children:".github/chainguard/<repo-navn>.sts.yaml"}),":"]}),"\n",(0,s.jsxs)(n.p,{children:["Bytt ut ",(0,s.jsx)(n.code,{children:"<repo-navn>"})," med navnet p\xe5 repoet ditt."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"issuer: https://token.actions.githubusercontent.com\nsubject_pattern: repo:kartverket\\/(<repo-navn>:(ref:refs\\/heads\\/.+|pull_request))\n\npermissions:\n  pull_requests: write\n  contents: write\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Se ",(0,s.jsx)(n.a,{href:"https://skip.kartverket.no/docs/applikasjon-utrulling/github-actions/tilgang-til-repoer-med-tokens-fra-github-actions#secure-token-service-sts",children:"Octo STS-dokumentasjonen"})," for mer informasjon om hvordan dette fungerer."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"b)"})," Legg til repoet ditt i ",(0,s.jsx)(n.code,{children:"onboarded-teams.yaml"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"teams:\n  # ... eksisterende teams\n  - name: Mitt Team\n    repositories:\n      - name: mitt-repo\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Installer f\xf8lgende reusable workflow i repoet ditt. Denne validerer konfigurasjonen p\xe5 pull requests, og dytter den til et sentralt repo ved push til ",(0,s.jsx)(n.code,{children:"main"})," (ev. en annen default branch)."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"name: Validate Synthetic Monitoring Config\n\non:\n  push:\n    branches:\n    - main  # Bytt ut med navnet p\xe5 default branch om det ikke er main\n    paths:\n    - synthetic-monitoring.yaml\n  pull_request:\n    paths:\n    - synthetic-monitoring.yaml\n\njobs:\n  call-synthetic-monitoring:\n    permissions:\n      contents: read\n      pull-requests: write\n      id-token: write\n    uses: kartverket/github-workflows/.github/workflows/synthetic-monitoring.yaml@<release tag>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Bytt ut ",(0,s.jsx)(n.code,{children:"<release tag>"})," med den siste versjonen av workflowen. Se ",(0,s.jsx)(n.a,{href:"https://github.com/kartverket/github-workflows/releases",children:"releases"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Opprett en fil kalt ",(0,s.jsx)(n.code,{children:"synthetic-monitoring.yaml"})," i repoet ditt (se ",(0,s.jsx)(n.a,{href:"#konfigurasjon",children:"Konfigurasjon"}),")."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"konfigurasjon",children:"Konfigurasjon"}),"\n",(0,s.jsxs)(n.p,{children:["Syntetisk overv\xe5king konfigureres i filen ",(0,s.jsx)(n.code,{children:"synthetic-monitoring.yaml"})," i roten av repoet ditt. Filen inneholder en liste med targets og tilh\xf8rende labels:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"- targets:\n    - https://kartverket.no\n    - https://health.atkv3-prod.kartverket.cloud/health\n  labels:\n    team: mitt-team\n    env: prod\n    service: min-tjeneste\n"})}),"\n",(0,s.jsx)(n.h3,{id:"felter",children:"Felter"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Felt"}),(0,s.jsx)(n.th,{children:"P\xe5krevd"}),(0,s.jsx)(n.th,{children:"Beskrivelse"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"targets"})}),(0,s.jsx)(n.td,{children:"Ja"}),(0,s.jsxs)(n.td,{children:["Liste med URL-er som skal sjekkes. M\xe5 inkludere protokoll (eks. ",(0,s.jsx)(n.code,{children:"https://"}),")."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"labels.team"})}),(0,s.jsx)(n.td,{children:"Ja"}),(0,s.jsx)(n.td,{children:"Navnet p\xe5 teamet som eier tjenesten."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"labels.env"})}),(0,s.jsx)(n.td,{children:"Ja"}),(0,s.jsxs)(n.td,{children:["Milj\xf8et tjenesten kj\xf8rer i (f.eks. ",(0,s.jsx)(n.code,{children:"prod"}),", ",(0,s.jsx)(n.code,{children:"dev"}),")."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"labels.service"})}),(0,s.jsx)(n.td,{children:"Ja"}),(0,s.jsxs)(n.td,{children:["Navnet p\xe5 tjenesten. Dette b\xf8r tilsvare navnet i ",(0,s.jsx)(n.a,{href:"https://kartverket.dev",children:"utviklerportalen"}),"."]})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"Du kan definere flere blokker i samme fil for \xe5 gruppere targets med ulike labels:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"- targets:\n    - https://kartverket.no\n  labels:\n    team: mitt-team\n    env: prod\n    service: kartverket.no\n\n- targets:\n    - https://kartverket.atkv3-dev.kartverket.cloud/health\n  labels:\n    team: mitt-team\n    env: dev\n    service: kartverket.no\n"})}),"\n",(0,s.jsx)(n.h2,{id:"hva-sjekkes",children:"Hva sjekkes?"}),"\n",(0,s.jsxs)(n.p,{children:["En sjekk regnes som vellykket hvis tjenesten svarer med en ",(0,s.jsx)(n.strong,{children:"HTTP 2xx-statuskode"})," innen ",(0,s.jsx)(n.strong,{children:"3 sekunder"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"fjerne-syntetisk-overv\xe5king",children:"Fjerne syntetisk overv\xe5king"}),"\n",(0,s.jsxs)(n.p,{children:["Dersom du \xf8nsker \xe5 fjerne syntetisk overv\xe5king for en tjeneste, m\xe5 du slette den tilh\xf8rende blokken i ",(0,s.jsx)(n.code,{children:"synthetic-monitoring.yaml"}),"-filen og pushe endringen til repoet ditt. Dette vil trigge workflowen som igjen vil oppdatere det sentrale repoet og fjerne sjekken."]}),"\n",(0,s.jsx)(n.admonition,{type:"warning",children:(0,s.jsxs)(n.p,{children:["Dersom ",(0,s.jsx)(n.code,{children:"synthetic-monitoring.yaml"}),"-filen slettes eller ikke inneholder noen targets, vil valideringen feile. Vi har ikke full st\xf8tte for selvbetjent sletting av sjekker enda. Ta kontakt med oss i ",(0,s.jsx)(n.a,{href:"https://kartverketgroup.slack.com/archives/C05DVCJ222Y",children:"#gen-skoop"})," p\xe5 Slack for hjelp."]})}),"\n",(0,s.jsx)(n.h2,{id:"sp\xf8rsm\xe5l",children:"Sp\xf8rsm\xe5l?"}),"\n",(0,s.jsxs)(n.p,{children:["Ta kontakt i ",(0,s.jsx)(n.a,{href:"https://kartverketgroup.slack.com/archives/C05DVCJ222Y",children:"#gen-skoop"})," p\xe5 Slack."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453(e,n,t){t.d(n,{R:()=>l,x:()=>o});var r=t(96540);const s={},i=r.createContext(s);function l(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);